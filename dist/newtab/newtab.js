import{O as $}from"../chunks/index-C7sbpHLK.js";let l={},m="default";function i(t){return document.getElementById(t)}const W={baidu:{name:"百度",url:"https://www.baidu.com/s?wd=",placeholder:"百度一下，你就知道"},google:{name:"Google",url:"https://www.google.com/search?q=",placeholder:"Search Google"},bing:{name:"Bing",url:"https://www.bing.com/search?q=",placeholder:"Search Bing"}},N=[{url:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=1920&h=1080&fit=crop",name:"星空夜景"},{url:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop",name:"山脉风光"},{url:"https://images.unsplash.com/photo-1519904981063-b0cf448d479e?w=1920&h=1080&fit=crop",name:"城市夜景"},{url:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop",name:"自然风景"},{url:"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1920&h=1080&fit=crop",name:"森林小径"},{url:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop",name:"海洋波浪"},{url:"https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=1920&h=1080&fit=crop",name:"樱花盛开"},{url:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop",name:"雪山景色"}];document.addEventListener("DOMContentLoaded",async()=>{console.log("页面加载完成，开始初始化...");try{P(),setInterval(P,1e3),console.log("时钟初始化完成"),te(),console.log("搜索初始化完成"),me(),console.log("侧边栏初始化完成"),fe(),console.log("模态框初始化完成"),xe(),console.log("GitHub同步初始化完成"),he(),console.log("底边栏图标初始化开始"),ne(),console.log("工作区初始化完成"),pe(),console.log("动漫背景初始化完成")}catch(t){console.error("初始化过程中发生错误:",t)}});function P(){const t=new Date,e=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0"),s=String(t.getSeconds()).padStart(2,"0"),n=i("clock");n&&(n.textContent=`${e}:${o}:${s}`);const c={weekday:"long",year:"numeric",month:"long",day:"numeric"},r=i("date");r&&(r.textContent=t.toLocaleDateString("zh-CN",c))}function te(){const t=i("search-input"),e=i("search-form");if(!t||!e){console.error("搜索元素未找到");return}typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.get("searchEngine",o=>{const s=o.searchEngine||"baidu",n=W[s];t.placeholder=n.placeholder}),e.addEventListener("submit",o=>{o.preventDefault();const s=t.value.trim();s&&oe(s)})}function oe(t){if(typeof chrome<"u"&&chrome.storage)chrome.storage.sync.get("searchEngine",e=>{const o=e.searchEngine||"baidu",n=W[o].url+encodeURIComponent(t);window.open(n,"_blank")});else{const e=W.baidu.url+encodeURIComponent(t);window.open(e,"_blank")}}function ne(){typeof chrome<"u"&&chrome.storage?chrome.storage.sync.get(["workspaces","currentWorkspace"],t=>{l=t.workspaces||_(),m=t.currentWorkspace||"default",j()}):(l=_(),m="default",j())}async function j(){C(),await E()}function _(){return{default:{id:"default",name:"默认",bookmarks:[],icon:"🏠"},work:{id:"work",name:"工作",bookmarks:[],icon:"💼"},study:{id:"study",name:"学习",bookmarks:[],icon:"📚"},entertainment:{id:"entertainment",name:"娱乐",bookmarks:[],icon:"🎮"}}}function C(){const t=i("workspace-list");if(!t){console.error("workspace-list 元素未找到");return}t.innerHTML="",Object.values(l).forEach(e=>{const o=document.createElement("div");o.className=`workspace-item ${e.id===m?"active":""}`,o.dataset.workspace=e.id;const s=document.createElement("div");s.className="workspace-icon",s.textContent=e.icon||"📁";const n=document.createElement("span");n.textContent=e.name,o.appendChild(s),o.appendChild(n),o.addEventListener("click",()=>{console.log("点击工作区:",e.id),se(e.id)}),o.addEventListener("contextmenu",c=>{c.preventDefault(),ce(c,e)}),t.appendChild(o)}),console.log("工作区列表已更新，当前工作区:",m)}async function se(t){if(!l[t]){console.error("工作区不存在:",t);return}m=t,typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.set({currentWorkspace:m}),C(),await E()}function ce(t,e,o){const s=document.querySelector(".workspace-context-menu");s&&s.remove();const n=document.createElement("div");n.className="workspace-context-menu",n.style.position="fixed",n.style.left=`${t.clientX}px`,n.style.top=`${t.clientY}px`,n.style.background="white",n.style.border="1px solid #ddd",n.style.borderRadius="6px",n.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",n.style.zIndex="10000",n.style.minWidth="120px",n.style.overflow="hidden";const c=document.createElement("div");if(c.className="context-menu-item",c.textContent="修改",c.style.padding="8px 12px",c.style.cursor="pointer",c.style.fontSize="14px",c.style.borderBottom="1px solid #eee",c.addEventListener("mouseenter",()=>{c.style.background="#f5f5f5"}),c.addEventListener("mouseleave",()=>{c.style.background="white"}),c.addEventListener("click",()=>{ie(e),n.remove()}),e.id!=="default"){const a=document.createElement("div");a.className="context-menu-item",a.textContent="删除",a.style.padding="8px 12px",a.style.cursor="pointer",a.style.fontSize="14px",a.style.color="#dc3545",a.addEventListener("mouseenter",()=>{a.style.background="#f5f5f5"}),a.addEventListener("mouseleave",()=>{a.style.background="white"}),a.addEventListener("click",()=>{re(e),n.remove()}),n.appendChild(c),n.appendChild(a)}else n.appendChild(c);document.body.appendChild(n);const r=a=>{n.contains(a.target)||(n.remove(),document.removeEventListener("click",r))};setTimeout(()=>{document.addEventListener("click",r)},0)}function ie(t){const e=i("add-workspace-modal"),o=i("workspace-name");if(!e||!o){console.error("工作区编辑元素未找到");return}o.value=t.name,document.querySelectorAll(".icon-option").forEach(c=>{c.classList.remove("selected"),c.dataset.icon===t.icon&&c.classList.add("selected")}),e.setAttribute("data-edit-mode","true"),e.setAttribute("data-edit-workspace",JSON.stringify(t));const n=e.querySelector("h3");n&&(n.textContent="修改工作区"),e.classList.add("active")}function re(t){if(t.id==="default"){alert("默认工作区不能删除");return}confirm(`确定要删除工作区"${t.name}"吗？
删除后该工作区的所有书签也会被删除。`)&&(t.id===m&&(m="default"),delete l[t.id],typeof chrome<"u"&&chrome.storage?chrome.storage.sync.set({workspaces:l,currentWorkspace:m},()=>{console.log("工作区已删除:",t.name),C(),E()}):(console.log("工作区已删除:",t.name),C(),E()))}async function E(){const t=i("bookmarks");if(!t){console.error("书签容器元素未找到");return}if(t.innerHTML="",!l||!m){console.log("工作区数据尚未加载，跳过书签初始化");return}const e=l[m];if(!e){console.error("当前工作区不存在:",m);return}if(e.bookmarks&&e.bookmarks.length>0){const c=e.bookmarks;for(const r of c)V(r).then(a=>{t.appendChild(a)})}else if(m==="default"){const c=[{title:"百度",url:"https://www.baidu.com"},{title:"微博",url:"https://weibo.com"},{title:"知乎",url:"https://www.zhihu.com"},{title:"Bilibili",url:"https://www.bilibili.com"},{title:"腾讯视频",url:"https://v.qq.com"},{title:"淘宝",url:"https://www.taobao.com"}],r=l[m];if(r){r.bookmarks=c,typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.set({workspaces:l});for(const a of c)V(a).then(b=>{t.appendChild(b)})}}const o=ue(),n=(t.children.length+1)*.1;o.style.animationDelay=`${n}s`,t.appendChild(o)}function ae(t,e,o){const s=document.querySelector(".bookmark-context-menu");s&&s.remove();const n=document.createElement("div");n.className="bookmark-context-menu",n.style.position="fixed",n.style.left=`${t.clientX}px`,n.style.top=`${t.clientY}px`,n.style.background="white",n.style.border="1px solid #ddd",n.style.borderRadius="6px",n.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",n.style.zIndex="10000",n.style.minWidth="120px",n.style.overflow="hidden";const c=document.createElement("div");c.className="context-menu-item",c.textContent="修改",c.style.padding="8px 12px",c.style.cursor="pointer",c.style.fontSize="14px",c.style.borderBottom="1px solid #eee",c.addEventListener("mouseenter",()=>{c.style.background="#f5f5f5"}),c.addEventListener("mouseleave",()=>{c.style.background="white"}),c.addEventListener("click",()=>{le(e),n.remove()});const r=document.createElement("div");r.className="context-menu-item",r.textContent="删除",r.style.padding="8px 12px",r.style.cursor="pointer",r.style.fontSize="14px",r.style.color="#dc3545",r.addEventListener("mouseenter",()=>{r.style.background="#f5f5f5"}),r.addEventListener("mouseleave",()=>{r.style.background="white"}),r.addEventListener("click",()=>{de(e,o),n.remove()}),n.appendChild(c),n.appendChild(r),document.body.appendChild(n);const a=b=>{n.contains(b.target)||(n.remove(),document.removeEventListener("click",a))};setTimeout(()=>{document.addEventListener("click",a)},0)}function le(t){const e=i("add-bookmark-modal"),o=i("bookmark-title"),s=i("bookmark-url"),n=i("bookmark-description");if(!e||!o||!s){console.error("书签编辑元素未找到");return}o.value=t.title,s.value=t.url,n&&t.description&&(n.value=t.description),e.setAttribute("data-edit-mode","true"),e.setAttribute("data-edit-bookmark",JSON.stringify(t)),e.classList.add("active")}function de(t,e){if(!confirm(`确定要删除书签"${t.title}"吗？`))return;const o=l[m];if(o&&o.bookmarks){const s=o.bookmarks.findIndex(n=>n.title===t.title&&n.url===t.url);s!==-1&&(o.bookmarks.splice(s,1),typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.set({workspaces:l},()=>{console.log("书签已删除:",t.title)}),e.remove())}}async function X(t){const e=new URL(t).hostname,o=[`https://${e}/favicon-32x32.png`,`https://${e}/favicon-96x96.png`,`https://${e}/favicon-192x192.png`,`https://${e}/apple-touch-icon.png`,`https://${e}/apple-touch-icon-180x180.png`,`https://www.google.com/s2/favicons?domain=${e}&sz=32`,`https://${e}/favicon.ico`];for(const s of o)try{if(await Y(s))return s}catch{continue}return""}function Y(t){return new Promise(e=>{const o=new Image;o.onload=()=>{o.width>=16&&o.height>=16?e(!0):e(!1)},o.onerror=()=>e(!1),o.src=t,setTimeout(()=>e(!1),3e3)})}async function V(t){const e=document.createElement("a");e.href=t.url,e.className="bookmark-item",t.description?e.title=`${t.title}
${t.description}`:e.title=t.title;const o=document.createElement("div");o.className="bookmark-icon";function s(){o.innerHTML="",o.style.background="#6c757d",o.style.color="white",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.fontSize="1.2rem",o.style.fontWeight="bold",o.textContent=t.title.charAt(0).toUpperCase()}function n(r){const a=document.createElement("img");a.src=r,a.alt=t.title,a.style.width="100%",a.style.height="100%",a.style.objectFit="cover",a.onerror=()=>{s()},o.innerHTML="",o.style.background="",o.style.color="",o.style.fontSize="",o.style.fontWeight="",o.appendChild(a)}s();const c=document.createElement("div");return c.className="bookmark-title",c.textContent=t.title,e.appendChild(o),e.appendChild(c),e.addEventListener("contextmenu",r=>{r.preventDefault(),ae(r,t,e)}),(async()=>{try{let r="";t.icon&&await Y(t.icon)&&(r=t.icon),r||(r=await X(t.url)),r&&n(r)}catch(r){console.warn("获取书签图标失败:",t.title,r)}})(),e}function ue(){const t=document.createElement("div");t.className="add-bookmark-item",t.id="add-bookmark";const e=document.createElement("div");e.className="add-bookmark-icon",e.textContent="+";const o=document.createElement("div");return o.className="add-bookmark-title",o.textContent="添加链接",t.appendChild(e),t.appendChild(o),t.addEventListener("click",()=>{const s=i("add-bookmark-modal");s&&s.classList.add("active")}),t}function me(){console.log("侧边栏初始化")}function fe(){const t=i("add-workspace"),e=i("add-workspace-modal"),o=i("add-workspace-form"),s=i("cancel-workspace"),n=i("add-bookmark-modal"),c=i("add-bookmark-form"),r=i("cancel-bookmark");t&&e&&t.addEventListener("click",()=>{console.log("点击添加工作区按钮"),e.classList.add("active")}),s&&e&&o&&s.addEventListener("click",()=>{e.classList.remove("active"),o.reset(),O(),e.removeAttribute("data-edit-mode"),e.removeAttribute("data-edit-workspace");const u=e.querySelector("h3");u&&(u.textContent="添加新工作区")}),e&&o&&e.addEventListener("click",u=>{if(u.target===e){e.classList.remove("active"),o.reset(),O(),e.removeAttribute("data-edit-mode"),e.removeAttribute("data-edit-workspace");const h=e.querySelector("h3");h&&(h.textContent="添加新工作区")}});const a=document.querySelectorAll(".icon-option");a.forEach(u=>{u.addEventListener("click",()=>{a.forEach(h=>h.classList.remove("selected")),u.classList.add("selected")})}),o&&o.addEventListener("submit",u=>{u.preventDefault();const h=i("workspace-name"),y=document.querySelector(".icon-option.selected");if(!h||!y||!e){alert("请填写工作区名称并选择图标");return}const v=h.value.trim();if(!v){alert("请填写工作区名称");return}const k=y.dataset.icon||"📁",B=e.getAttribute("data-edit-mode")==="true",x=e.getAttribute("data-edit-workspace");if(B&&x)try{const g=JSON.parse(x);if(l[g.id]){const L=l[g.id];L&&(L.name=v,L.icon=k),console.log("工作区已更新:",v)}else{alert("找不到要编辑的工作区");return}}catch(g){console.error("解析编辑工作区数据失败:",g),alert("编辑工作区数据错误");return}else{const g="workspace_"+Date.now();l[g]={id:g,name:v,icon:k,bookmarks:[]},console.log("新工作区已添加:",v)}if(typeof chrome<"u"&&chrome.storage)chrome.storage.sync.set({workspaces:l},()=>{C(),e.classList.remove("active"),o.reset(),O(),e.removeAttribute("data-edit-mode"),e.removeAttribute("data-edit-workspace");const g=e.querySelector("h3");g&&(g.textContent="添加新工作区")});else{C(),e.classList.remove("active"),o.reset(),O(),e.removeAttribute("data-edit-mode"),e.removeAttribute("data-edit-workspace");const g=e.querySelector("h3");g&&(g.textContent="添加新工作区")}}),r&&n&&c&&r.addEventListener("click",()=>{n.classList.remove("active"),c.reset(),n.removeAttribute("data-edit-mode"),n.removeAttribute("data-edit-bookmark")}),n&&c&&n.addEventListener("click",u=>{u.target===n&&(n.classList.remove("active"),c.reset(),n.removeAttribute("data-edit-mode"),n.removeAttribute("data-edit-bookmark"))}),c&&c.addEventListener("submit",u=>{u.preventDefault();const h=i("bookmark-title"),y=i("bookmark-url"),v=i("bookmark-description");if(!h||!y||!n){alert("请填写完整的书签信息");return}const k=h.value.trim(),B=y.value.trim(),x=v?.value.trim()||"";if(!k||!B){alert("请填写书签标题和URL");return}const g=n.getAttribute("data-edit-mode")==="true",L=n.getAttribute("data-edit-bookmark"),A=l[m];if(!A){alert("当前工作区不存在");return}if(g&&L)try{const I=JSON.parse(L),F=A.bookmarks.findIndex(J=>J.title===I.title&&J.url===I.url);if(F!==-1)A.bookmarks[F]={title:k,url:B,...x&&{description:x}},console.log("书签已更新:",k);else{alert("找不到要编辑的书签");return}}catch(I){console.error("解析编辑书签数据失败:",I),alert("编辑书签数据错误");return}else{const I={title:k,url:B,...x&&{description:x}};A.bookmarks.push(I),console.log("新书签已添加:",k)}typeof chrome<"u"&&chrome.storage?chrome.storage.sync.set({workspaces:l},async()=>{await E(),n.classList.remove("active"),c.reset(),n.removeAttribute("data-edit-mode"),n.removeAttribute("data-edit-bookmark")}):(async()=>(await E(),n.classList.remove("active"),c.reset(),n.removeAttribute("data-edit-mode"),n.removeAttribute("data-edit-bookmark")))()});const b=i("settings-btn"),d=i("settings-modal"),f=i("cancel-settings"),p=i("save-settings"),S=i("reset-settings"),T=i("close-settings");b&&d&&b.addEventListener("click",()=>{console.log("点击设置按钮"),q(),d.classList.add("active")}),T&&d&&T.addEventListener("click",()=>{d.classList.remove("active")}),f&&d&&f.addEventListener("click",()=>{d.classList.remove("active")}),d&&d.addEventListener("click",u=>{u.target===d&&d.classList.remove("active")});const H=d?.querySelector(".settings-modal-content");H&&H.addEventListener("click",u=>{u.stopPropagation()});const R=document.querySelectorAll(".tab-btn"),ee=document.querySelectorAll(".tab-content");R.forEach(u=>{u.addEventListener("click",()=>{const h=u,y=h.dataset.tab;if(!y)return;R.forEach(k=>k.classList.remove("active")),ee.forEach(k=>k.classList.remove("active")),h.classList.add("active");const v=document.getElementById(`${y}-tab`);v&&v.classList.add("active")})});const z=document.querySelectorAll(".theme-option");z.forEach(u=>{u.addEventListener("click",()=>{z.forEach(h=>h.classList.remove("active")),u.classList.add("active")})}),p&&d&&p.addEventListener("click",()=>{ke(),d.classList.remove("active")}),S&&S.addEventListener("click",()=>{confirm("确定要重置所有设置吗？这将恢复默认设置。")&&ye()});const U=i("export-config"),G=i("import-config"),M=i("import-file");U&&U.addEventListener("click",()=>{be()}),G&&M&&(G.addEventListener("click",()=>{M.click()}),M.addEventListener("change",u=>{const h=u.target,y=h.files?.[0];y&&(ve(y),h.value="")})),console.log("模态框初始化完成")}function O(){document.querySelectorAll(".icon-option").forEach(e=>{e.classList.remove("selected")})}function he(){console.log("底边栏图标初始化");const t=[{title:"百度",url:"https://www.baidu.com",emoji:"🔍"},{title:"微博",url:"https://weibo.com",emoji:"📱"},{title:"知乎",url:"https://www.zhihu.com",emoji:"💭"},{title:"Bilibili",url:"https://www.bilibili.com",emoji:"📺"},{title:"GitHub",url:"https://github.com",emoji:"💻"},{title:"淘宝",url:"https://www.taobao.com",emoji:"🛒"},{title:"网易云音乐",url:"https://music.163.com",emoji:"🎵"},{title:"QQ邮箱",url:"https://mail.qq.com",emoji:"📧"}],e=document.querySelector(".fixed-links");if(!e){console.error("固定链接容器未找到");return}e.innerHTML="";for(const o of t)ge(o).then(s=>{e.appendChild(s)})}async function ge(t){const e=document.createElement("a");e.href=t.url,e.className="fixed-link",e.title=t.title,e.setAttribute("data-emoji",t.emoji);function o(){e.innerHTML="",e.textContent=t.title.charAt(0).toUpperCase(),e.style.fontSize="1.8rem",e.style.color="white",e.style.textShadow="0 2px 4px rgba(0, 0, 0, 0.3)",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.fontWeight="bold"}function s(n){const c=document.createElement("img");c.src=n,c.alt=t.title,c.style.width="100%",c.style.height="100%",c.style.objectFit="cover",c.onerror=()=>{o()},e.innerHTML="",e.style.fontSize="",e.style.color="",e.style.textShadow="",e.style.fontWeight="",e.appendChild(c)}return o(),(async()=>{try{const n=await X(t.url);n&&s(n)}catch(n){console.warn("获取快速链接图标失败:",t.title,n)}})(),e}function pe(){let t=0,e;const o=i("anime-bg-1"),s=i("anime-bg-2"),n=i("bg-switch-btn");if(!o||!s){console.error("背景元素未找到");return}typeof chrome<"u"&&chrome.storage?chrome.storage.sync.get(["currentBackgroundIndex","autoChangeBackground"],d=>{t=d.currentBackgroundIndex||0;const f=d.autoChangeBackground!==!1;c(t),f&&a()}):(c(0),a()),n&&n.addEventListener("click",()=>{r()});function c(d){if(d>=0&&d<N.length){const f=N[d];if(!f){console.error("背景数据不存在，索引:",d);return}const p=new Image;p.onload=()=>{if(o&&s){const S=o.style.opacity==="0"?o:s,T=S===o?s:o;S.style.backgroundImage=`url(${f.url})`,S.style.opacity="1",T.style.opacity="0"}console.log("背景已切换到:",f.name)},p.onerror=()=>{console.error("背景图片加载失败:",f.url),r()},p.src=f.url}}function r(){t=(t+1)%N.length,c(t),typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.set({currentBackgroundIndex:t}),e&&(clearInterval(e),a())}function a(){e=window.setInterval(()=>{r()},3e4)}function b(){e&&clearInterval(e)}document.addEventListener("visibilitychange",()=>{document.hidden?b():a()}),console.log("动漫背景初始化完成，共",N.length,"张背景图片")}function q(){typeof chrome<"u"&&chrome.storage?chrome.storage.sync.get(["autoChangeBackground","backgroundInterval","showClock","showDate","theme","searchEngine","searchSuggestions","openInNewTab"],t=>{const e=i("auto-change-background");e&&(e.checked=t.autoChangeBackground!==!1);const o=i("background-interval");o&&(o.value=String(t.backgroundInterval||30));const s=i("show-clock");s&&(s.checked=t.showClock!==!1);const n=i("show-date");n&&(n.checked=t.showDate!==!1);const c=t.theme||"auto";document.querySelectorAll(".theme-option").forEach(p=>{const S=p;p.classList.remove("active"),S.dataset.theme===c&&p.classList.add("active")});const a=t.searchEngine||"baidu";document.querySelectorAll('input[name="search-engine"]').forEach(p=>{p.checked=p.value===a});const d=i("search-suggestions");d&&(d.checked=t.searchSuggestions!==!1);const f=i("open-in-new-tab");f&&(f.checked=t.openInNewTab!==!1)}):console.log("本地测试环境，使用默认设置")}function ke(){const t=i("auto-change-background"),e=i("background-interval"),o=i("show-clock"),s=i("show-date"),n=i("search-suggestions"),c=i("open-in-new-tab"),a=document.querySelector(".theme-option.active")?.dataset.theme||"auto",d=document.querySelector('input[name="search-engine"]:checked')?.value||"baidu",f={autoChangeBackground:t?.checked!==!1,backgroundInterval:parseInt(e?.value||"30"),showClock:o?.checked!==!1,showDate:s?.checked!==!1,theme:a,searchEngine:d,searchSuggestions:n?.checked!==!1,openInNewTab:c?.checked!==!1};typeof chrome<"u"&&chrome.storage?chrome.storage.sync.set(f,()=>{console.log("设置已保存:",f),alert("设置已保存！"),D(f)}):(console.log("本地测试环境，设置已保存:",f),alert("设置已保存！"),D(f))}function ye(){const t={autoChangeBackground:!0,backgroundInterval:30,showClock:!0,showDate:!0,theme:"auto",searchEngine:"baidu",searchSuggestions:!0,openInNewTab:!0};typeof chrome<"u"&&chrome.storage?chrome.storage.sync.set(t,()=>{console.log("设置已重置为默认值"),alert("设置已重置为默认值！"),q(),D(t)}):(console.log("本地测试环境，设置已重置为默认值"),alert("设置已重置为默认值！"),q(),D(t))}function D(t){const e=i("clock"),o=i("date");if(e&&(e.style.display=t.showClock===!1?"none":"block"),o&&(o.style.display=t.showDate===!1?"none":"block"),t.searchEngine){const s=i("search-input");if(s){const n=W[t.searchEngine];s.placeholder=n.placeholder}}console.log("设置已应用:",t)}function be(){try{const t={workspaces:l,currentWorkspace:m,exportTime:new Date().toISOString(),version:"1.0.0"};typeof chrome<"u"&&chrome.storage?chrome.storage.sync.get(["autoChangeBackground","backgroundInterval","showClock","showDate","theme","searchEngine","searchSuggestions","openInNewTab"],e=>{t.settings=e,Q(t)}):Q(t)}catch(t){console.error("导出配置失败:",t),alert("导出配置失败，请重试。")}}function Q(t){const e=JSON.stringify(t,null,2),o=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(o),n=document.createElement("a");n.href=s,n.download=`mytab-config-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s),console.log("配置已导出"),alert("配置导出成功！")}function ve(t){const e=new FileReader;e.onload=o=>{try{const s=o.target?.result,n=JSON.parse(s);if(!we(n)){alert("配置文件格式不正确，请选择有效的配置文件。");return}const c=Ee();if(!confirm(c==="replace"?"确定要覆盖当前配置吗？这将删除所有现有的工作区和书签。":"确定要合并配置吗？重复的书签将被自动去除。"))return;c==="replace"?Se(n):Ce(n)}catch(s){console.error("导入配置失败:",s),alert("配置文件解析失败，请检查文件格式。")}},e.readAsText(t)}function we(t){return t&&typeof t=="object"&&t.workspaces&&typeof t.workspaces=="object"&&typeof t.currentWorkspace=="string"&&typeof t.version=="string"}function Ee(){return document.querySelector('input[name="import-mode"]:checked')?.value||"replace"}function Se(t){l=t.workspaces,m=t.currentWorkspace,l[m]||(m=Object.keys(l)[0]||"default"),K(t,()=>{C(),E(),alert("配置导入成功！页面将刷新以应用新配置。"),setTimeout(()=>{window.location.reload()},1e3)})}function Ce(t){Object.keys(t.workspaces).forEach(e=>{const o=t.workspaces[e];if(o)if(l[e]){const s=l[e].bookmarks,n=o.bookmarks,c=[...s],r=new Set(s.map(a=>a.url));n.forEach(a=>{r.has(a.url)||c.push(a)}),l[e].bookmarks=c}else l[e]={...o}}),K(t,()=>{C(),E(),alert("配置合并成功！")})}function K(t,e){if(typeof chrome<"u"&&chrome.storage){const o={workspaces:l,currentWorkspace:m};t.settings&&Object.assign(o,t.settings),chrome.storage.sync.set(o,e)}else console.log("本地测试环境，配置已保存"),e()}function xe(){const t=i("github-sync-enabled"),e=i("test-connection"),o=i("sync-now");t&&(t.addEventListener("change",Le),Z()),e&&e.addEventListener("click",Ie),o&&o.addEventListener("click",Be)}function Le(){const t=i("github-sync-enabled"),e=i("github-sync-config");if(!t||!e)return;t.checked?(e.style.display="block",Z()):(e.style.display="none",typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.set({githubSync:{enabled:!1}}))}function Z(){typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.get(["githubSync"],t=>{const e=t.githubSync;if(e){const o=i("github-sync-enabled"),s=i("github-token"),n=i("github-sync-config");o&&(o.checked=e.enabled),s&&(s.value=e.token||""),e.enabled&&n?(n.style.display="block",w("idle","已启用GitHub同步")):n&&(n.style.display="none")}})}async function Ie(){const t=i("github-token");if(!t)return;const e=t.value.trim();if(!e){w("error","请输入GitHub Token");return}try{w("syncing","正在测试连接...");const s=await new $({auth:e}).rest.users.getAuthenticated();w("success",`连接成功，用户: ${s.data.login}`),typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.set({githubSync:{token:e,enabled:!0}})}catch(o){w("error",`连接失败: ${o.message}`)}}async function Be(){const t=i("github-token");if(!t)return;const e=t.value.trim();if(!e){w("error","请先设置GitHub Token");return}try{w("syncing","正在同步...");const o=await Te(),s=await Ae(e);if(!s){w("error","创建gist失败");return}await Ne(e,s,o),w("success","同步完成")}catch(o){w("error",`同步失败: ${o.message}`)}}async function Te(){return new Promise(t=>{typeof chrome<"u"&&chrome.storage?chrome.storage.sync.get(["bookmarks","searchEngine","theme","workspaces","currentWorkspace"],e=>{t({bookmarks:e.bookmarks||[],searchEngine:e.searchEngine||"baidu",theme:e.theme||"light",workspaces:e.workspaces||l,currentWorkspace:e.currentWorkspace||m,lastSync:new Date().toISOString()})}):t({bookmarks:[],searchEngine:"baidu",theme:"light",workspaces:l,currentWorkspace:m,lastSync:new Date().toISOString()})})}async function Ae(t){const e=new $({auth:t}),n=(await e.rest.gists.list()).data.find(r=>r.files&&"mytab-config.json"in r.files);return n?n.id:(await e.rest.gists.create({description:"MyTab Extension Configuration",public:!1,files:{"mytab-config.json":{content:JSON.stringify({bookmarks:[],searchEngine:"baidu",theme:"light",workspaces:{},currentWorkspace:"default"},null,2)}}})).data.id||null}async function Ne(t,e,o){const s=new $({auth:t}),c=(await s.rest.gists.get({gist_id:e})).data.files["mytab-config.json"]?.content;let r;c?r=JSON.parse(c):r=o;const a=Oe(o,r);typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.set({bookmarks:a.bookmarks,searchEngine:a.searchEngine,theme:a.theme,workspaces:a.workspaces,currentWorkspace:a.currentWorkspace,githubSync:{token:t,enabled:!0,gistId:e}}),l=a.workspaces,m=a.currentWorkspace,await s.rest.gists.update({gist_id:e,files:{"mytab-config.json":{content:JSON.stringify(a,null,2)}}}),await j(),await E(),We()}function Oe(t,e){const o=new Date(t.lastSync||"1970-01-01").getTime(),s=new Date(e.lastSync||"1970-01-01").getTime();return o>s?{...t,lastSync:new Date().toISOString()}:{...e,lastSync:new Date().toISOString()}}function w(t,e){const o=i("sync-status-text");o&&(o.textContent=e,o.className=`sync-status-${t}`);const s=i("test-connection"),n=i("sync-now");t==="syncing"?(s&&(s.disabled=!0),n&&(n.disabled=!0)):(s&&(s.disabled=!1),n&&(n.disabled=!1))}function We(){const t=i("last-sync-time");if(t){const e=new Date;t.textContent=`最后同步: ${e.toLocaleString("zh-CN")}`}}
//# sourceMappingURL=newtab.js.map
