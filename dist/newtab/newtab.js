import{O as q}from"../chunks/index-C7sbpHLK.js";let l={},u="default";function i(t){return document.getElementById(t)}const O={baidu:{name:"ç™¾åº¦",url:"https://www.baidu.com/s?wd=",placeholder:"ç™¾åº¦ä¸€ä¸‹ï¼Œä½ å°±çŸ¥é“"},google:{name:"Google",url:"https://www.google.com/search?q=",placeholder:"Search Google"},bing:{name:"Bing",url:"https://www.bing.com/search?q=",placeholder:"Search Bing"}},W=[{url:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=1920&h=1080&fit=crop",name:"æ˜Ÿç©ºå¤œæ™¯"},{url:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop",name:"å±±è„‰é£å…‰"},{url:"https://images.unsplash.com/photo-1519904981063-b0cf448d479e?w=1920&h=1080&fit=crop",name:"åŸå¸‚å¤œæ™¯"},{url:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop",name:"è‡ªç„¶é£æ™¯"},{url:"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1920&h=1080&fit=crop",name:"æ£®æ—å°å¾„"},{url:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop",name:"æµ·æ´‹æ³¢æµª"},{url:"https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=1920&h=1080&fit=crop",name:"æ¨±èŠ±ç››å¼€"},{url:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop",name:"é›ªå±±æ™¯è‰²"}];document.addEventListener("DOMContentLoaded",async()=>{console.log("é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...");try{J(),setInterval(J,1e3),console.log("æ—¶é’Ÿåˆå§‹åŒ–å®Œæˆ"),ee(),console.log("æœç´¢åˆå§‹åŒ–å®Œæˆ"),ue(),console.log("ä¾§è¾¹æ åˆå§‹åŒ–å®Œæˆ"),me(),console.log("æ¨¡æ€æ¡†åˆå§‹åŒ–å®Œæˆ"),xe(),console.log("GitHubåŒæ­¥åˆå§‹åŒ–å®Œæˆ"),fe(),console.log("åº•è¾¹æ å›¾æ ‡åˆå§‹åŒ–å¼€å§‹"),oe(),console.log("å·¥ä½œåŒºåˆå§‹åŒ–å®Œæˆ"),he(),console.log("åŠ¨æ¼«èƒŒæ™¯åˆå§‹åŒ–å®Œæˆ")}catch(t){console.error("åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:",t)}});function J(){const t=new Date,e=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0"),s=String(t.getSeconds()).padStart(2,"0"),n=i("clock");n&&(n.textContent=`${e}:${o}:${s}`);const c={weekday:"long",year:"numeric",month:"long",day:"numeric"},r=i("date");r&&(r.textContent=t.toLocaleDateString("zh-CN",c))}function ee(){const t=i("search-input"),e=i("search-form");if(!t||!e){console.error("æœç´¢å…ƒç´ æœªæ‰¾åˆ°");return}typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.get("searchEngine",o=>{const s=o.searchEngine||"baidu",n=O[s];t.placeholder=n.placeholder}),e.addEventListener("submit",o=>{o.preventDefault();const s=t.value.trim();s&&te(s)})}function te(t){if(typeof chrome<"u"&&chrome.storage)chrome.storage.sync.get("searchEngine",e=>{const o=e.searchEngine||"baidu",n=O[o].url+encodeURIComponent(t);window.open(n,"_blank")});else{const e=O.baidu.url+encodeURIComponent(t);window.open(e,"_blank")}}function oe(){typeof chrome<"u"&&chrome.storage?chrome.storage.sync.get(["workspaces","currentWorkspace"],t=>{l=t.workspaces||P(),u=t.currentWorkspace||"default",j()}):(l=P(),u="default",j())}async function j(){E(),await w()}function P(){return{default:{id:"default",name:"é»˜è®¤",bookmarks:[],icon:"ğŸ "},work:{id:"work",name:"å·¥ä½œ",bookmarks:[],icon:"ğŸ’¼"},study:{id:"study",name:"å­¦ä¹ ",bookmarks:[],icon:"ğŸ“š"},entertainment:{id:"entertainment",name:"å¨±ä¹",bookmarks:[],icon:"ğŸ®"}}}function E(){const t=i("workspace-list");if(!t){console.error("workspace-list å…ƒç´ æœªæ‰¾åˆ°");return}t.innerHTML="",Object.values(l).forEach(e=>{const o=document.createElement("div");o.className=`workspace-item ${e.id===u?"active":""}`,o.dataset.workspace=e.id;const s=document.createElement("div");s.className="workspace-icon",s.textContent=e.icon||"ğŸ“";const n=document.createElement("span");n.textContent=e.name,o.appendChild(s),o.appendChild(n),o.addEventListener("click",()=>{console.log("ç‚¹å‡»å·¥ä½œåŒº:",e.id),ne(e.id)}),o.addEventListener("contextmenu",c=>{c.preventDefault(),se(c,e)}),t.appendChild(o)}),console.log("å·¥ä½œåŒºåˆ—è¡¨å·²æ›´æ–°ï¼Œå½“å‰å·¥ä½œåŒº:",u)}async function ne(t){if(!l[t]){console.error("å·¥ä½œåŒºä¸å­˜åœ¨:",t);return}u=t,typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.set({currentWorkspace:u}),E(),await w()}function se(t,e,o){const s=document.querySelector(".workspace-context-menu");s&&s.remove();const n=document.createElement("div");n.className="workspace-context-menu",n.style.position="fixed",n.style.left=`${t.clientX}px`,n.style.top=`${t.clientY}px`,n.style.background="white",n.style.border="1px solid #ddd",n.style.borderRadius="6px",n.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",n.style.zIndex="10000",n.style.minWidth="120px",n.style.overflow="hidden";const c=document.createElement("div");if(c.className="context-menu-item",c.textContent="ä¿®æ”¹",c.style.padding="8px 12px",c.style.cursor="pointer",c.style.fontSize="14px",c.style.borderBottom="1px solid #eee",c.addEventListener("mouseenter",()=>{c.style.background="#f5f5f5"}),c.addEventListener("mouseleave",()=>{c.style.background="white"}),c.addEventListener("click",()=>{ce(e),n.remove()}),e.id!=="default"){const a=document.createElement("div");a.className="context-menu-item",a.textContent="åˆ é™¤",a.style.padding="8px 12px",a.style.cursor="pointer",a.style.fontSize="14px",a.style.color="#dc3545",a.addEventListener("mouseenter",()=>{a.style.background="#f5f5f5"}),a.addEventListener("mouseleave",()=>{a.style.background="white"}),a.addEventListener("click",()=>{ie(e),n.remove()}),n.appendChild(c),n.appendChild(a)}else n.appendChild(c);document.body.appendChild(n);const r=a=>{n.contains(a.target)||(n.remove(),document.removeEventListener("click",r))};setTimeout(()=>{document.addEventListener("click",r)},0)}function ce(t){const e=i("add-workspace-modal"),o=i("workspace-name");if(!e||!o){console.error("å·¥ä½œåŒºç¼–è¾‘å…ƒç´ æœªæ‰¾åˆ°");return}o.value=t.name,document.querySelectorAll(".icon-option").forEach(c=>{c.classList.remove("selected"),c.dataset.icon===t.icon&&c.classList.add("selected")}),e.setAttribute("data-edit-mode","true"),e.setAttribute("data-edit-workspace",JSON.stringify(t));const n=e.querySelector("h3");n&&(n.textContent="ä¿®æ”¹å·¥ä½œåŒº"),e.classList.add("active")}function ie(t){if(t.id==="default"){alert("é»˜è®¤å·¥ä½œåŒºä¸èƒ½åˆ é™¤");return}confirm(`ç¡®å®šè¦åˆ é™¤å·¥ä½œåŒº"${t.name}"å—ï¼Ÿ
åˆ é™¤åè¯¥å·¥ä½œåŒºçš„æ‰€æœ‰ä¹¦ç­¾ä¹Ÿä¼šè¢«åˆ é™¤ã€‚`)&&(t.id===u&&(u="default"),delete l[t.id],typeof chrome<"u"&&chrome.storage?chrome.storage.sync.set({workspaces:l,currentWorkspace:u},()=>{console.log("å·¥ä½œåŒºå·²åˆ é™¤:",t.name),E(),w()}):(console.log("å·¥ä½œåŒºå·²åˆ é™¤:",t.name),E(),w()))}async function w(){const t=i("bookmarks");if(!t){console.error("ä¹¦ç­¾å®¹å™¨å…ƒç´ æœªæ‰¾åˆ°");return}if(t.innerHTML="",!l||!u){console.log("å·¥ä½œåŒºæ•°æ®å°šæœªåŠ è½½ï¼Œè·³è¿‡ä¹¦ç­¾åˆå§‹åŒ–");return}const e=l[u];if(!e){console.error("å½“å‰å·¥ä½œåŒºä¸å­˜åœ¨:",u);return}if(e.bookmarks&&e.bookmarks.length>0){const c=e.bookmarks;for(const r of c)_(r).then(a=>{t.appendChild(a)})}else if(u==="default"){const c=[{title:"ç™¾åº¦",url:"https://www.baidu.com"},{title:"å¾®åš",url:"https://weibo.com"},{title:"çŸ¥ä¹",url:"https://www.zhihu.com"},{title:"Bilibili",url:"https://www.bilibili.com"},{title:"è…¾è®¯è§†é¢‘",url:"https://v.qq.com"},{title:"æ·˜å®",url:"https://www.taobao.com"}],r=l[u];if(r){r.bookmarks=c,typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.set({workspaces:l});for(const a of c)_(a).then(f=>{t.appendChild(f)})}}const o=de(),n=(t.children.length+1)*.1;o.style.animationDelay=`${n}s`,t.appendChild(o)}function re(t,e,o){const s=document.querySelector(".bookmark-context-menu");s&&s.remove();const n=document.createElement("div");n.className="bookmark-context-menu",n.style.position="fixed",n.style.left=`${t.clientX}px`,n.style.top=`${t.clientY}px`,n.style.background="white",n.style.border="1px solid #ddd",n.style.borderRadius="6px",n.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",n.style.zIndex="10000",n.style.minWidth="120px",n.style.overflow="hidden";const c=document.createElement("div");c.className="context-menu-item",c.textContent="ä¿®æ”¹",c.style.padding="8px 12px",c.style.cursor="pointer",c.style.fontSize="14px",c.style.borderBottom="1px solid #eee",c.addEventListener("mouseenter",()=>{c.style.background="#f5f5f5"}),c.addEventListener("mouseleave",()=>{c.style.background="white"}),c.addEventListener("click",()=>{ae(e),n.remove()});const r=document.createElement("div");r.className="context-menu-item",r.textContent="åˆ é™¤",r.style.padding="8px 12px",r.style.cursor="pointer",r.style.fontSize="14px",r.style.color="#dc3545",r.addEventListener("mouseenter",()=>{r.style.background="#f5f5f5"}),r.addEventListener("mouseleave",()=>{r.style.background="white"}),r.addEventListener("click",()=>{le(e,o),n.remove()}),n.appendChild(c),n.appendChild(r),document.body.appendChild(n);const a=f=>{n.contains(f.target)||(n.remove(),document.removeEventListener("click",a))};setTimeout(()=>{document.addEventListener("click",a)},0)}function ae(t){const e=i("add-bookmark-modal"),o=i("bookmark-title"),s=i("bookmark-url"),n=i("bookmark-description");if(!e||!o||!s){console.error("ä¹¦ç­¾ç¼–è¾‘å…ƒç´ æœªæ‰¾åˆ°");return}o.value=t.title,s.value=t.url,n&&t.description&&(n.value=t.description),e.setAttribute("data-edit-mode","true"),e.setAttribute("data-edit-bookmark",JSON.stringify(t)),e.classList.add("active")}function le(t,e){if(!confirm(`ç¡®å®šè¦åˆ é™¤ä¹¦ç­¾"${t.title}"å—ï¼Ÿ`))return;const o=l[u];if(o&&o.bookmarks){const s=o.bookmarks.findIndex(n=>n.title===t.title&&n.url===t.url);s!==-1&&(o.bookmarks.splice(s,1),typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.set({workspaces:l},()=>{console.log("ä¹¦ç­¾å·²åˆ é™¤:",t.title)}),e.remove())}}async function Q(t){const e=new URL(t).hostname,o=[`https://${e}/favicon-32x32.png`,`https://${e}/favicon-96x96.png`,`https://${e}/favicon-192x192.png`,`https://${e}/apple-touch-icon.png`,`https://${e}/apple-touch-icon-180x180.png`,`https://www.google.com/s2/favicons?domain=${e}&sz=32`,`https://${e}/favicon.ico`];for(const s of o)try{if(await X(s))return s}catch{continue}return""}function X(t){return new Promise(e=>{const o=new Image;o.onload=()=>{o.width>=16&&o.height>=16?e(!0):e(!1)},o.onerror=()=>e(!1),o.src=t,setTimeout(()=>e(!1),3e3)})}async function _(t){const e=document.createElement("a");e.href=t.url,e.className="bookmark-item",t.description?e.title=`${t.title}
${t.description}`:e.title=t.title;const o=document.createElement("div");o.className="bookmark-icon";function s(){o.innerHTML="",o.style.background="#6c757d",o.style.color="white",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.fontSize="1.2rem",o.style.fontWeight="bold",o.textContent=t.title.charAt(0).toUpperCase()}function n(r){const a=document.createElement("img");a.src=r,a.alt=t.title,a.style.width="100%",a.style.height="100%",a.style.objectFit="cover",a.onerror=()=>{s()},o.innerHTML="",o.style.background="",o.style.color="",o.style.fontSize="",o.style.fontWeight="",o.appendChild(a)}s();const c=document.createElement("div");return c.className="bookmark-title",c.textContent=t.title,e.appendChild(o),e.appendChild(c),e.addEventListener("contextmenu",r=>{r.preventDefault(),re(r,t,e)}),(async()=>{try{let r="";t.icon&&await X(t.icon)&&(r=t.icon),r||(r=await Q(t.url)),r&&n(r)}catch(r){console.warn("è·å–ä¹¦ç­¾å›¾æ ‡å¤±è´¥:",t.title,r)}})(),e}function de(){const t=document.createElement("div");t.className="add-bookmark-item",t.id="add-bookmark";const e=document.createElement("div");e.className="add-bookmark-icon",e.textContent="+";const o=document.createElement("div");return o.className="add-bookmark-title",o.textContent="æ·»åŠ é“¾æ¥",t.appendChild(e),t.appendChild(o),t.addEventListener("click",()=>{const s=i("add-bookmark-modal");s&&s.classList.add("active")}),t}function ue(){console.log("ä¾§è¾¹æ åˆå§‹åŒ–")}function me(){const t=i("add-workspace"),e=i("add-workspace-modal"),o=i("add-workspace-form"),s=i("cancel-workspace"),n=i("add-bookmark-modal"),c=i("add-bookmark-form"),r=i("cancel-bookmark");t&&e&&t.addEventListener("click",()=>{console.log("ç‚¹å‡»æ·»åŠ å·¥ä½œåŒºæŒ‰é’®"),e.classList.add("active")}),s&&e&&o&&s.addEventListener("click",()=>{e.classList.remove("active"),o.reset(),A(),e.removeAttribute("data-edit-mode"),e.removeAttribute("data-edit-workspace");const m=e.querySelector("h3");m&&(m.textContent="æ·»åŠ æ–°å·¥ä½œåŒº")}),e&&o&&e.addEventListener("click",m=>{if(m.target===e){e.classList.remove("active"),o.reset(),A(),e.removeAttribute("data-edit-mode"),e.removeAttribute("data-edit-workspace");const g=e.querySelector("h3");g&&(g.textContent="æ·»åŠ æ–°å·¥ä½œåŒº")}});const a=document.querySelectorAll(".icon-option");a.forEach(m=>{m.addEventListener("click",()=>{a.forEach(g=>g.classList.remove("selected")),m.classList.add("selected")})}),o&&o.addEventListener("submit",m=>{m.preventDefault();const g=i("workspace-name"),k=document.querySelector(".icon-option.selected");if(!g||!k||!e){alert("è¯·å¡«å†™å·¥ä½œåŒºåç§°å¹¶é€‰æ‹©å›¾æ ‡");return}const b=g.value.trim();if(!b){alert("è¯·å¡«å†™å·¥ä½œåŒºåç§°");return}const p=k.dataset.icon||"ğŸ“",B=e.getAttribute("data-edit-mode")==="true",C=e.getAttribute("data-edit-workspace");if(B&&C)try{const h=JSON.parse(C);if(l[h.id]){const L=l[h.id];L&&(L.name=b,L.icon=p),console.log("å·¥ä½œåŒºå·²æ›´æ–°:",b)}else{alert("æ‰¾ä¸åˆ°è¦ç¼–è¾‘çš„å·¥ä½œåŒº");return}}catch(h){console.error("è§£æç¼–è¾‘å·¥ä½œåŒºæ•°æ®å¤±è´¥:",h),alert("ç¼–è¾‘å·¥ä½œåŒºæ•°æ®é”™è¯¯");return}else{const h="workspace_"+Date.now();l[h]={id:h,name:b,icon:p,bookmarks:[]},console.log("æ–°å·¥ä½œåŒºå·²æ·»åŠ :",b)}if(typeof chrome<"u"&&chrome.storage)chrome.storage.sync.set({workspaces:l},()=>{E(),e.classList.remove("active"),o.reset(),A(),e.removeAttribute("data-edit-mode"),e.removeAttribute("data-edit-workspace");const h=e.querySelector("h3");h&&(h.textContent="æ·»åŠ æ–°å·¥ä½œåŒº")});else{E(),e.classList.remove("active"),o.reset(),A(),e.removeAttribute("data-edit-mode"),e.removeAttribute("data-edit-workspace");const h=e.querySelector("h3");h&&(h.textContent="æ·»åŠ æ–°å·¥ä½œåŒº")}}),r&&n&&c&&r.addEventListener("click",()=>{n.classList.remove("active"),c.reset(),n.removeAttribute("data-edit-mode"),n.removeAttribute("data-edit-bookmark")}),n&&c&&n.addEventListener("click",m=>{m.target===n&&(n.classList.remove("active"),c.reset(),n.removeAttribute("data-edit-mode"),n.removeAttribute("data-edit-bookmark"))}),c&&c.addEventListener("submit",m=>{m.preventDefault();const g=i("bookmark-title"),k=i("bookmark-url"),b=i("bookmark-description");if(!g||!k||!n){alert("è¯·å¡«å†™å®Œæ•´çš„ä¹¦ç­¾ä¿¡æ¯");return}const p=g.value.trim(),B=k.value.trim(),C=b?.value.trim()||"";if(!p||!B){alert("è¯·å¡«å†™ä¹¦ç­¾æ ‡é¢˜å’ŒURL");return}const h=n.getAttribute("data-edit-mode")==="true",L=n.getAttribute("data-edit-bookmark"),N=l[u];if(!N){alert("å½“å‰å·¥ä½œåŒºä¸å­˜åœ¨");return}if(h&&L)try{const I=JSON.parse(L),G=N.bookmarks.findIndex(F=>F.title===I.title&&F.url===I.url);if(G!==-1)N.bookmarks[G]={title:p,url:B,...C&&{description:C}},console.log("ä¹¦ç­¾å·²æ›´æ–°:",p);else{alert("æ‰¾ä¸åˆ°è¦ç¼–è¾‘çš„ä¹¦ç­¾");return}}catch(I){console.error("è§£æç¼–è¾‘ä¹¦ç­¾æ•°æ®å¤±è´¥:",I),alert("ç¼–è¾‘ä¹¦ç­¾æ•°æ®é”™è¯¯");return}else{const I={title:p,url:B,...C&&{description:C}};N.bookmarks.push(I),console.log("æ–°ä¹¦ç­¾å·²æ·»åŠ :",p)}typeof chrome<"u"&&chrome.storage?chrome.storage.sync.set({workspaces:l},async()=>{await w(),n.classList.remove("active"),c.reset(),n.removeAttribute("data-edit-mode"),n.removeAttribute("data-edit-bookmark")}):(async()=>(await w(),n.classList.remove("active"),c.reset(),n.removeAttribute("data-edit-mode"),n.removeAttribute("data-edit-bookmark")))()});const f=i("settings-btn"),d=i("settings-modal"),y=i("cancel-settings"),x=i("save-settings"),S=i("reset-settings"),T=i("close-settings");f&&d&&f.addEventListener("click",()=>{console.log("ç‚¹å‡»è®¾ç½®æŒ‰é’®"),$(),d.classList.add("active")}),T&&d&&T.addEventListener("click",()=>{d.classList.remove("active")}),y&&d&&y.addEventListener("click",()=>{d.classList.remove("active")}),d&&d.addEventListener("click",m=>{m.target===d&&d.classList.remove("active")});const H=d?.querySelector(".settings-modal-content");H&&H.addEventListener("click",m=>{m.stopPropagation()});const R=document.querySelectorAll(".tab-btn"),Z=document.querySelectorAll(".tab-content");R.forEach(m=>{m.addEventListener("click",()=>{const g=m,k=g.dataset.tab;if(!k)return;R.forEach(p=>p.classList.remove("active")),Z.forEach(p=>p.classList.remove("active")),g.classList.add("active");const b=document.getElementById(`${k}-tab`);b&&b.classList.add("active")})}),x&&d&&x.addEventListener("click",()=>{pe(),d.classList.remove("active")}),S&&S.addEventListener("click",()=>{confirm("ç¡®å®šè¦é‡ç½®æ‰€æœ‰è®¾ç½®å—ï¼Ÿè¿™å°†æ¢å¤é»˜è®¤è®¾ç½®ã€‚")&&ke()});const z=i("export-config"),U=i("import-config"),M=i("import-file");z&&z.addEventListener("click",()=>{ye()}),U&&M&&(U.addEventListener("click",()=>{M.click()}),M.addEventListener("change",m=>{const g=m.target,k=g.files?.[0];k&&(be(k),g.value="")})),console.log("æ¨¡æ€æ¡†åˆå§‹åŒ–å®Œæˆ")}function A(){document.querySelectorAll(".icon-option").forEach(e=>{e.classList.remove("selected")})}function fe(){console.log("åº•è¾¹æ å›¾æ ‡åˆå§‹åŒ–");const t=[{title:"ç™¾åº¦",url:"https://www.baidu.com",emoji:"ğŸ”"},{title:"å¾®åš",url:"https://weibo.com",emoji:"ğŸ“±"},{title:"çŸ¥ä¹",url:"https://www.zhihu.com",emoji:"ğŸ’­"},{title:"Bilibili",url:"https://www.bilibili.com",emoji:"ğŸ“º"},{title:"GitHub",url:"https://github.com",emoji:"ğŸ’»"},{title:"æ·˜å®",url:"https://www.taobao.com",emoji:"ğŸ›’"},{title:"ç½‘æ˜“äº‘éŸ³ä¹",url:"https://music.163.com",emoji:"ğŸµ"},{title:"QQé‚®ç®±",url:"https://mail.qq.com",emoji:"ğŸ“§"}],e=document.querySelector(".fixed-links");if(!e){console.error("å›ºå®šé“¾æ¥å®¹å™¨æœªæ‰¾åˆ°");return}e.innerHTML="";for(const o of t)ge(o).then(s=>{e.appendChild(s)})}async function ge(t){const e=document.createElement("a");e.href=t.url,e.className="fixed-link",e.title=t.title,e.setAttribute("data-emoji",t.emoji);function o(){e.innerHTML="",e.textContent=t.title.charAt(0).toUpperCase(),e.style.fontSize="1.8rem",e.style.color="white",e.style.textShadow="0 2px 4px rgba(0, 0, 0, 0.3)",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.fontWeight="bold"}function s(n){const c=document.createElement("img");c.src=n,c.alt=t.title,c.style.width="100%",c.style.height="100%",c.style.objectFit="cover",c.onerror=()=>{o()},e.innerHTML="",e.style.fontSize="",e.style.color="",e.style.textShadow="",e.style.fontWeight="",e.appendChild(c)}return o(),(async()=>{try{const n=await Q(t.url);n&&s(n)}catch(n){console.warn("è·å–å¿«é€Ÿé“¾æ¥å›¾æ ‡å¤±è´¥:",t.title,n)}})(),e}function he(){let t=0,e;const o=i("anime-bg-1"),s=i("anime-bg-2"),n=i("bg-switch-btn");if(!o||!s){console.error("èƒŒæ™¯å…ƒç´ æœªæ‰¾åˆ°");return}typeof chrome<"u"&&chrome.storage?chrome.storage.sync.get(["currentBackgroundIndex","autoChangeBackground"],d=>{t=d.currentBackgroundIndex||0;const y=d.autoChangeBackground!==!1;c(t),y&&a()}):(c(0),a()),n&&n.addEventListener("click",()=>{r()});function c(d){if(d>=0&&d<W.length){const y=W[d];if(!y){console.error("èƒŒæ™¯æ•°æ®ä¸å­˜åœ¨ï¼Œç´¢å¼•:",d);return}const x=new Image;x.onload=()=>{if(o&&s){const S=o.style.opacity==="0"?o:s,T=S===o?s:o;S.style.backgroundImage=`url(${y.url})`,S.style.opacity="1",T.style.opacity="0"}console.log("èƒŒæ™¯å·²åˆ‡æ¢åˆ°:",y.name)},x.onerror=()=>{console.error("èƒŒæ™¯å›¾ç‰‡åŠ è½½å¤±è´¥:",y.url),r()},x.src=y.url}}function r(){t=(t+1)%W.length,c(t),typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.set({currentBackgroundIndex:t}),e&&(clearInterval(e),a())}function a(){e=window.setInterval(()=>{r()},3e4)}function f(){e&&clearInterval(e)}document.addEventListener("visibilitychange",()=>{document.hidden?f():a()}),console.log("åŠ¨æ¼«èƒŒæ™¯åˆå§‹åŒ–å®Œæˆï¼Œå…±",W.length,"å¼ èƒŒæ™¯å›¾ç‰‡")}function $(){typeof chrome<"u"&&chrome.storage?chrome.storage.sync.get(["autoChangeBackground","backgroundInterval","showClock","showDate","searchEngine","searchSuggestions","openInNewTab"],t=>{const e=i("auto-change-background");e&&(e.checked=t.autoChangeBackground!==!1);const o=i("background-interval");o&&(o.value=String(t.backgroundInterval||30));const s=i("show-clock");s&&(s.checked=t.showClock!==!1);const n=i("show-date");n&&(n.checked=t.showDate!==!1);const c=t.searchEngine||"baidu";document.querySelectorAll('input[name="search-engine"]').forEach(d=>{d.checked=d.value===c});const a=i("search-suggestions");a&&(a.checked=t.searchSuggestions!==!1);const f=i("open-in-new-tab");f&&(f.checked=t.openInNewTab!==!1)}):console.log("æœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®")}function pe(){const t=i("auto-change-background"),e=i("background-interval"),o=i("show-clock"),s=i("show-date"),n=i("search-suggestions"),c=i("open-in-new-tab"),a=document.querySelector('input[name="search-engine"]:checked')?.value||"baidu",f={autoChangeBackground:t?.checked!==!1,backgroundInterval:parseInt(e?.value||"30"),showClock:o?.checked!==!1,showDate:s?.checked!==!1,searchEngine:a,searchSuggestions:n?.checked!==!1,openInNewTab:c?.checked!==!1};typeof chrome<"u"&&chrome.storage?chrome.storage.sync.set(f,()=>{console.log("è®¾ç½®å·²ä¿å­˜:",f),alert("è®¾ç½®å·²ä¿å­˜ï¼"),D(f)}):(console.log("æœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼Œè®¾ç½®å·²ä¿å­˜:",f),alert("è®¾ç½®å·²ä¿å­˜ï¼"),D(f))}function ke(){const t={autoChangeBackground:!0,backgroundInterval:30,showClock:!0,showDate:!0,searchEngine:"baidu",searchSuggestions:!0,openInNewTab:!0};typeof chrome<"u"&&chrome.storage?chrome.storage.sync.set(t,()=>{console.log("è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼"),alert("è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼ï¼"),$(),D(t)}):(console.log("æœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼Œè®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼"),alert("è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼ï¼"),$(),D(t))}function D(t){const e=i("clock"),o=i("date");if(e&&(e.style.display=t.showClock===!1?"none":"block"),o&&(o.style.display=t.showDate===!1?"none":"block"),t.searchEngine){const s=i("search-input");if(s){const n=O[t.searchEngine];s.placeholder=n.placeholder}}console.log("è®¾ç½®å·²åº”ç”¨:",t)}function ye(){try{const t={workspaces:l,currentWorkspace:u,exportTime:new Date().toISOString(),version:"1.0.0"};typeof chrome<"u"&&chrome.storage?chrome.storage.sync.get(["autoChangeBackground","backgroundInterval","showClock","showDate","theme","searchEngine","searchSuggestions","openInNewTab"],e=>{t.settings=e,V(t)}):V(t)}catch(t){console.error("å¯¼å‡ºé…ç½®å¤±è´¥:",t),alert("å¯¼å‡ºé…ç½®å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚")}}function V(t){const e=JSON.stringify(t,null,2),o=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(o),n=document.createElement("a");n.href=s,n.download=`mytab-config-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s),console.log("é…ç½®å·²å¯¼å‡º"),alert("é…ç½®å¯¼å‡ºæˆåŠŸï¼")}function be(t){const e=new FileReader;e.onload=o=>{try{const s=o.target?.result,n=JSON.parse(s);if(!ve(n)){alert("é…ç½®æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é€‰æ‹©æœ‰æ•ˆçš„é…ç½®æ–‡ä»¶ã€‚");return}const c=we();if(!confirm(c==="replace"?"ç¡®å®šè¦è¦†ç›–å½“å‰é…ç½®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰ç°æœ‰çš„å·¥ä½œåŒºå’Œä¹¦ç­¾ã€‚":"ç¡®å®šè¦åˆå¹¶é…ç½®å—ï¼Ÿé‡å¤çš„ä¹¦ç­¾å°†è¢«è‡ªåŠ¨å»é™¤ã€‚"))return;c==="replace"?Ee(n):Ce(n)}catch(s){console.error("å¯¼å…¥é…ç½®å¤±è´¥:",s),alert("é…ç½®æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ã€‚")}},e.readAsText(t)}function ve(t){return t&&typeof t=="object"&&t.workspaces&&typeof t.workspaces=="object"&&typeof t.currentWorkspace=="string"&&typeof t.version=="string"}function we(){return document.querySelector('input[name="import-mode"]:checked')?.value||"replace"}function Ee(t){l=t.workspaces,u=t.currentWorkspace,l[u]||(u=Object.keys(l)[0]||"default"),Y(t,()=>{E(),w(),alert("é…ç½®å¯¼å…¥æˆåŠŸï¼é¡µé¢å°†åˆ·æ–°ä»¥åº”ç”¨æ–°é…ç½®ã€‚"),setTimeout(()=>{window.location.reload()},1e3)})}function Ce(t){Object.keys(t.workspaces).forEach(e=>{const o=t.workspaces[e];if(o)if(l[e]){const s=l[e].bookmarks,n=o.bookmarks,c=[...s],r=new Set(s.map(a=>a.url));n.forEach(a=>{r.has(a.url)||c.push(a)}),l[e].bookmarks=c}else l[e]={...o}}),Y(t,()=>{E(),w(),alert("é…ç½®åˆå¹¶æˆåŠŸï¼")})}function Y(t,e){if(typeof chrome<"u"&&chrome.storage){const o={workspaces:l,currentWorkspace:u};t.settings&&Object.assign(o,t.settings),chrome.storage.sync.set(o,e)}else console.log("æœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼Œé…ç½®å·²ä¿å­˜"),e()}function xe(){const t=i("github-sync-enabled"),e=i("test-connection"),o=i("sync-now");t&&(t.addEventListener("change",Se),K()),e&&e.addEventListener("click",Le),o&&o.addEventListener("click",Ie)}function Se(){const t=i("github-sync-enabled"),e=i("github-sync-config");if(!t||!e)return;t.checked?(e.style.display="block",K()):(e.style.display="none",typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.set({githubSync:{enabled:!1}}))}function K(){typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.get(["githubSync"],t=>{const e=t.githubSync;if(e){const o=i("github-sync-enabled"),s=i("github-token"),n=i("github-sync-config");o&&(o.checked=e.enabled),s&&(s.value=e.token||""),e.enabled&&n?(n.style.display="block",v("idle","å·²å¯ç”¨GitHubåŒæ­¥")):n&&(n.style.display="none")}})}async function Le(){const t=i("github-token");if(!t)return;const e=t.value.trim();if(!e){v("error","è¯·è¾“å…¥GitHub Token");return}try{v("syncing","æ­£åœ¨æµ‹è¯•è¿æ¥...");const s=await new q({auth:e}).rest.users.getAuthenticated();v("success",`è¿æ¥æˆåŠŸï¼Œç”¨æˆ·: ${s.data.login}`),typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.set({githubSync:{token:e,enabled:!0}})}catch(o){v("error",`è¿æ¥å¤±è´¥: ${o.message}`)}}async function Ie(){const t=i("github-token");if(!t)return;const e=t.value.trim();if(!e){v("error","è¯·å…ˆè®¾ç½®GitHub Token");return}try{v("syncing","æ­£åœ¨åŒæ­¥...");const o=await Be(),s=await Te(e);if(!s){v("error","åˆ›å»ºgistå¤±è´¥");return}await Ne(e,s,o),v("success","åŒæ­¥å®Œæˆ")}catch(o){v("error",`åŒæ­¥å¤±è´¥: ${o.message}`)}}async function Be(){return new Promise(t=>{typeof chrome<"u"&&chrome.storage?chrome.storage.sync.get(["bookmarks","searchEngine","workspaces","currentWorkspace"],e=>{t({bookmarks:e.bookmarks||[],searchEngine:e.searchEngine||"baidu",workspaces:e.workspaces||l,currentWorkspace:e.currentWorkspace||u,lastSync:new Date().toISOString()})}):t({bookmarks:[],searchEngine:"baidu",workspaces:l,currentWorkspace:u,lastSync:new Date().toISOString()})})}async function Te(t){const e=new q({auth:t}),n=(await e.rest.gists.list()).data.find(r=>r.files&&"mytab-config.json"in r.files);return n?n.id:(await e.rest.gists.create({description:"MyTab Extension Configuration",public:!1,files:{"mytab-config.json":{content:JSON.stringify({bookmarks:[],searchEngine:"baidu",theme:"light",workspaces:{},currentWorkspace:"default"},null,2)}}})).data.id||null}async function Ne(t,e,o){const s=new q({auth:t}),c=(await s.rest.gists.get({gist_id:e})).data.files["mytab-config.json"]?.content;let r;c?r=JSON.parse(c):r=o;const a=We(o,r);typeof chrome<"u"&&chrome.storage&&chrome.storage.sync.set({bookmarks:a.bookmarks,searchEngine:a.searchEngine,workspaces:a.workspaces,currentWorkspace:a.currentWorkspace,githubSync:{token:t,enabled:!0,gistId:e}}),l=a.workspaces,u=a.currentWorkspace,await s.rest.gists.update({gist_id:e,files:{"mytab-config.json":{content:JSON.stringify(a,null,2)}}}),await j(),await w(),Ae()}function We(t,e){const o=new Date(t.lastSync||"1970-01-01").getTime(),s=new Date(e.lastSync||"1970-01-01").getTime();return o>s?{...t,lastSync:new Date().toISOString()}:{...e,lastSync:new Date().toISOString()}}function v(t,e){const o=i("sync-status-text");o&&(o.textContent=e,o.className=`sync-status-${t}`);const s=i("test-connection"),n=i("sync-now");t==="syncing"?(s&&(s.disabled=!0),n&&(n.disabled=!0)):(s&&(s.disabled=!1),n&&(n.disabled=!1))}function Ae(){const t=i("last-sync-time");if(t){const e=new Date;t.textContent=`æœ€ååŒæ­¥: ${e.toLocaleString("zh-CN")}`}}
//# sourceMappingURL=newtab.js.map
