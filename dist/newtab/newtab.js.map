{"version":3,"file":"newtab.js","sources":["../../src/newtab/newtab.ts"],"sourcesContent":["// å¯¼å…¥Octokit\r\nimport { Octokit } from '@octokit/rest';\r\n\r\n// æœ¬åœ°ç±»å‹å®šä¹‰ï¼ˆé¿å…importå¯¼è‡´çš„exporté—®é¢˜ï¼‰\r\ninterface Bookmark {\r\n  title: string;\r\n  url: string;\r\n  icon?: string;\r\n  description?: string;\r\n}\r\n\r\ninterface Workspace {\r\n  id: string;\r\n  name: string;\r\n  bookmarks: Bookmark[];\r\n  icon?: string;\r\n}\r\n\r\ninterface Workspaces {\r\n  [key: string]: Workspace;\r\n}\r\n\r\ntype SearchEngine = 'baidu' | 'google' | 'bing';\r\n\r\ninterface SearchEngineConfig {\r\n  name: string;\r\n  url: string;\r\n  placeholder: string;\r\n}\r\n\r\ninterface AnimeBackground {\r\n  url: string;\r\n  name?: string;\r\n}\r\n\r\n// GitHubåŒæ­¥é…ç½®æ¥å£\r\ninterface GitHubSyncConfig {\r\n  token: string;\r\n  gistId?: string;\r\n  enabled: boolean;\r\n}\r\n\r\n// åŒæ­¥çŠ¶æ€ç±»å‹\r\ntype SyncStatus = 'idle' | 'syncing' | 'success' | 'error';\r\n\r\n// åŒæ­¥é…ç½®æ•°æ®æ¥å£\r\ninterface SyncData {\r\n  bookmarks: Bookmark[];\r\n  searchEngine: SearchEngine;\r\n  theme: string;\r\n  workspaces: Workspaces;\r\n  currentWorkspace: string;\r\n  lastSync?: string;\r\n}\r\n\r\n// é…ç½®æ•°æ®æ¥å£\r\ninterface ConfigData {\r\n  workspaces: Workspaces;\r\n  currentWorkspace: string;\r\n  settings?: Partial<AppSettings>;\r\n  exportTime: string;\r\n  version: string;\r\n}\r\n\r\n// å…¨å±€å˜é‡\r\nlet workspaces: Workspaces = {};\r\nlet currentWorkspace: string = 'default';\r\n\r\n// DOMå…ƒç´ ç±»å‹æ–­è¨€è¾…åŠ©å‡½æ•°\r\nfunction getElement<T extends HTMLElement>(id: string): T | null {\r\n  return document.getElementById(id) as T;\r\n}\r\n\r\nfunction getElementBySelector<T extends HTMLElement>(selector: string): T | null {\r\n  return document.querySelector(selector) as T;\r\n}\r\n\r\n// æœç´¢å¼•æ“é…ç½®\r\nconst searchEngines: Record<SearchEngine, SearchEngineConfig> = {\r\n  baidu: {\r\n    name: 'ç™¾åº¦',\r\n    url: 'https://www.baidu.com/s?wd=',\r\n    placeholder: 'ç™¾åº¦ä¸€ä¸‹ï¼Œä½ å°±çŸ¥é“'\r\n  },\r\n  google: {\r\n    name: 'Google',\r\n    url: 'https://www.google.com/search?q=',\r\n    placeholder: 'Search Google'\r\n  },\r\n  bing: {\r\n    name: 'Bing',\r\n    url: 'https://www.bing.com/search?q=',\r\n    placeholder: 'Search Bing'\r\n  }\r\n};\r\n\r\n// åŠ¨æ¼«èƒŒæ™¯å›¾ç‰‡åˆ—è¡¨\r\nconst animeBackgrounds: AnimeBackground[] = [\r\n  { url: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=1920&h=1080&fit=crop', name: 'æ˜Ÿç©ºå¤œæ™¯' },\r\n  { url: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop', name: 'å±±è„‰é£å…‰' },\r\n  { url: 'https://images.unsplash.com/photo-1519904981063-b0cf448d479e?w=1920&h=1080&fit=crop', name: 'åŸå¸‚å¤œæ™¯' },\r\n  { url: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop', name: 'è‡ªç„¶é£æ™¯' },\r\n  { url: 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1920&h=1080&fit=crop', name: 'æ£®æ—å°å¾„' },\r\n  { url: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop', name: 'æµ·æ´‹æ³¢æµª' },\r\n  { url: 'https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=1920&h=1080&fit=crop', name: 'æ¨±èŠ±ç››å¼€' },\r\n  { url: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop', name: 'é›ªå±±æ™¯è‰²' }\r\n];\r\n\r\ndocument.addEventListener('DOMContentLoaded', async (): Promise<void> => {\r\n  console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');\r\n  \r\n  try {\r\n    // åˆå§‹åŒ–æ—¶é’Ÿå’Œæ—¥æœŸ\r\n    updateClock();\r\n    setInterval(updateClock, 1000);\r\n    console.log('æ—¶é’Ÿåˆå§‹åŒ–å®Œæˆ');\r\n    \r\n    // åˆå§‹åŒ–æœç´¢\r\n    initSearch();\r\n    console.log('æœç´¢åˆå§‹åŒ–å®Œæˆ');\r\n    \r\n    // åˆå§‹åŒ–ä¾§è¾¹æ \r\n    initSidebar();\r\n    console.log('ä¾§è¾¹æ åˆå§‹åŒ–å®Œæˆ');\r\n    \r\n    // åˆå§‹åŒ–æ¨¡æ€æ¡†\r\n    initModals();\r\n    console.log('æ¨¡æ€æ¡†åˆå§‹åŒ–å®Œæˆ');\r\n    \r\n    // åˆå§‹åŒ–GitHubåŒæ­¥\r\n    initGitHubSync();\r\n    console.log('GitHubåŒæ­¥åˆå§‹åŒ–å®Œæˆ');\r\n    \r\n    // åˆå§‹åŒ–åº•è¾¹æ å›¾æ ‡ï¼ˆå¼‚æ­¥ï¼‰\r\n    initBottomBarIcons();\r\n    console.log('åº•è¾¹æ å›¾æ ‡åˆå§‹åŒ–å¼€å§‹');\r\n    \r\n    // åˆå§‹åŒ–å·¥ä½œåŒºï¼ˆè¿™ä¼šè§¦å‘ä¹¦ç­¾åˆå§‹åŒ–ï¼‰\r\n    initWorkspaces();\r\n    console.log('å·¥ä½œåŒºåˆå§‹åŒ–å®Œæˆ');\r\n    \r\n    // åˆå§‹åŒ–åŠ¨æ¼«èƒŒæ™¯\r\n    initAnimeBackground();\r\n    console.log('åŠ¨æ¼«èƒŒæ™¯åˆå§‹åŒ–å®Œæˆ');\r\n    \r\n  } catch (error) {\r\n    console.error('åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);\r\n  }\r\n});\r\n\r\n// æ›´æ–°æ—¶é’Ÿå’Œæ—¥æœŸ\r\nfunction updateClock(): void {\r\n  const now = new Date();\r\n  \r\n  // æ›´æ–°æ—¶é’Ÿ\r\n  const hours = String(now.getHours()).padStart(2, '0');\r\n  const minutes = String(now.getMinutes()).padStart(2, '0');\r\n  const seconds = String(now.getSeconds()).padStart(2, '0');\r\n  \r\n  const clockElement = getElement('clock');\r\n  if (clockElement) {\r\n    clockElement.textContent = `${hours}:${minutes}:${seconds}`;\r\n  }\r\n  \r\n  // æ›´æ–°æ—¥æœŸ\r\n  const options: Intl.DateTimeFormatOptions = { \r\n    weekday: 'long', \r\n    year: 'numeric', \r\n    month: 'long', \r\n    day: 'numeric' \r\n  };\r\n  \r\n  const dateElement = getElement('date');\r\n  if (dateElement) {\r\n    dateElement.textContent = now.toLocaleDateString('zh-CN', options);\r\n  }\r\n}\r\n\r\n// åˆå§‹åŒ–æœç´¢åŠŸèƒ½\r\nfunction initSearch(): void {\r\n  const searchInput = getElement<HTMLInputElement>('search-input');\r\n  const searchForm = getElement<HTMLFormElement>('search-form');\r\n  \r\n  if (!searchInput || !searchForm) {\r\n    console.error('æœç´¢å…ƒç´ æœªæ‰¾åˆ°');\r\n    return;\r\n  }\r\n\r\n  // åŠ è½½æœç´¢å¼•æ“è®¾ç½®\r\n  if (typeof chrome !== 'undefined' && chrome.storage) {\r\n    chrome.storage.sync.get('searchEngine', (data: { searchEngine?: SearchEngine }): void => {\r\n      const engine = data.searchEngine || 'baidu';\r\n      const config = searchEngines[engine];\r\n      searchInput.placeholder = config.placeholder;\r\n    });\r\n  }\r\n\r\n  // æœç´¢è¡¨å•æäº¤äº‹ä»¶\r\n  searchForm.addEventListener('submit', (e: Event): void => {\r\n    e.preventDefault();\r\n    const query = searchInput.value.trim();\r\n    if (query) {\r\n      performSearch(query);\r\n    }\r\n  });\r\n}\r\n\r\n// æ‰§è¡Œæœç´¢\r\nfunction performSearch(query: string): void {\r\n  if (typeof chrome !== 'undefined' && chrome.storage) {\r\n    chrome.storage.sync.get('searchEngine', (data: { searchEngine?: SearchEngine }): void => {\r\n      const engine = data.searchEngine || 'baidu';\r\n      const config = searchEngines[engine];\r\n      const searchUrl = config.url + encodeURIComponent(query);\r\n      window.open(searchUrl, '_blank');\r\n    });\r\n  } else {\r\n    // é»˜è®¤ä½¿ç”¨ç™¾åº¦æœç´¢\r\n    const searchUrl = searchEngines.baidu.url + encodeURIComponent(query);\r\n    window.open(searchUrl, '_blank');\r\n  }\r\n}\r\n\r\n// åˆå§‹åŒ–å·¥ä½œåŒº\r\nfunction initWorkspaces(): void {\r\n  if (typeof chrome !== 'undefined' && chrome.storage) {\r\n    chrome.storage.sync.get(['workspaces', 'currentWorkspace'], (data: { workspaces?: Workspaces; currentWorkspace?: string }): void => {\r\n      workspaces = data.workspaces || getDefaultWorkspaces();\r\n      currentWorkspace = data.currentWorkspace || 'default';\r\n      \r\n      completeWorkspaceInit();\r\n    });\r\n  } else {\r\n    // å¦‚æœæ²¡æœ‰Chromeå­˜å‚¨ï¼Œä½¿ç”¨é»˜è®¤å·¥ä½œåŒº\r\n    workspaces = getDefaultWorkspaces();\r\n    currentWorkspace = 'default';\r\n    completeWorkspaceInit();\r\n  }\r\n}\r\n\r\n// å®Œæˆå·¥ä½œåŒºåˆå§‹åŒ–\r\nasync function completeWorkspaceInit(): Promise<void> {\r\n  updateWorkspaceList();\r\n  await initBookmarks();\r\n}\r\n\r\n// è·å–é»˜è®¤å·¥ä½œåŒº\r\nfunction getDefaultWorkspaces(): Workspaces {\r\n  return {\r\n    default: {\r\n      id: 'default',\r\n      name: 'é»˜è®¤',\r\n      bookmarks: [],\r\n      icon: 'ğŸ '\r\n    },\r\n    work: {\r\n      id: 'work',\r\n      name: 'å·¥ä½œ',\r\n      bookmarks: [],\r\n      icon: 'ğŸ’¼'\r\n    },\r\n    study: {\r\n      id: 'study',\r\n      name: 'å­¦ä¹ ',\r\n      bookmarks: [],\r\n      icon: 'ğŸ“š'\r\n    },\r\n    entertainment: {\r\n      id: 'entertainment',\r\n      name: 'å¨±ä¹',\r\n      bookmarks: [],\r\n      icon: 'ğŸ®'\r\n    }\r\n  };\r\n}\r\n\r\n// æ›´æ–°å·¥ä½œåŒºåˆ—è¡¨\r\nfunction updateWorkspaceList(): void {\r\n  const workspaceList = getElement('workspace-list');\r\n  if (!workspaceList) {\r\n    console.error('workspace-list å…ƒç´ æœªæ‰¾åˆ°');\r\n    return;\r\n  }\r\n  \r\n  workspaceList.innerHTML = '';\r\n  \r\n  Object.values(workspaces).forEach((workspace: Workspace): void => {\r\n    const workspaceItem = document.createElement('div');\r\n    workspaceItem.className = `workspace-item ${workspace.id === currentWorkspace ? 'active' : ''}`;\r\n    workspaceItem.dataset['workspace'] = workspace.id;\r\n    \r\n    const icon = document.createElement('div');\r\n    icon.className = 'workspace-icon';\r\n    icon.textContent = workspace.icon || 'ğŸ“';\r\n    \r\n    const name = document.createElement('span');\r\n    name.textContent = workspace.name;\r\n    \r\n    workspaceItem.appendChild(icon);\r\n    workspaceItem.appendChild(name);\r\n    \r\n    // å·¦é”®ç‚¹å‡»åˆ‡æ¢å·¥ä½œåŒº\r\n    workspaceItem.addEventListener('click', (): void => {\r\n      console.log('ç‚¹å‡»å·¥ä½œåŒº:', workspace.id);\r\n      switchWorkspace(workspace.id);\r\n    });\r\n    \r\n    // å³é”®èœå•åŠŸèƒ½\r\n    workspaceItem.addEventListener('contextmenu', (e: MouseEvent): void => {\r\n      e.preventDefault();\r\n      showWorkspaceContextMenu(e, workspace, workspaceItem);\r\n    });\r\n    \r\n    workspaceList.appendChild(workspaceItem);\r\n  });\r\n  \r\n  console.log('å·¥ä½œåŒºåˆ—è¡¨å·²æ›´æ–°ï¼Œå½“å‰å·¥ä½œåŒº:', currentWorkspace);\r\n}\r\n\r\n// åˆ‡æ¢å·¥ä½œåŒº\r\nasync function switchWorkspace(workspaceId: string): Promise<void> {\r\n  if (!workspaces[workspaceId]) {\r\n    console.error('å·¥ä½œåŒºä¸å­˜åœ¨:', workspaceId);\r\n    return;\r\n  }\r\n  \r\n  currentWorkspace = workspaceId;\r\n  \r\n  // ä¿å­˜å½“å‰å·¥ä½œåŒºåˆ°å­˜å‚¨\r\n  if (typeof chrome !== 'undefined' && chrome.storage) {\r\n    chrome.storage.sync.set({ currentWorkspace });\r\n  }\r\n  \r\n  // æ›´æ–°UI\r\n  updateWorkspaceList();\r\n  await initBookmarks();\r\n}\r\n\r\n// æ˜¾ç¤ºå·¥ä½œåŒºå³é”®èœå•\r\nfunction showWorkspaceContextMenu(e: MouseEvent, workspace: Workspace, workspaceElement: HTMLElement): void {\r\n  // ç§»é™¤å·²å­˜åœ¨çš„å³é”®èœå•\r\n  const existingMenu = document.querySelector('.workspace-context-menu');\r\n  if (existingMenu) {\r\n    existingMenu.remove();\r\n  }\r\n  \r\n  // åˆ›å»ºå³é”®èœå•\r\n  const contextMenu = document.createElement('div');\r\n  contextMenu.className = 'workspace-context-menu';\r\n  contextMenu.style.position = 'fixed';\r\n  contextMenu.style.left = `${e.clientX}px`;\r\n  contextMenu.style.top = `${e.clientY}px`;\r\n  contextMenu.style.background = 'white';\r\n  contextMenu.style.border = '1px solid #ddd';\r\n  contextMenu.style.borderRadius = '6px';\r\n  contextMenu.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';\r\n  contextMenu.style.zIndex = '10000';\r\n  contextMenu.style.minWidth = '120px';\r\n  contextMenu.style.overflow = 'hidden';\r\n  \r\n  // ä¿®æ”¹é€‰é¡¹\r\n  const editOption = document.createElement('div');\r\n  editOption.className = 'context-menu-item';\r\n  editOption.textContent = 'ä¿®æ”¹';\r\n  editOption.style.padding = '8px 12px';\r\n  editOption.style.cursor = 'pointer';\r\n  editOption.style.fontSize = '14px';\r\n  editOption.style.borderBottom = '1px solid #eee';\r\n  editOption.addEventListener('mouseenter', (): void => {\r\n    editOption.style.background = '#f5f5f5';\r\n  });\r\n  editOption.addEventListener('mouseleave', (): void => {\r\n    editOption.style.background = 'white';\r\n  });\r\n  editOption.addEventListener('click', (): void => {\r\n    editWorkspace(workspace);\r\n    contextMenu.remove();\r\n  });\r\n  \r\n  // åˆ é™¤é€‰é¡¹ï¼ˆé»˜è®¤å·¥ä½œåŒºä¸èƒ½åˆ é™¤ï¼‰\r\n  if (workspace.id !== 'default') {\r\n    const deleteOption = document.createElement('div');\r\n    deleteOption.className = 'context-menu-item';\r\n    deleteOption.textContent = 'åˆ é™¤';\r\n    deleteOption.style.padding = '8px 12px';\r\n    deleteOption.style.cursor = 'pointer';\r\n    deleteOption.style.fontSize = '14px';\r\n    deleteOption.style.color = '#dc3545';\r\n    deleteOption.addEventListener('mouseenter', (): void => {\r\n      deleteOption.style.background = '#f5f5f5';\r\n    });\r\n    deleteOption.addEventListener('mouseleave', (): void => {\r\n      deleteOption.style.background = 'white';\r\n    });\r\n    deleteOption.addEventListener('click', (): void => {\r\n      deleteWorkspace(workspace);\r\n      contextMenu.remove();\r\n    });\r\n    \r\n    contextMenu.appendChild(editOption);\r\n    contextMenu.appendChild(deleteOption);\r\n  } else {\r\n    // é»˜è®¤å·¥ä½œåŒºåªæ˜¾ç¤ºä¿®æ”¹é€‰é¡¹\r\n    contextMenu.appendChild(editOption);\r\n  }\r\n  \r\n  document.body.appendChild(contextMenu);\r\n  \r\n  // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­èœå•\r\n  const closeMenu = (event: MouseEvent): void => {\r\n    if (!contextMenu.contains(event.target as Node)) {\r\n      contextMenu.remove();\r\n      document.removeEventListener('click', closeMenu);\r\n    }\r\n  };\r\n  \r\n  // å»¶è¿Ÿæ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘\r\n  setTimeout(() => {\r\n    document.addEventListener('click', closeMenu);\r\n  }, 0);\r\n}\r\n\r\n// ç¼–è¾‘å·¥ä½œåŒº\r\nfunction editWorkspace(workspace: Workspace): void {\r\n  const addWorkspaceModal = getElement('add-workspace-modal');\r\n  const workspaceNameInput = getElement<HTMLInputElement>('workspace-name');\r\n  \r\n  if (!addWorkspaceModal || !workspaceNameInput) {\r\n    console.error('å·¥ä½œåŒºç¼–è¾‘å…ƒç´ æœªæ‰¾åˆ°');\r\n    return;\r\n  }\r\n  \r\n  // å¡«å……å½“å‰å·¥ä½œåŒºæ•°æ®\r\n  workspaceNameInput.value = workspace.name;\r\n  \r\n  // é€‰æ‹©å½“å‰å›¾æ ‡\r\n  const iconOptions = document.querySelectorAll('.icon-option');\r\n  iconOptions.forEach((option: Element): void => {\r\n    option.classList.remove('selected');\r\n    const iconOption = option as HTMLElement;\r\n    if (iconOption.dataset['icon'] === workspace.icon) {\r\n      option.classList.add('selected');\r\n    }\r\n  });\r\n  \r\n  // æ ‡è®°ä¸ºç¼–è¾‘æ¨¡å¼\r\n  addWorkspaceModal.setAttribute('data-edit-mode', 'true');\r\n  addWorkspaceModal.setAttribute('data-edit-workspace', JSON.stringify(workspace));\r\n  \r\n  // æ›´æ”¹æ ‡é¢˜\r\n  const modalTitle = addWorkspaceModal.querySelector('h3');\r\n  if (modalTitle) {\r\n    modalTitle.textContent = 'ä¿®æ”¹å·¥ä½œåŒº';\r\n  }\r\n  \r\n  // æ˜¾ç¤ºæ¨¡æ€æ¡†\r\n  addWorkspaceModal.classList.add('active');\r\n}\r\n\r\n// åˆ é™¤å·¥ä½œåŒº\r\nfunction deleteWorkspace(workspace: Workspace): void {\r\n  if (workspace.id === 'default') {\r\n    alert('é»˜è®¤å·¥ä½œåŒºä¸èƒ½åˆ é™¤');\r\n    return;\r\n  }\r\n  \r\n  if (!confirm(`ç¡®å®šè¦åˆ é™¤å·¥ä½œåŒº\"${workspace.name}\"å—ï¼Ÿ\\nåˆ é™¤åè¯¥å·¥ä½œåŒºçš„æ‰€æœ‰ä¹¦ç­¾ä¹Ÿä¼šè¢«åˆ é™¤ã€‚`)) {\r\n    return;\r\n  }\r\n  \r\n  // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰å·¥ä½œåŒºï¼Œåˆ‡æ¢åˆ°é»˜è®¤å·¥ä½œåŒº\r\n  if (workspace.id === currentWorkspace) {\r\n    currentWorkspace = 'default';\r\n  }\r\n  \r\n  // ä»å·¥ä½œåŒºåˆ—è¡¨ä¸­åˆ é™¤\r\n  delete workspaces[workspace.id];\r\n  \r\n  // ä¿å­˜åˆ°å­˜å‚¨\r\n  if (typeof chrome !== 'undefined' && chrome.storage) {\r\n    chrome.storage.sync.set({ workspaces, currentWorkspace }, (): void => {\r\n      console.log('å·¥ä½œåŒºå·²åˆ é™¤:', workspace.name);\r\n      updateWorkspaceList();\r\n      initBookmarks();\r\n    });\r\n  } else {\r\n    // æœ¬åœ°æµ‹è¯•ç¯å¢ƒ\r\n    console.log('å·¥ä½œåŒºå·²åˆ é™¤:', workspace.name);\r\n    updateWorkspaceList();\r\n    initBookmarks();\r\n  }\r\n}\r\n\r\n// ä¿®æ”¹initBookmarkså‡½æ•°ä¸ºå¼‚æ­¥ç‰ˆæœ¬ï¼Œä½¿ç”¨æ™ºèƒ½å›¾æ ‡è·å–\r\nasync function initBookmarks(): Promise<void> {\r\n  const bookmarksContainer = getElement('bookmarks');\r\n  if (!bookmarksContainer) {\r\n    console.error('ä¹¦ç­¾å®¹å™¨å…ƒç´ æœªæ‰¾åˆ°');\r\n    return;\r\n  }\r\n  \r\n  bookmarksContainer.innerHTML = '';\r\n  \r\n  // æ£€æŸ¥å·¥ä½œåŒºæ•°æ®æ˜¯å¦å·²åŠ è½½\r\n  if (!workspaces || !currentWorkspace) {\r\n    console.log('å·¥ä½œåŒºæ•°æ®å°šæœªåŠ è½½ï¼Œè·³è¿‡ä¹¦ç­¾åˆå§‹åŒ–');\r\n    return;\r\n  }\r\n  \r\n  // ç¡®ä¿å½“å‰å·¥ä½œåŒºå­˜åœ¨\r\n  const currentWorkspaceData = workspaces[currentWorkspace];\r\n  if (!currentWorkspaceData) {\r\n    console.error('å½“å‰å·¥ä½œåŒºä¸å­˜åœ¨:', currentWorkspace);\r\n    return;\r\n  }\r\n  \r\n  // è·å–å½“å‰å·¥ä½œåŒºçš„ä¹¦ç­¾\r\n  if (currentWorkspaceData.bookmarks && currentWorkspaceData.bookmarks.length > 0) {\r\n    const bookmarks = currentWorkspaceData.bookmarks;\r\n    \r\n    // æ¸²æŸ“ä¹¦ç­¾ - ç«‹å³æ˜¾ç¤ºï¼Œå¼‚æ­¥è·å–å›¾æ ‡\r\n    for (const bookmark of bookmarks) {\r\n      createBookmarkElementWithLogo(bookmark).then((bookmarkElement) => {\r\n        bookmarksContainer.appendChild(bookmarkElement);\r\n      });\r\n    }\r\n  } else {\r\n    // å¦‚æœå½“å‰å·¥ä½œåŒºæ²¡æœ‰ä¹¦ç­¾ï¼Œæ˜¾ç¤ºé»˜è®¤ä¹¦ç­¾ï¼ˆä»…é™é»˜è®¤å·¥ä½œåŒºï¼‰\r\n    if (currentWorkspace === 'default') {\r\n      const defaultBookmarks: Bookmark[] = [\r\n        { title: 'ç™¾åº¦', url: 'https://www.baidu.com' },\r\n        { title: 'å¾®åš', url: 'https://weibo.com' },\r\n        { title: 'çŸ¥ä¹', url: 'https://www.zhihu.com' },\r\n        { title: 'Bilibili', url: 'https://www.bilibili.com' },\r\n        { title: 'è…¾è®¯è§†é¢‘', url: 'https://v.qq.com' },\r\n        { title: 'æ·˜å®', url: 'https://www.taobao.com' }\r\n      ];\r\n      \r\n      // ä¿å­˜é»˜è®¤ä¹¦ç­¾åˆ°å½“å‰å·¥ä½œåŒº\r\n      const workspace = workspaces[currentWorkspace];\r\n      if (workspace) {\r\n        workspace.bookmarks = defaultBookmarks;\r\n        \r\n        // ä¿å­˜åˆ°å­˜å‚¨ï¼ˆå¦‚æœå¯ç”¨ï¼‰\r\n        if (typeof chrome !== 'undefined' && chrome.storage) {\r\n          chrome.storage.sync.set({ workspaces });\r\n        }\r\n        \r\n        // æ¸²æŸ“ä¹¦ç­¾ - ç«‹å³æ˜¾ç¤ºï¼Œå¼‚æ­¥è·å–å›¾æ ‡\r\n        for (const bookmark of defaultBookmarks) {\r\n          createBookmarkElementWithLogo(bookmark).then((bookmarkElement) => {\r\n            bookmarksContainer.appendChild(bookmarkElement);\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  // æ·»åŠ \"æ·»åŠ ä¹¦ç­¾\"æŒ‰é’®åˆ°æœ€å\r\n  const addButton = createAddBookmarkButton();\r\n  \r\n  // è®¡ç®—å½“å‰ä¹¦ç­¾æ•°é‡ï¼Œä¸ºæ·»åŠ æŒ‰é’®è®¾ç½®åˆé€‚çš„åŠ¨ç”»å»¶è¿Ÿ\r\n  const bookmarkCount = bookmarksContainer.children.length;\r\n  const delay = (bookmarkCount + 1) * 0.1;\r\n  addButton.style.animationDelay = `${delay}s`;\r\n  \r\n  bookmarksContainer.appendChild(addButton);\r\n}\r\n\r\n// æ˜¾ç¤ºä¹¦ç­¾å³é”®èœå•\r\nfunction showBookmarkContextMenu(e: MouseEvent, bookmark: Bookmark, bookmarkElement: HTMLElement): void {\r\n  // ç§»é™¤å·²å­˜åœ¨çš„å³é”®èœå•\r\n  const existingMenu = document.querySelector('.bookmark-context-menu');\r\n  if (existingMenu) {\r\n    existingMenu.remove();\r\n  }\r\n  \r\n  // åˆ›å»ºå³é”®èœå•\r\n  const contextMenu = document.createElement('div');\r\n  contextMenu.className = 'bookmark-context-menu';\r\n  contextMenu.style.position = 'fixed';\r\n  contextMenu.style.left = `${e.clientX}px`;\r\n  contextMenu.style.top = `${e.clientY}px`;\r\n  contextMenu.style.background = 'white';\r\n  contextMenu.style.border = '1px solid #ddd';\r\n  contextMenu.style.borderRadius = '6px';\r\n  contextMenu.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';\r\n  contextMenu.style.zIndex = '10000';\r\n  contextMenu.style.minWidth = '120px';\r\n  contextMenu.style.overflow = 'hidden';\r\n  \r\n  // ä¿®æ”¹é€‰é¡¹\r\n  const editOption = document.createElement('div');\r\n  editOption.className = 'context-menu-item';\r\n  editOption.textContent = 'ä¿®æ”¹';\r\n  editOption.style.padding = '8px 12px';\r\n  editOption.style.cursor = 'pointer';\r\n  editOption.style.fontSize = '14px';\r\n  editOption.style.borderBottom = '1px solid #eee';\r\n  editOption.addEventListener('mouseenter', (): void => {\r\n    editOption.style.background = '#f5f5f5';\r\n  });\r\n  editOption.addEventListener('mouseleave', (): void => {\r\n    editOption.style.background = 'white';\r\n  });\r\n  editOption.addEventListener('click', (): void => {\r\n    editBookmark(bookmark);\r\n    contextMenu.remove();\r\n  });\r\n  \r\n  // åˆ é™¤é€‰é¡¹\r\n  const deleteOption = document.createElement('div');\r\n  deleteOption.className = 'context-menu-item';\r\n  deleteOption.textContent = 'åˆ é™¤';\r\n  deleteOption.style.padding = '8px 12px';\r\n  deleteOption.style.cursor = 'pointer';\r\n  deleteOption.style.fontSize = '14px';\r\n  deleteOption.style.color = '#dc3545';\r\n  deleteOption.addEventListener('mouseenter', (): void => {\r\n    deleteOption.style.background = '#f5f5f5';\r\n  });\r\n  deleteOption.addEventListener('mouseleave', (): void => {\r\n    deleteOption.style.background = 'white';\r\n  });\r\n  deleteOption.addEventListener('click', (): void => {\r\n    deleteBookmark(bookmark, bookmarkElement);\r\n    contextMenu.remove();\r\n  });\r\n  \r\n  contextMenu.appendChild(editOption);\r\n  contextMenu.appendChild(deleteOption);\r\n  document.body.appendChild(contextMenu);\r\n  \r\n  // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­èœå•\r\n  const closeMenu = (event: MouseEvent): void => {\r\n    if (!contextMenu.contains(event.target as Node)) {\r\n      contextMenu.remove();\r\n      document.removeEventListener('click', closeMenu);\r\n    }\r\n  };\r\n  \r\n  // å»¶è¿Ÿæ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘\r\n  setTimeout(() => {\r\n    document.addEventListener('click', closeMenu);\r\n  }, 0);\r\n}\r\n\r\n// ç¼–è¾‘ä¹¦ç­¾\r\nfunction editBookmark(bookmark: Bookmark): void {\r\n  const addBookmarkModal = getElement('add-bookmark-modal');\r\n  const titleInput = getElement<HTMLInputElement>('bookmark-title');\r\n  const urlInput = getElement<HTMLInputElement>('bookmark-url');\r\n  const descriptionInput = getElement<HTMLTextAreaElement>('bookmark-description');\r\n  \r\n  if (!addBookmarkModal || !titleInput || !urlInput) {\r\n    console.error('ä¹¦ç­¾ç¼–è¾‘å…ƒç´ æœªæ‰¾åˆ°');\r\n    return;\r\n  }\r\n  \r\n  // å¡«å……å½“å‰ä¹¦ç­¾æ•°æ®\r\n  titleInput.value = bookmark.title;\r\n  urlInput.value = bookmark.url;\r\n  if (descriptionInput && bookmark.description) {\r\n    descriptionInput.value = bookmark.description;\r\n  }\r\n  \r\n  // æ ‡è®°ä¸ºç¼–è¾‘æ¨¡å¼\r\n  addBookmarkModal.setAttribute('data-edit-mode', 'true');\r\n  addBookmarkModal.setAttribute('data-edit-bookmark', JSON.stringify(bookmark));\r\n  \r\n  // æ˜¾ç¤ºæ¨¡æ€æ¡†\r\n  addBookmarkModal.classList.add('active');\r\n}\r\n\r\n// åˆ é™¤ä¹¦ç­¾\r\nfunction deleteBookmark(bookmark: Bookmark, bookmarkElement: HTMLElement): void {\r\n  if (!confirm(`ç¡®å®šè¦åˆ é™¤ä¹¦ç­¾\"${bookmark.title}\"å—ï¼Ÿ`)) {\r\n    return;\r\n  }\r\n  \r\n  // ä»å½“å‰å·¥ä½œåŒºä¸­åˆ é™¤ä¹¦ç­¾\r\n  const currentWorkspaceData = workspaces[currentWorkspace];\r\n  if (currentWorkspaceData && currentWorkspaceData.bookmarks) {\r\n    const bookmarkIndex = currentWorkspaceData.bookmarks.findIndex(\r\n      (b: Bookmark) => b.title === bookmark.title && b.url === bookmark.url\r\n    );\r\n    \r\n    if (bookmarkIndex !== -1) {\r\n      currentWorkspaceData.bookmarks.splice(bookmarkIndex, 1);\r\n      \r\n      // ä¿å­˜åˆ°å­˜å‚¨\r\n      if (typeof chrome !== 'undefined' && chrome.storage) {\r\n        chrome.storage.sync.set({ workspaces }, (): void => {\r\n          console.log('ä¹¦ç­¾å·²åˆ é™¤:', bookmark.title);\r\n        });\r\n      }\r\n      \r\n      // ä»DOMä¸­ç§»é™¤å…ƒç´ \r\n      bookmarkElement.remove();\r\n    }\r\n  }\r\n}\r\n\r\n// ç®€åŒ–çš„å›¾æ ‡è·å–å‡½æ•° - åªä½¿ç”¨favicon\r\nasync function getWebsiteFavicon(url: string): Promise<string> {\r\n  const domain = new URL(url).hostname;\r\n  \r\n  // å®šä¹‰faviconè·¯å¾„ï¼ŒæŒ‰ä¼˜å…ˆçº§æ’åº\r\n  const faviconPaths = [\r\n    // é«˜åˆ†è¾¨ç‡favicon\r\n    `https://${domain}/favicon-32x32.png`,\r\n    `https://${domain}/favicon-96x96.png`,\r\n    `https://${domain}/favicon-192x192.png`,\r\n    \r\n    // Apple touch icon (é€šå¸¸è´¨é‡è¾ƒå¥½)\r\n    `https://${domain}/apple-touch-icon.png`,\r\n    `https://${domain}/apple-touch-icon-180x180.png`,\r\n    \r\n    // Google faviconæœåŠ¡ (å¤‡ç”¨)\r\n    `https://www.google.com/s2/favicons?domain=${domain}&sz=32`,\r\n    \r\n    // æ ‡å‡†favicon (æœ€åå¤‡ç”¨)\r\n    `https://${domain}/favicon.ico`\r\n  ];\r\n  \r\n  // å°è¯•åŠ è½½æ¯ä¸ªè·¯å¾„\r\n  for (const faviconPath of faviconPaths) {\r\n    try {\r\n      const isValid = await checkImageExists(faviconPath);\r\n      if (isValid) {\r\n        return faviconPath;\r\n      }\r\n    } catch (error) {\r\n      // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªè·¯å¾„\r\n      continue;\r\n    }\r\n  }\r\n  \r\n  // å¦‚æœæ‰€æœ‰è·¯å¾„éƒ½å¤±è´¥ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œå°†ä½¿ç”¨æ–‡å­—\r\n  return '';\r\n}\r\n\r\n// æ£€æŸ¥å›¾ç‰‡æ˜¯å¦å­˜åœ¨ä¸”å¯åŠ è½½\r\nfunction checkImageExists(url: string): Promise<boolean> {\r\n  return new Promise((resolve) => {\r\n    const img = new Image();\r\n    img.onload = () => {\r\n      // æ£€æŸ¥å›¾ç‰‡å°ºå¯¸ï¼Œè¿‡å°çš„å›¾ç‰‡å¯èƒ½æ˜¯å ä½ç¬¦\r\n      if (img.width >= 16 && img.height >= 16) {\r\n        resolve(true);\r\n      } else {\r\n        resolve(false);\r\n      }\r\n    };\r\n    img.onerror = () => resolve(false);\r\n    img.src = url;\r\n    \r\n    // è®¾ç½®è¶…æ—¶ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…\r\n    setTimeout(() => resolve(false), 3000);\r\n  });\r\n}\r\n\r\n// åˆ›å»ºä¹¦ç­¾å…ƒç´  - ä¼˜åŒ–ç‰ˆæœ¬ï¼Œå…ˆæ˜¾ç¤ºæ–‡å­—ï¼Œå¼‚æ­¥è·å–favicon\r\nasync function createBookmarkElementWithLogo(bookmark: Bookmark): Promise<HTMLElement> {\r\n  const bookmarkItem = document.createElement('a');\r\n  bookmarkItem.href = bookmark.url;\r\n  bookmarkItem.className = 'bookmark-item';\r\n  \r\n  // å¦‚æœæœ‰æè¿°ï¼Œæ·»åŠ åˆ°titleå±æ€§ä¸­\r\n  if (bookmark.description) {\r\n    bookmarkItem.title = `${bookmark.title}\\n${bookmark.description}`;\r\n  } else {\r\n    bookmarkItem.title = bookmark.title;\r\n  }\r\n  \r\n  const iconContainer = document.createElement('div');\r\n  iconContainer.className = 'bookmark-icon';\r\n  \r\n  // å…ˆæ˜¾ç¤ºæ–‡å­—ç‰ˆæœ¬\r\n  function showTextIcon(): void {\r\n    iconContainer.innerHTML = '';\r\n    iconContainer.style.background = '#6c757d';\r\n    iconContainer.style.color = 'white';\r\n    iconContainer.style.display = 'flex';\r\n    iconContainer.style.alignItems = 'center';\r\n    iconContainer.style.justifyContent = 'center';\r\n    iconContainer.style.fontSize = '1.2rem';\r\n    iconContainer.style.fontWeight = 'bold';\r\n    iconContainer.textContent = bookmark.title.charAt(0).toUpperCase();\r\n  }\r\n  \r\n  // æ˜¾ç¤ºå›¾æ ‡ç‰ˆæœ¬\r\n  function showImageIcon(iconUrl: string): void {\r\n    const iconImg = document.createElement('img');\r\n    iconImg.src = iconUrl;\r\n    iconImg.alt = bookmark.title;\r\n    iconImg.style.width = '100%';\r\n    iconImg.style.height = '100%';\r\n    iconImg.style.objectFit = 'cover';\r\n    iconImg.onerror = (): void => {\r\n      // å›¾æ ‡åŠ è½½å¤±è´¥æ—¶ï¼Œå›é€€åˆ°æ–‡å­—\r\n      showTextIcon();\r\n    };\r\n    \r\n    // æ¸…é™¤æ–‡å­—æ ·å¼ï¼Œæ˜¾ç¤ºå›¾ç‰‡\r\n    iconContainer.innerHTML = '';\r\n    iconContainer.style.background = '';\r\n    iconContainer.style.color = '';\r\n    iconContainer.style.fontSize = '';\r\n    iconContainer.style.fontWeight = '';\r\n    iconContainer.appendChild(iconImg);\r\n  }\r\n  \r\n  // ç«‹å³æ˜¾ç¤ºæ–‡å­—ç‰ˆæœ¬\r\n  showTextIcon();\r\n  \r\n  const titleElement = document.createElement('div');\r\n  titleElement.className = 'bookmark-title';\r\n  titleElement.textContent = bookmark.title;\r\n  \r\n  bookmarkItem.appendChild(iconContainer);\r\n  bookmarkItem.appendChild(titleElement);\r\n  \r\n  // æ·»åŠ å³é”®èœå•äº‹ä»¶\r\n  bookmarkItem.addEventListener('contextmenu', (e: MouseEvent): void => {\r\n    e.preventDefault();\r\n    showBookmarkContextMenu(e, bookmark, bookmarkItem);\r\n  });\r\n  \r\n  // å¼‚æ­¥è·å–faviconå¹¶æ›¿æ¢\r\n  (async (): Promise<void> => {\r\n    try {\r\n      let iconUrl = '';\r\n      \r\n      // å¦‚æœå·²æœ‰å›¾æ ‡URLï¼Œå…ˆéªŒè¯æ˜¯å¦æœ‰æ•ˆ\r\n      if (bookmark.icon) {\r\n        const isValid = await checkImageExists(bookmark.icon);\r\n        if (isValid) {\r\n          iconUrl = bookmark.icon;\r\n        }\r\n      }\r\n      \r\n      // å¦‚æœæ²¡æœ‰æœ‰æ•ˆå›¾æ ‡ï¼Œå°è¯•è·å–favicon\r\n      if (!iconUrl) {\r\n        iconUrl = await getWebsiteFavicon(bookmark.url);\r\n      }\r\n      \r\n      // å¦‚æœè·å–åˆ°æœ‰æ•ˆå›¾æ ‡ï¼Œæ›¿æ¢æ–‡å­—ç‰ˆæœ¬\r\n      if (iconUrl) {\r\n        showImageIcon(iconUrl);\r\n      }\r\n    } catch (error) {\r\n      console.warn('è·å–ä¹¦ç­¾å›¾æ ‡å¤±è´¥:', bookmark.title, error);\r\n      // ä¿æŒæ–‡å­—ç‰ˆæœ¬\r\n    }\r\n  })();\r\n  \r\n  return bookmarkItem;\r\n}\r\n\r\n// ä¿®æ”¹åŸæœ‰çš„createBookmarkElementå‡½æ•°ï¼Œç®€åŒ–ä¸ºåªä½¿ç”¨faviconæˆ–æ–‡å­—\r\nfunction createBookmarkElement(bookmark: Bookmark): HTMLElement {\r\n  const bookmarkItem = document.createElement('a');\r\n  bookmarkItem.href = bookmark.url;\r\n  bookmarkItem.className = 'bookmark-item';\r\n  \r\n  // å¦‚æœæœ‰æè¿°ï¼Œæ·»åŠ åˆ°titleå±æ€§ä¸­\r\n  if (bookmark.description) {\r\n    bookmarkItem.title = `${bookmark.title}\\n${bookmark.description}`;\r\n  } else {\r\n    bookmarkItem.title = bookmark.title;\r\n  }\r\n  \r\n  const iconContainer = document.createElement('div');\r\n  iconContainer.className = 'bookmark-icon';\r\n  \r\n  // å¦‚æœæœ‰å›¾æ ‡URLï¼Œä½¿ç”¨å›¾ç‰‡ï¼›å¦åˆ™ä½¿ç”¨æ–‡å­—\r\n  if (bookmark.icon) {\r\n    const iconImg = document.createElement('img');\r\n    iconImg.src = bookmark.icon;\r\n    iconImg.alt = bookmark.title;\r\n    iconImg.onerror = (): void => {\r\n      // å›¾æ ‡åŠ è½½å¤±è´¥æ—¶ï¼Œä½¿ç”¨æ–‡å­—\r\n      iconContainer.innerHTML = '';\r\n      iconContainer.style.background = '#6c757d';\r\n      iconContainer.style.color = 'white';\r\n      iconContainer.style.display = 'flex';\r\n      iconContainer.style.alignItems = 'center';\r\n      iconContainer.style.justifyContent = 'center';\r\n      iconContainer.style.fontSize = '1.2rem';\r\n      iconContainer.style.fontWeight = 'bold';\r\n      iconContainer.textContent = bookmark.title.charAt(0).toUpperCase();\r\n    };\r\n    iconContainer.appendChild(iconImg);\r\n  } else {\r\n    // ä½¿ç”¨æ–‡å­—\r\n    iconContainer.style.background = '#6c757d';\r\n    iconContainer.style.color = 'white';\r\n    iconContainer.style.display = 'flex';\r\n    iconContainer.style.alignItems = 'center';\r\n    iconContainer.style.justifyContent = 'center';\r\n    iconContainer.style.fontSize = '1.2rem';\r\n    iconContainer.style.fontWeight = 'bold';\r\n    iconContainer.textContent = bookmark.title.charAt(0).toUpperCase();\r\n  }\r\n  \r\n  const titleElement = document.createElement('div');\r\n  titleElement.className = 'bookmark-title';\r\n  titleElement.textContent = bookmark.title;\r\n  \r\n  bookmarkItem.appendChild(iconContainer);\r\n  bookmarkItem.appendChild(titleElement);\r\n  \r\n  // æ·»åŠ å³é”®èœå•äº‹ä»¶\r\n  bookmarkItem.addEventListener('contextmenu', (e: MouseEvent): void => {\r\n    e.preventDefault();\r\n    showBookmarkContextMenu(e, bookmark, bookmarkItem);\r\n  });\r\n  \r\n  return bookmarkItem;\r\n}\r\n\r\n// åˆ›å»ºæ·»åŠ ä¹¦ç­¾æŒ‰é’®\r\nfunction createAddBookmarkButton(): HTMLElement {\r\n  const addBookmarkItem = document.createElement('div');\r\n  addBookmarkItem.className = 'add-bookmark-item';\r\n  addBookmarkItem.id = 'add-bookmark';\r\n  \r\n  const iconContainer = document.createElement('div');\r\n  iconContainer.className = 'add-bookmark-icon';\r\n  iconContainer.textContent = '+';\r\n  \r\n  const titleElement = document.createElement('div');\r\n  titleElement.className = 'add-bookmark-title';\r\n  titleElement.textContent = 'æ·»åŠ é“¾æ¥';\r\n  \r\n  addBookmarkItem.appendChild(iconContainer);\r\n  addBookmarkItem.appendChild(titleElement);\r\n  \r\n  // æ·»åŠ ç‚¹å‡»äº‹ä»¶\r\n  addBookmarkItem.addEventListener('click', (): void => {\r\n    const addBookmarkModal = getElement('add-bookmark-modal');\r\n    if (addBookmarkModal) {\r\n      addBookmarkModal.classList.add('active');\r\n    }\r\n  });\r\n  \r\n  return addBookmarkItem;\r\n}\r\n\r\n// åˆå§‹åŒ–ä¾§è¾¹æ \r\nfunction initSidebar(): void {\r\n  // ä¾§è¾¹æ ç›¸å…³åŠŸèƒ½å®ç°\r\n  console.log('ä¾§è¾¹æ åˆå§‹åŒ–');\r\n}\r\n\r\n// åˆå§‹åŒ–æ¨¡æ€æ¡†\r\nfunction initModals(): void {\r\n  const addWorkspaceBtn = getElement('add-workspace');\r\n  const addWorkspaceModal = getElement('add-workspace-modal');\r\n  const addWorkspaceForm = getElement<HTMLFormElement>('add-workspace-form');\r\n  const cancelWorkspaceBtn = getElement('cancel-workspace');\r\n  \r\n  // ä¹¦ç­¾ç›¸å…³å…ƒç´ \r\n  const addBookmarkModal = getElement('add-bookmark-modal');\r\n  const addBookmarkForm = getElement<HTMLFormElement>('add-bookmark-form');\r\n  const cancelBookmarkBtn = getElement('cancel-bookmark');\r\n  \r\n  // æ·»åŠ å·¥ä½œåŒºæŒ‰é’®ç‚¹å‡»äº‹ä»¶\r\n  if (addWorkspaceBtn && addWorkspaceModal) {\r\n    addWorkspaceBtn.addEventListener('click', (): void => {\r\n      console.log('ç‚¹å‡»æ·»åŠ å·¥ä½œåŒºæŒ‰é’®');\r\n      addWorkspaceModal.classList.add('active');\r\n    });\r\n  }\r\n  \r\n  // å–æ¶ˆæ·»åŠ å·¥ä½œåŒºæŒ‰é’®\r\n  if (cancelWorkspaceBtn && addWorkspaceModal && addWorkspaceForm) {\r\n    cancelWorkspaceBtn.addEventListener('click', (): void => {\r\n      addWorkspaceModal.classList.remove('active');\r\n      addWorkspaceForm.reset();\r\n      clearIconSelection();\r\n      // æ¸…é™¤ç¼–è¾‘æ¨¡å¼æ ‡è®°\r\n      addWorkspaceModal.removeAttribute('data-edit-mode');\r\n      addWorkspaceModal.removeAttribute('data-edit-workspace');\r\n      // æ¢å¤æ ‡é¢˜\r\n      const modalTitle = addWorkspaceModal.querySelector('h3');\r\n      if (modalTitle) {\r\n        modalTitle.textContent = 'æ·»åŠ æ–°å·¥ä½œåŒº';\r\n      }\r\n    });\r\n  }\r\n  \r\n  // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­\r\n  if (addWorkspaceModal && addWorkspaceForm) {\r\n    addWorkspaceModal.addEventListener('click', (e: Event): void => {\r\n      if (e.target === addWorkspaceModal) {\r\n        addWorkspaceModal.classList.remove('active');\r\n        addWorkspaceForm.reset();\r\n        clearIconSelection();\r\n        // æ¸…é™¤ç¼–è¾‘æ¨¡å¼æ ‡è®°\r\n        addWorkspaceModal.removeAttribute('data-edit-mode');\r\n        addWorkspaceModal.removeAttribute('data-edit-workspace');\r\n        // æ¢å¤æ ‡é¢˜\r\n        const modalTitle = addWorkspaceModal.querySelector('h3');\r\n        if (modalTitle) {\r\n          modalTitle.textContent = 'æ·»åŠ æ–°å·¥ä½œåŒº';\r\n        }\r\n      }\r\n    });\r\n  }\r\n  \r\n  // å›¾æ ‡é€‰æ‹©åŠŸèƒ½\r\n  const iconOptions = document.querySelectorAll('.icon-option');\r\n  iconOptions.forEach((option: Element): void => {\r\n    option.addEventListener('click', (): void => {\r\n      iconOptions.forEach((opt: Element): void => opt.classList.remove('selected'));\r\n      option.classList.add('selected');\r\n    });\r\n  });\r\n  \r\n  // æ·»åŠ å·¥ä½œåŒºè¡¨å•æäº¤\r\n  if (addWorkspaceForm) {\r\n    addWorkspaceForm.addEventListener('submit', (e: Event): void => {\r\n      e.preventDefault();\r\n      \r\n      const workspaceNameInput = getElement<HTMLInputElement>('workspace-name');\r\n      const selectedIcon = document.querySelector('.icon-option.selected') as HTMLElement;\r\n      \r\n      if (!workspaceNameInput || !selectedIcon || !addWorkspaceModal) {\r\n        alert('è¯·å¡«å†™å·¥ä½œåŒºåç§°å¹¶é€‰æ‹©å›¾æ ‡');\r\n        return;\r\n      }\r\n      \r\n      const workspaceName = workspaceNameInput.value.trim();\r\n      \r\n      if (!workspaceName) {\r\n        alert('è¯·å¡«å†™å·¥ä½œåŒºåç§°');\r\n        return;\r\n      }\r\n      \r\n      const workspaceIcon = selectedIcon.dataset['icon'] || 'ğŸ“';\r\n      \r\n      // æ£€æŸ¥æ˜¯å¦ä¸ºç¼–è¾‘æ¨¡å¼\r\n      const isEditMode = addWorkspaceModal.getAttribute('data-edit-mode') === 'true';\r\n      const editWorkspaceData = addWorkspaceModal.getAttribute('data-edit-workspace');\r\n      \r\n      if (isEditMode && editWorkspaceData) {\r\n        // ç¼–è¾‘æ¨¡å¼ï¼šæ›´æ–°ç°æœ‰å·¥ä½œåŒº\r\n        try {\r\n          const originalWorkspace: Workspace = JSON.parse(editWorkspaceData);\r\n          \r\n          if (workspaces[originalWorkspace.id]) {\r\n            // æ›´æ–°å·¥ä½œåŒºæ•°æ®\r\n            const workspace = workspaces[originalWorkspace.id];\r\n            if (workspace) {\r\n              workspace.name = workspaceName;\r\n              workspace.icon = workspaceIcon;\r\n            }\r\n            \r\n            console.log('å·¥ä½œåŒºå·²æ›´æ–°:', workspaceName);\r\n          } else {\r\n            alert('æ‰¾ä¸åˆ°è¦ç¼–è¾‘çš„å·¥ä½œåŒº');\r\n            return;\r\n          }\r\n        } catch (error) {\r\n          console.error('è§£æç¼–è¾‘å·¥ä½œåŒºæ•°æ®å¤±è´¥:', error);\r\n          alert('ç¼–è¾‘å·¥ä½œåŒºæ•°æ®é”™è¯¯');\r\n          return;\r\n        }\r\n      } else {\r\n        // æ·»åŠ æ¨¡å¼ï¼šåˆ›å»ºæ–°å·¥ä½œåŒº\r\n        const workspaceId = 'workspace_' + Date.now();\r\n        \r\n        workspaces[workspaceId] = {\r\n          id: workspaceId,\r\n          name: workspaceName,\r\n          icon: workspaceIcon,\r\n          bookmarks: []\r\n        };\r\n        \r\n        console.log('æ–°å·¥ä½œåŒºå·²æ·»åŠ :', workspaceName);\r\n      }\r\n      \r\n      // ä¿å­˜åˆ°å­˜å‚¨\r\n      if (typeof chrome !== 'undefined' && chrome.storage) {\r\n        chrome.storage.sync.set({ workspaces }, (): void => {\r\n          updateWorkspaceList();\r\n          addWorkspaceModal.classList.remove('active');\r\n          addWorkspaceForm.reset();\r\n          clearIconSelection();\r\n          // æ¸…é™¤ç¼–è¾‘æ¨¡å¼æ ‡è®°\r\n          addWorkspaceModal.removeAttribute('data-edit-mode');\r\n          addWorkspaceModal.removeAttribute('data-edit-workspace');\r\n          // æ¢å¤æ ‡é¢˜\r\n          const modalTitle = addWorkspaceModal.querySelector('h3');\r\n          if (modalTitle) {\r\n            modalTitle.textContent = 'æ·»åŠ æ–°å·¥ä½œåŒº';\r\n          }\r\n        });\r\n      } else {\r\n        // æœ¬åœ°æµ‹è¯•ç¯å¢ƒ\r\n        updateWorkspaceList();\r\n        addWorkspaceModal.classList.remove('active');\r\n        addWorkspaceForm.reset();\r\n        clearIconSelection();\r\n        // æ¸…é™¤ç¼–è¾‘æ¨¡å¼æ ‡è®°\r\n        addWorkspaceModal.removeAttribute('data-edit-mode');\r\n        addWorkspaceModal.removeAttribute('data-edit-workspace');\r\n        // æ¢å¤æ ‡é¢˜\r\n        const modalTitle = addWorkspaceModal.querySelector('h3');\r\n        if (modalTitle) {\r\n          modalTitle.textContent = 'æ·»åŠ æ–°å·¥ä½œåŒº';\r\n        }\r\n      }\r\n    });\r\n  }\r\n  \r\n  // ä¹¦ç­¾æ¨¡æ€æ¡†åŠŸèƒ½\r\n  if (cancelBookmarkBtn && addBookmarkModal && addBookmarkForm) {\r\n    cancelBookmarkBtn.addEventListener('click', (): void => {\r\n      addBookmarkModal.classList.remove('active');\r\n      addBookmarkForm.reset();\r\n      // æ¸…é™¤ç¼–è¾‘æ¨¡å¼æ ‡è®°\r\n      addBookmarkModal.removeAttribute('data-edit-mode');\r\n      addBookmarkModal.removeAttribute('data-edit-bookmark');\r\n    });\r\n  }\r\n  \r\n  // ç‚¹å‡»ä¹¦ç­¾æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­\r\n  if (addBookmarkModal && addBookmarkForm) {\r\n    addBookmarkModal.addEventListener('click', (e: Event): void => {\r\n      if (e.target === addBookmarkModal) {\r\n        addBookmarkModal.classList.remove('active');\r\n        addBookmarkForm.reset();\r\n        // æ¸…é™¤ç¼–è¾‘æ¨¡å¼æ ‡è®°\r\n        addBookmarkModal.removeAttribute('data-edit-mode');\r\n        addBookmarkModal.removeAttribute('data-edit-bookmark');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // æ·»åŠ ä¹¦ç­¾è¡¨å•æäº¤\r\n  if (addBookmarkForm) {\r\n    addBookmarkForm.addEventListener('submit', (e: Event): void => {\r\n      e.preventDefault();\r\n      \r\n      const titleInput = getElement<HTMLInputElement>('bookmark-title');\r\n      const urlInput = getElement<HTMLInputElement>('bookmark-url');\r\n      const descriptionInput = getElement<HTMLTextAreaElement>('bookmark-description');\r\n      \r\n      if (!titleInput || !urlInput || !addBookmarkModal) {\r\n        alert('è¯·å¡«å†™å®Œæ•´çš„ä¹¦ç­¾ä¿¡æ¯');\r\n        return;\r\n      }\r\n      \r\n      const title = titleInput.value.trim();\r\n      const url = urlInput.value.trim();\r\n      const description = descriptionInput?.value.trim() || '';\r\n      \r\n      if (!title || !url) {\r\n        alert('è¯·å¡«å†™ä¹¦ç­¾æ ‡é¢˜å’ŒURL');\r\n        return;\r\n      }\r\n      \r\n      // æ£€æŸ¥æ˜¯å¦ä¸ºç¼–è¾‘æ¨¡å¼\r\n      const isEditMode = addBookmarkModal.getAttribute('data-edit-mode') === 'true';\r\n      const editBookmarkData = addBookmarkModal.getAttribute('data-edit-bookmark');\r\n      \r\n      const currentWorkspaceData = workspaces[currentWorkspace];\r\n      if (!currentWorkspaceData) {\r\n        alert('å½“å‰å·¥ä½œåŒºä¸å­˜åœ¨');\r\n        return;\r\n      }\r\n      \r\n      if (isEditMode && editBookmarkData) {\r\n        // ç¼–è¾‘æ¨¡å¼ï¼šæ›´æ–°ç°æœ‰ä¹¦ç­¾\r\n        try {\r\n          const originalBookmark: Bookmark = JSON.parse(editBookmarkData);\r\n          const bookmarkIndex = currentWorkspaceData.bookmarks.findIndex(\r\n            (b: Bookmark) => b.title === originalBookmark.title && b.url === originalBookmark.url\r\n          );\r\n          \r\n          if (bookmarkIndex !== -1) {\r\n            // æ›´æ–°ä¹¦ç­¾æ•°æ®\r\n            currentWorkspaceData.bookmarks[bookmarkIndex] = {\r\n              title,\r\n              url,\r\n              ...(description && { description })\r\n            };\r\n            \r\n            console.log('ä¹¦ç­¾å·²æ›´æ–°:', title);\r\n          } else {\r\n            alert('æ‰¾ä¸åˆ°è¦ç¼–è¾‘çš„ä¹¦ç­¾');\r\n            return;\r\n          }\r\n        } catch (error) {\r\n          console.error('è§£æç¼–è¾‘ä¹¦ç­¾æ•°æ®å¤±è´¥:', error);\r\n          alert('ç¼–è¾‘ä¹¦ç­¾æ•°æ®é”™è¯¯');\r\n          return;\r\n        }\r\n      } else {\r\n        // æ·»åŠ æ¨¡å¼ï¼šåˆ›å»ºæ–°ä¹¦ç­¾\r\n        const newBookmark: Bookmark = {\r\n          title,\r\n          url,\r\n          ...(description && { description })\r\n        };\r\n        \r\n        currentWorkspaceData.bookmarks.push(newBookmark);\r\n        console.log('æ–°ä¹¦ç­¾å·²æ·»åŠ :', title);\r\n      }\r\n      \r\n      // ä¿å­˜åˆ°å­˜å‚¨\r\n      if (typeof chrome !== 'undefined' && chrome.storage) {\r\n        chrome.storage.sync.set({ workspaces }, async (): Promise<void> => {\r\n          await initBookmarks();\r\n          addBookmarkModal.classList.remove('active');\r\n          addBookmarkForm.reset();\r\n          // æ¸…é™¤ç¼–è¾‘æ¨¡å¼æ ‡è®°\r\n          addBookmarkModal.removeAttribute('data-edit-mode');\r\n          addBookmarkModal.removeAttribute('data-edit-bookmark');\r\n        });\r\n      } else {\r\n        // æœ¬åœ°æµ‹è¯•ç¯å¢ƒ\r\n        (async (): Promise<void> => {\r\n          await initBookmarks();\r\n          addBookmarkModal.classList.remove('active');\r\n          addBookmarkForm.reset();\r\n          // æ¸…é™¤ç¼–è¾‘æ¨¡å¼æ ‡è®°\r\n          addBookmarkModal.removeAttribute('data-edit-mode');\r\n          addBookmarkModal.removeAttribute('data-edit-bookmark');\r\n        })();\r\n      }\r\n    });\r\n  }\r\n  \r\n  // è®¾ç½®ç•Œé¢ç›¸å…³å…ƒç´ \r\n  const settingsBtn = getElement('settings-btn');\r\n  const settingsModal = getElement('settings-modal');\r\n  const cancelSettingsBtn = getElement('cancel-settings');\r\n  const saveSettingsBtn = getElement('save-settings');\r\n  const resetSettingsBtn = getElement('reset-settings');\r\n  const closeSettingsBtn = getElement('close-settings');\r\n  \r\n  // è®¾ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶\r\n  if (settingsBtn && settingsModal) {\r\n    settingsBtn.addEventListener('click', (): void => {\r\n      console.log('ç‚¹å‡»è®¾ç½®æŒ‰é’®');\r\n      loadSettingsData();\r\n      settingsModal.classList.add('active');\r\n    });\r\n  }\r\n  \r\n  // å…³é—­è®¾ç½®æŒ‰é’®\r\n  if (closeSettingsBtn && settingsModal) {\r\n    closeSettingsBtn.addEventListener('click', (): void => {\r\n      settingsModal.classList.remove('active');\r\n    });\r\n  }\r\n  \r\n  // å–æ¶ˆè®¾ç½®æŒ‰é’®\r\n  if (cancelSettingsBtn && settingsModal) {\r\n    cancelSettingsBtn.addEventListener('click', (): void => {\r\n      settingsModal.classList.remove('active');\r\n    });\r\n  }\r\n  \r\n  // ç‚¹å‡»è®¾ç½®æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­\r\n  if (settingsModal) {\r\n    settingsModal.addEventListener('click', (e: Event): void => {\r\n      if (e.target === settingsModal) {\r\n        settingsModal.classList.remove('active');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // é˜»æ­¢æ¨¡æ€æ¡†å†…å®¹çš„ç‚¹å‡»äº‹ä»¶å†’æ³¡\r\n  const settingsModalContent = settingsModal?.querySelector('.settings-modal-content');\r\n  if (settingsModalContent) {\r\n    settingsModalContent.addEventListener('click', (e: Event): void => {\r\n      e.stopPropagation();\r\n    });\r\n  }\r\n  \r\n  // æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½\r\n  const tabBtns = document.querySelectorAll('.tab-btn');\r\n  const tabContents = document.querySelectorAll('.tab-content');\r\n  \r\n  tabBtns.forEach((btn: Element): void => {\r\n    btn.addEventListener('click', (): void => {\r\n      const tabBtn = btn as HTMLElement;\r\n      const targetTab = tabBtn.dataset['tab'];\r\n      \r\n      if (!targetTab) return;\r\n      \r\n      // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€\r\n      tabBtns.forEach((b: Element): void => b.classList.remove('active'));\r\n      tabContents.forEach((c: Element): void => c.classList.remove('active'));\r\n      \r\n      // æ¿€æ´»å½“å‰æ ‡ç­¾\r\n      tabBtn.classList.add('active');\r\n      const targetContent = document.getElementById(`${targetTab}-tab`);\r\n      if (targetContent) {\r\n        targetContent.classList.add('active');\r\n      }\r\n    });\r\n  });\r\n  \r\n  // ä¸»é¢˜é€‰æ‹©åŠŸèƒ½\r\n  const themeOptions = document.querySelectorAll('.theme-option');\r\n  themeOptions.forEach((option: Element): void => {\r\n    option.addEventListener('click', (): void => {\r\n      themeOptions.forEach((opt: Element): void => opt.classList.remove('active'));\r\n      option.classList.add('active');\r\n    });\r\n  });\r\n  \r\n  // ä¿å­˜è®¾ç½®æŒ‰é’®\r\n  if (saveSettingsBtn && settingsModal) {\r\n    saveSettingsBtn.addEventListener('click', (): void => {\r\n      saveSettingsData();\r\n      settingsModal.classList.remove('active');\r\n    });\r\n  }\r\n  \r\n  // é‡ç½®è®¾ç½®æŒ‰é’®\r\n  if (resetSettingsBtn) {\r\n    resetSettingsBtn.addEventListener('click', (): void => {\r\n      if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è®¾ç½®å—ï¼Ÿè¿™å°†æ¢å¤é»˜è®¤è®¾ç½®ã€‚')) {\r\n        resetSettingsData();\r\n      }\r\n    });\r\n  }\r\n  \r\n  // é…ç½®ç®¡ç†ç›¸å…³å…ƒç´ \r\n  const exportConfigBtn = getElement('export-config');\r\n  const importConfigBtn = getElement('import-config');\r\n  const importFileInput = getElement<HTMLInputElement>('import-file');\r\n  \r\n  // å¯¼å‡ºé…ç½®æŒ‰é’®\r\n  if (exportConfigBtn) {\r\n    exportConfigBtn.addEventListener('click', (): void => {\r\n      exportConfiguration();\r\n    });\r\n  }\r\n  \r\n  // å¯¼å…¥é…ç½®æŒ‰é’®\r\n  if (importConfigBtn && importFileInput) {\r\n    importConfigBtn.addEventListener('click', (): void => {\r\n      importFileInput.click();\r\n    });\r\n    \r\n    importFileInput.addEventListener('change', (e: Event): void => {\r\n      const target = e.target as HTMLInputElement;\r\n      const file = target.files?.[0];\r\n      if (file) {\r\n        importConfiguration(file);\r\n        target.value = ''; // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©\r\n      }\r\n    });\r\n  }\r\n  \r\n  console.log('æ¨¡æ€æ¡†åˆå§‹åŒ–å®Œæˆ');\r\n}\r\n\r\n// æ¸…é™¤å›¾æ ‡é€‰æ‹©\r\nfunction clearIconSelection(): void {\r\n  const iconOptions = document.querySelectorAll('.icon-option');\r\n  iconOptions.forEach((option: Element): void => {\r\n    option.classList.remove('selected');\r\n  });\r\n}\r\n\r\n// åˆå§‹åŒ–åº•è¾¹æ å›¾æ ‡\r\nfunction initBottomBarIcons(): void {\r\n  console.log('åº•è¾¹æ å›¾æ ‡åˆå§‹åŒ–');\r\n  \r\n  // å®šä¹‰åº•è¾¹æ å¿«é€Ÿé“¾æ¥\r\n  const quickLinks = [\r\n    { title: 'ç™¾åº¦', url: 'https://www.baidu.com', emoji: 'ğŸ”' },\r\n    { title: 'å¾®åš', url: 'https://weibo.com', emoji: 'ğŸ“±' },\r\n    { title: 'çŸ¥ä¹', url: 'https://www.zhihu.com', emoji: 'ğŸ’­' },\r\n    { title: 'Bilibili', url: 'https://www.bilibili.com', emoji: 'ğŸ“º' },\r\n    { title: 'GitHub', url: 'https://github.com', emoji: 'ğŸ’»' },\r\n    { title: 'æ·˜å®', url: 'https://www.taobao.com', emoji: 'ğŸ›’' },\r\n    { title: 'ç½‘æ˜“äº‘éŸ³ä¹', url: 'https://music.163.com', emoji: 'ğŸµ' },\r\n    { title: 'QQé‚®ç®±', url: 'https://mail.qq.com', emoji: 'ğŸ“§' }\r\n  ];\r\n  \r\n  const fixedLinksContainer = document.querySelector('.fixed-links');\r\n  if (!fixedLinksContainer) {\r\n    console.error('å›ºå®šé“¾æ¥å®¹å™¨æœªæ‰¾åˆ°');\r\n    return;\r\n  }\r\n  \r\n  // æ¸…ç©ºç°æœ‰å†…å®¹\r\n  fixedLinksContainer.innerHTML = '';\r\n  \r\n  // ä¸ºæ¯ä¸ªå¿«é€Ÿé“¾æ¥åˆ›å»ºå…ƒç´ \r\n  for (const link of quickLinks) {\r\n    createQuickLinkElement(link).then((linkElement) => {\r\n      fixedLinksContainer.appendChild(linkElement);\r\n    });\r\n  }\r\n}\r\n\r\n// åˆ›å»ºå¿«é€Ÿé“¾æ¥å…ƒç´  - ä¼˜åŒ–ç‰ˆæœ¬ï¼Œå…ˆæ˜¾ç¤ºæ–‡å­—ï¼Œå¼‚æ­¥è·å–favicon\r\nasync function createQuickLinkElement(link: { title: string; url: string; emoji: string }): Promise<HTMLElement> {\r\n  const linkElement = document.createElement('a');\r\n  linkElement.href = link.url;\r\n  linkElement.className = 'fixed-link';\r\n  linkElement.title = link.title;\r\n  linkElement.setAttribute('data-emoji', link.emoji);\r\n  \r\n  // å…ˆæ˜¾ç¤ºæ–‡å­—ç‰ˆæœ¬\r\n  function showTextIcon(): void {\r\n    linkElement.innerHTML = '';\r\n    linkElement.textContent = link.title.charAt(0).toUpperCase();\r\n    linkElement.style.fontSize = '1.8rem';\r\n    linkElement.style.color = 'white';\r\n    linkElement.style.textShadow = '0 2px 4px rgba(0, 0, 0, 0.3)';\r\n    linkElement.style.display = 'flex';\r\n    linkElement.style.alignItems = 'center';\r\n    linkElement.style.justifyContent = 'center';\r\n    linkElement.style.fontWeight = 'bold';\r\n  }\r\n  \r\n  // æ˜¾ç¤ºå›¾æ ‡ç‰ˆæœ¬\r\n  function showImageIcon(faviconUrl: string): void {\r\n    const img = document.createElement('img');\r\n    img.src = faviconUrl;\r\n    img.alt = link.title;\r\n    img.style.width = '100%';\r\n    img.style.height = '100%';\r\n    img.style.objectFit = 'cover';\r\n    \r\n    // å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶å›é€€åˆ°æ–‡å­—\r\n    img.onerror = (): void => {\r\n      showTextIcon();\r\n    };\r\n    \r\n    // æ¸…é™¤æ–‡å­—æ ·å¼ï¼Œæ˜¾ç¤ºå›¾ç‰‡\r\n    linkElement.innerHTML = '';\r\n    linkElement.style.fontSize = '';\r\n    linkElement.style.color = '';\r\n    linkElement.style.textShadow = '';\r\n    linkElement.style.fontWeight = '';\r\n    linkElement.appendChild(img);\r\n  }\r\n  \r\n  // ç«‹å³æ˜¾ç¤ºæ–‡å­—ç‰ˆæœ¬\r\n  showTextIcon();\r\n  \r\n  // å¼‚æ­¥è·å–faviconå¹¶æ›¿æ¢\r\n  (async (): Promise<void> => {\r\n    try {\r\n      const faviconUrl = await getWebsiteFavicon(link.url);\r\n      \r\n      // å¦‚æœè·å–åˆ°æœ‰æ•ˆå›¾æ ‡ï¼Œæ›¿æ¢æ–‡å­—ç‰ˆæœ¬\r\n      if (faviconUrl) {\r\n        showImageIcon(faviconUrl);\r\n      }\r\n    } catch (error) {\r\n      console.warn('è·å–å¿«é€Ÿé“¾æ¥å›¾æ ‡å¤±è´¥:', link.title, error);\r\n      // ä¿æŒæ–‡å­—ç‰ˆæœ¬\r\n    }\r\n  })();\r\n  \r\n  return linkElement;\r\n}\r\n\r\n// åˆå§‹åŒ–åŠ¨æ¼«èƒŒæ™¯\r\nfunction initAnimeBackground(): void {\r\n  let currentBackgroundIndex = 0;\r\n  let backgroundChangeInterval: number;\r\n  \r\n  // è·å–èƒŒæ™¯å…ƒç´ \r\n  const bg1 = getElement('anime-bg-1');\r\n  const bg2 = getElement('anime-bg-2');\r\n  const bgSwitchBtn = getElement('bg-switch-btn');\r\n  \r\n  if (!bg1 || !bg2) {\r\n    console.error('èƒŒæ™¯å…ƒç´ æœªæ‰¾åˆ°');\r\n    return;\r\n  }\r\n  \r\n  // ä»å­˜å‚¨ä¸­åŠ è½½å½“å‰èƒŒæ™¯ç´¢å¼•å’Œè‡ªåŠ¨åˆ‡æ¢è®¾ç½®\r\n  if (typeof chrome !== 'undefined' && chrome.storage) {\r\n    chrome.storage.sync.get(['currentBackgroundIndex', 'autoChangeBackground'], (data: { currentBackgroundIndex?: number; autoChangeBackground?: boolean }): void => {\r\n      currentBackgroundIndex = data.currentBackgroundIndex || 0;\r\n      const autoChange = data.autoChangeBackground !== false; // é»˜è®¤å¼€å¯è‡ªåŠ¨åˆ‡æ¢\r\n      \r\n      // è®¾ç½®åˆå§‹èƒŒæ™¯\r\n      setBackground(currentBackgroundIndex);\r\n      \r\n      // å¦‚æœå¼€å¯è‡ªåŠ¨åˆ‡æ¢ï¼Œå¯åŠ¨å®šæ—¶å™¨\r\n      if (autoChange) {\r\n        startAutoChange();\r\n      }\r\n    });\r\n  } else {\r\n    // æœ¬åœ°æµ‹è¯•ç¯å¢ƒ\r\n    setBackground(0);\r\n    startAutoChange();\r\n  }\r\n  \r\n  // èƒŒæ™¯åˆ‡æ¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶\r\n  if (bgSwitchBtn) {\r\n    bgSwitchBtn.addEventListener('click', (): void => {\r\n      switchToNextBackground();\r\n    });\r\n  }\r\n  \r\n  // è®¾ç½®èƒŒæ™¯å›¾ç‰‡\r\n  function setBackground(index: number): void {\r\n    if (index >= 0 && index < animeBackgrounds.length) {\r\n      const background = animeBackgrounds[index];\r\n      \r\n      if (!background) {\r\n        console.error('èƒŒæ™¯æ•°æ®ä¸å­˜åœ¨ï¼Œç´¢å¼•:', index);\r\n        return;\r\n      }\r\n      \r\n      // é¢„åŠ è½½å›¾ç‰‡\r\n      const img = new Image();\r\n      img.onload = (): void => {\r\n        // å›¾ç‰‡åŠ è½½å®Œæˆåè®¾ç½®èƒŒæ™¯\r\n        if (bg1 && bg2) {\r\n          const activeBg = bg1.style.opacity === '0' ? bg1 : bg2;\r\n          const inactiveBg = activeBg === bg1 ? bg2 : bg1;\r\n          \r\n          // è®¾ç½®æ–°èƒŒæ™¯\r\n          activeBg.style.backgroundImage = `url(${background.url})`;\r\n          activeBg.style.opacity = '1';\r\n          \r\n          // æ·¡å‡ºæ—§èƒŒæ™¯\r\n          inactiveBg.style.opacity = '0';\r\n        }\r\n        \r\n        console.log('èƒŒæ™¯å·²åˆ‡æ¢åˆ°:', background.name);\r\n      };\r\n      \r\n      img.onerror = (): void => {\r\n        console.error('èƒŒæ™¯å›¾ç‰‡åŠ è½½å¤±è´¥:', background.url);\r\n        // å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€å¼ \r\n        switchToNextBackground();\r\n      };\r\n      \r\n      img.src = background.url;\r\n    }\r\n  }\r\n  \r\n  // åˆ‡æ¢åˆ°ä¸‹ä¸€å¼ èƒŒæ™¯\r\n  function switchToNextBackground(): void {\r\n    currentBackgroundIndex = (currentBackgroundIndex + 1) % animeBackgrounds.length;\r\n    setBackground(currentBackgroundIndex);\r\n    \r\n    // ä¿å­˜å½“å‰èƒŒæ™¯ç´¢å¼•\r\n    if (typeof chrome !== 'undefined' && chrome.storage) {\r\n      chrome.storage.sync.set({ currentBackgroundIndex });\r\n    }\r\n    \r\n    // é‡ç½®è‡ªåŠ¨åˆ‡æ¢å®šæ—¶å™¨\r\n    if (backgroundChangeInterval) {\r\n      clearInterval(backgroundChangeInterval);\r\n      startAutoChange();\r\n    }\r\n  }\r\n  \r\n  // å¼€å§‹è‡ªåŠ¨åˆ‡æ¢\r\n  function startAutoChange(): void {\r\n    // æ¯30ç§’è‡ªåŠ¨åˆ‡æ¢èƒŒæ™¯\r\n    backgroundChangeInterval = window.setInterval((): void => {\r\n      switchToNextBackground();\r\n    }, 30000);\r\n  }\r\n  \r\n  // åœæ­¢è‡ªåŠ¨åˆ‡æ¢\r\n  function stopAutoChange(): void {\r\n    if (backgroundChangeInterval) {\r\n      clearInterval(backgroundChangeInterval);\r\n    }\r\n  }\r\n  \r\n  // é¡µé¢å¤±å»ç„¦ç‚¹æ—¶åœæ­¢è‡ªåŠ¨åˆ‡æ¢ï¼Œè·å¾—ç„¦ç‚¹æ—¶æ¢å¤\r\n  document.addEventListener('visibilitychange', (): void => {\r\n    if (document.hidden) {\r\n      stopAutoChange();\r\n    } else {\r\n      startAutoChange();\r\n    }\r\n  });\r\n  \r\n  console.log('åŠ¨æ¼«èƒŒæ™¯åˆå§‹åŒ–å®Œæˆï¼Œå…±', animeBackgrounds.length, 'å¼ èƒŒæ™¯å›¾ç‰‡');\r\n}\r\n\r\n// è®¾ç½®ç›¸å…³æ¥å£\r\ninterface AppSettings {\r\n  autoChangeBackground: boolean;\r\n  backgroundInterval: number;\r\n  showClock: boolean;\r\n  showDate: boolean;\r\n  theme: 'auto' | 'light' | 'dark';\r\n  searchEngine: SearchEngine;\r\n  searchSuggestions: boolean;\r\n  openInNewTab: boolean;\r\n}\r\n\r\n// åŠ è½½è®¾ç½®æ•°æ®\r\nfunction loadSettingsData(): void {\r\n  if (typeof chrome !== 'undefined' && chrome.storage) {\r\n    chrome.storage.sync.get([\r\n      'autoChangeBackground',\r\n      'backgroundInterval', \r\n      'showClock',\r\n      'showDate',\r\n      'theme',\r\n      'searchEngine',\r\n      'searchSuggestions',\r\n      'openInNewTab'\r\n    ], (data: Partial<AppSettings>): void => {\r\n      // å¸¸è§„è®¾ç½®\r\n      const autoChangeCheckbox = getElement<HTMLInputElement>('auto-change-background');\r\n      if (autoChangeCheckbox) {\r\n        autoChangeCheckbox.checked = data.autoChangeBackground !== false;\r\n      }\r\n      \r\n      const backgroundIntervalInput = getElement<HTMLInputElement>('background-interval');\r\n      if (backgroundIntervalInput) {\r\n        backgroundIntervalInput.value = String(data.backgroundInterval || 30);\r\n      }\r\n      \r\n      const showClockCheckbox = getElement<HTMLInputElement>('show-clock');\r\n      if (showClockCheckbox) {\r\n        showClockCheckbox.checked = data.showClock !== false;\r\n      }\r\n      \r\n      const showDateCheckbox = getElement<HTMLInputElement>('show-date');\r\n      if (showDateCheckbox) {\r\n        showDateCheckbox.checked = data.showDate !== false;\r\n      }\r\n      \r\n      // å¤–è§‚è®¾ç½®\r\n      const theme = data.theme || 'auto';\r\n      const themeOptions = document.querySelectorAll('.theme-option');\r\n      themeOptions.forEach((option: Element): void => {\r\n        const themeOption = option as HTMLElement;\r\n        option.classList.remove('active');\r\n        if (themeOption.dataset['theme'] === theme) {\r\n          option.classList.add('active');\r\n        }\r\n      });\r\n      \r\n      // æœç´¢è®¾ç½®\r\n      const searchEngine = data.searchEngine || 'baidu';\r\n      const searchEngineRadios = document.querySelectorAll<HTMLInputElement>('input[name=\"search-engine\"]');\r\n      searchEngineRadios.forEach((radio: HTMLInputElement): void => {\r\n        radio.checked = radio.value === searchEngine;\r\n      });\r\n      \r\n      const searchSuggestionsCheckbox = getElement<HTMLInputElement>('search-suggestions');\r\n      if (searchSuggestionsCheckbox) {\r\n        searchSuggestionsCheckbox.checked = data.searchSuggestions !== false;\r\n      }\r\n      \r\n      const openInNewTabCheckbox = getElement<HTMLInputElement>('open-in-new-tab');\r\n      if (openInNewTabCheckbox) {\r\n        openInNewTabCheckbox.checked = data.openInNewTab !== false;\r\n      }\r\n      \r\n    });\r\n  } else {\r\n    // æœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼Œä½¿ç”¨é»˜è®¤å€¼\r\n    console.log('æœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®');\r\n  }\r\n}\r\n\r\n// ä¿å­˜è®¾ç½®æ•°æ®\r\nfunction saveSettingsData(): void {\r\n  // æ”¶é›†æ‰€æœ‰è®¾ç½®æ•°æ®\r\n  const autoChangeCheckbox = getElement<HTMLInputElement>('auto-change-background');\r\n  const backgroundIntervalInput = getElement<HTMLInputElement>('background-interval');\r\n  const showClockCheckbox = getElement<HTMLInputElement>('show-clock');\r\n  const showDateCheckbox = getElement<HTMLInputElement>('show-date');\r\n  const searchSuggestionsCheckbox = getElement<HTMLInputElement>('search-suggestions');\r\n  const openInNewTabCheckbox = getElement<HTMLInputElement>('open-in-new-tab');\r\n  \r\n  // è·å–é€‰ä¸­çš„ä¸»é¢˜\r\n  const selectedTheme = document.querySelector('.theme-option.active') as HTMLElement;\r\n  const theme = selectedTheme?.dataset['theme'] || 'auto';\r\n  \r\n  // è·å–é€‰ä¸­çš„æœç´¢å¼•æ“\r\n  const selectedSearchEngine = document.querySelector<HTMLInputElement>('input[name=\"search-engine\"]:checked');\r\n  const searchEngine = selectedSearchEngine?.value || 'baidu';\r\n  \r\n  const settings: Partial<AppSettings> = {\r\n    autoChangeBackground: autoChangeCheckbox?.checked !== false,\r\n    backgroundInterval: parseInt(backgroundIntervalInput?.value || '30'),\r\n    showClock: showClockCheckbox?.checked !== false,\r\n    showDate: showDateCheckbox?.checked !== false,\r\n    theme: theme as 'auto' | 'light' | 'dark',\r\n    searchEngine: searchEngine as SearchEngine,\r\n    searchSuggestions: searchSuggestionsCheckbox?.checked !== false,\r\n    openInNewTab: openInNewTabCheckbox?.checked !== false\r\n  };\r\n  \r\n  if (typeof chrome !== 'undefined' && chrome.storage) {\r\n    chrome.storage.sync.set(settings, (): void => {\r\n      console.log('è®¾ç½®å·²ä¿å­˜:', settings);\r\n      alert('è®¾ç½®å·²ä¿å­˜ï¼');\r\n      \r\n      // åº”ç”¨ä¸€äº›ç«‹å³ç”Ÿæ•ˆçš„è®¾ç½®\r\n      applySettings(settings);\r\n    });\r\n  } else {\r\n    // æœ¬åœ°æµ‹è¯•ç¯å¢ƒ\r\n    console.log('æœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼Œè®¾ç½®å·²ä¿å­˜:', settings);\r\n    alert('è®¾ç½®å·²ä¿å­˜ï¼');\r\n    applySettings(settings);\r\n  }\r\n}\r\n\r\n// é‡ç½®è®¾ç½®æ•°æ®\r\nfunction resetSettingsData(): void {\r\n  const defaultSettings: AppSettings = {\r\n    autoChangeBackground: true,\r\n    backgroundInterval: 30,\r\n    showClock: true,\r\n    showDate: true,\r\n    theme: 'auto',\r\n    searchEngine: 'baidu',\r\n    searchSuggestions: true,\r\n    openInNewTab: true\r\n  };\r\n  \r\n  if (typeof chrome !== 'undefined' && chrome.storage) {\r\n    chrome.storage.sync.set(defaultSettings, (): void => {\r\n      console.log('è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼');\r\n      alert('è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼ï¼');\r\n      \r\n      // é‡æ–°åŠ è½½è®¾ç½®ç•Œé¢\r\n      loadSettingsData();\r\n      \r\n      // åº”ç”¨é»˜è®¤è®¾ç½®\r\n      applySettings(defaultSettings);\r\n    });\r\n  } else {\r\n    // æœ¬åœ°æµ‹è¯•ç¯å¢ƒ\r\n    console.log('æœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼Œè®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼');\r\n    alert('è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼ï¼');\r\n    loadSettingsData();\r\n    applySettings(defaultSettings);\r\n  }\r\n}\r\n\r\n// åº”ç”¨è®¾ç½®ï¼ˆç«‹å³ç”Ÿæ•ˆçš„è®¾ç½®ï¼‰\r\nfunction applySettings(settings: Partial<AppSettings>): void {\r\n  // åº”ç”¨æ—¶é’Ÿæ˜¾ç¤ºè®¾ç½®\r\n  const clockElement = getElement('clock');\r\n  const dateElement = getElement('date');\r\n  \r\n  if (clockElement) {\r\n    clockElement.style.display = settings.showClock === false ? 'none' : 'block';\r\n  }\r\n  \r\n  if (dateElement) {\r\n    dateElement.style.display = settings.showDate === false ? 'none' : 'block';\r\n  }\r\n  \r\n  // åº”ç”¨æœç´¢å¼•æ“è®¾ç½®\r\n  if (settings.searchEngine) {\r\n    const searchInput = getElement<HTMLInputElement>('search-input');\r\n    if (searchInput) {\r\n      const config = searchEngines[settings.searchEngine];\r\n      searchInput.placeholder = config.placeholder;\r\n    }\r\n  }\r\n  \r\n  console.log('è®¾ç½®å·²åº”ç”¨:', settings);\r\n}\r\n\r\n// å¯¼å‡ºé…ç½®\r\nfunction exportConfiguration(): void {\r\n  try {\r\n    // æ”¶é›†å½“å‰é…ç½®æ•°æ®\r\n    const configData: ConfigData = {\r\n      workspaces: workspaces,\r\n      currentWorkspace: currentWorkspace,\r\n      exportTime: new Date().toISOString(),\r\n      version: '1.0.0'\r\n    };\r\n    \r\n    // å¦‚æœæœ‰Chromeå­˜å‚¨ï¼Œä¹Ÿå¯¼å‡ºè®¾ç½®\r\n    if (typeof chrome !== 'undefined' && chrome.storage) {\r\n      chrome.storage.sync.get([\r\n        'autoChangeBackground',\r\n        'backgroundInterval',\r\n        'showClock',\r\n        'showDate',\r\n        'theme',\r\n        'searchEngine',\r\n        'searchSuggestions',\r\n        'openInNewTab'\r\n      ], (settings: Partial<AppSettings>): void => {\r\n        configData.settings = settings;\r\n        downloadConfigFile(configData);\r\n      });\r\n    } else {\r\n      downloadConfigFile(configData);\r\n    }\r\n  } catch (error) {\r\n    console.error('å¯¼å‡ºé…ç½®å¤±è´¥:', error);\r\n    alert('å¯¼å‡ºé…ç½®å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚');\r\n  }\r\n}\r\n\r\n// ä¸‹è½½é…ç½®æ–‡ä»¶\r\nfunction downloadConfigFile(configData: ConfigData): void {\r\n  const jsonString = JSON.stringify(configData, null, 2);\r\n  const blob = new Blob([jsonString], { type: 'application/json' });\r\n  const url = URL.createObjectURL(blob);\r\n  \r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = `mytab-config-${new Date().toISOString().split('T')[0]}.json`;\r\n  document.body.appendChild(a);\r\n  a.click();\r\n  document.body.removeChild(a);\r\n  URL.revokeObjectURL(url);\r\n  \r\n  console.log('é…ç½®å·²å¯¼å‡º');\r\n  alert('é…ç½®å¯¼å‡ºæˆåŠŸï¼');\r\n}\r\n\r\n// å¯¼å…¥é…ç½®\r\nfunction importConfiguration(file: File): void {\r\n  const reader = new FileReader();\r\n  \r\n  reader.onload = (e: ProgressEvent<FileReader>): void => {\r\n    try {\r\n      const content = e.target?.result as string;\r\n      const configData: ConfigData = JSON.parse(content);\r\n      \r\n      // éªŒè¯é…ç½®æ•°æ®æ ¼å¼\r\n      if (!validateConfigData(configData)) {\r\n        alert('é…ç½®æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é€‰æ‹©æœ‰æ•ˆçš„é…ç½®æ–‡ä»¶ã€‚');\r\n        return;\r\n      }\r\n      \r\n      // è·å–å¯¼å…¥æ¨¡å¼\r\n      const importMode = getSelectedImportMode();\r\n      \r\n      // ç¡®è®¤å¯¼å…¥\r\n      const confirmMessage = importMode === 'replace' \r\n        ? 'ç¡®å®šè¦è¦†ç›–å½“å‰é…ç½®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰ç°æœ‰çš„å·¥ä½œåŒºå’Œä¹¦ç­¾ã€‚'\r\n        : 'ç¡®å®šè¦åˆå¹¶é…ç½®å—ï¼Ÿé‡å¤çš„ä¹¦ç­¾å°†è¢«è‡ªåŠ¨å»é™¤ã€‚';\r\n        \r\n      if (!confirm(confirmMessage)) {\r\n        return;\r\n      }\r\n      \r\n      // æ‰§è¡Œå¯¼å…¥\r\n      if (importMode === 'replace') {\r\n        replaceConfiguration(configData);\r\n      } else {\r\n        mergeConfiguration(configData);\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error('å¯¼å…¥é…ç½®å¤±è´¥:', error);\r\n      alert('é…ç½®æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ã€‚');\r\n    }\r\n  };\r\n  \r\n  reader.readAsText(file);\r\n}\r\n\r\n// éªŒè¯é…ç½®æ•°æ®æ ¼å¼\r\nfunction validateConfigData(data: any): data is ConfigData {\r\n  return (\r\n    data &&\r\n    typeof data === 'object' &&\r\n    data.workspaces &&\r\n    typeof data.workspaces === 'object' &&\r\n    typeof data.currentWorkspace === 'string' &&\r\n    typeof data.version === 'string'\r\n  );\r\n}\r\n\r\n// è·å–é€‰ä¸­çš„å¯¼å…¥æ¨¡å¼\r\nfunction getSelectedImportMode(): 'replace' | 'merge' {\r\n  const selectedMode = document.querySelector<HTMLInputElement>('input[name=\"import-mode\"]:checked');\r\n  return selectedMode?.value as 'replace' | 'merge' || 'replace';\r\n}\r\n\r\n// è¦†ç›–é…ç½®\r\nfunction replaceConfiguration(configData: ConfigData): void {\r\n  // ç›´æ¥æ›¿æ¢å·¥ä½œåŒºæ•°æ®\r\n  workspaces = configData.workspaces;\r\n  currentWorkspace = configData.currentWorkspace;\r\n  \r\n  // ç¡®ä¿å½“å‰å·¥ä½œåŒºå­˜åœ¨\r\n  if (!workspaces[currentWorkspace]) {\r\n    currentWorkspace = Object.keys(workspaces)[0] || 'default';\r\n  }\r\n  \r\n  // ä¿å­˜åˆ°å­˜å‚¨\r\n  saveConfigurationToStorage(configData, (): void => {\r\n    // æ›´æ–°UI\r\n      updateWorkspaceList();\r\n  initBookmarks();\r\n    \r\n    alert('é…ç½®å¯¼å…¥æˆåŠŸï¼é¡µé¢å°†åˆ·æ–°ä»¥åº”ç”¨æ–°é…ç½®ã€‚');\r\n    setTimeout(() => {\r\n      window.location.reload();\r\n    }, 1000);\r\n  });\r\n}\r\n\r\n// åˆå¹¶é…ç½®\r\nfunction mergeConfiguration(configData: ConfigData): void {\r\n  // åˆå¹¶å·¥ä½œåŒº\r\n  Object.keys(configData.workspaces).forEach((workspaceId: string): void => {\r\n    const importedWorkspace = configData.workspaces[workspaceId];\r\n    \r\n    // æ£€æŸ¥å¯¼å…¥çš„å·¥ä½œåŒºæ˜¯å¦å­˜åœ¨\r\n    if (!importedWorkspace) {\r\n      return;\r\n    }\r\n    \r\n    if (workspaces[workspaceId]) {\r\n      // å·¥ä½œåŒºå·²å­˜åœ¨ï¼Œåˆå¹¶ä¹¦ç­¾\r\n      const existingBookmarks = workspaces[workspaceId].bookmarks;\r\n      const importedBookmarks = importedWorkspace.bookmarks;\r\n      \r\n      // å»é‡åˆå¹¶ä¹¦ç­¾ï¼ˆåŸºäºURLï¼‰\r\n      const mergedBookmarks = [...existingBookmarks];\r\n      const existingUrls = new Set(existingBookmarks.map(b => b.url));\r\n      \r\n      importedBookmarks.forEach((bookmark: Bookmark): void => {\r\n        if (!existingUrls.has(bookmark.url)) {\r\n          mergedBookmarks.push(bookmark);\r\n        }\r\n      });\r\n      \r\n      workspaces[workspaceId].bookmarks = mergedBookmarks;\r\n    } else {\r\n      // å·¥ä½œåŒºä¸å­˜åœ¨ï¼Œç›´æ¥æ·»åŠ \r\n      workspaces[workspaceId] = { ...importedWorkspace };\r\n    }\r\n  });\r\n  \r\n  // ä¿å­˜åˆ°å­˜å‚¨\r\n  saveConfigurationToStorage(configData, (): void => {\r\n    // æ›´æ–°UI\r\n      updateWorkspaceList();\r\n  initBookmarks();\r\n    \r\n    alert('é…ç½®åˆå¹¶æˆåŠŸï¼');\r\n  });\r\n}\r\n\r\n// ä¿å­˜é…ç½®åˆ°å­˜å‚¨\r\nfunction saveConfigurationToStorage(configData: ConfigData, callback: () => void): void {\r\n  if (typeof chrome !== 'undefined' && chrome.storage) {\r\n    const dataToSave: any = {\r\n      workspaces: workspaces,\r\n      currentWorkspace: currentWorkspace\r\n    };\r\n    \r\n    // å¦‚æœæœ‰è®¾ç½®æ•°æ®ï¼Œä¹Ÿä¿å­˜è®¾ç½®\r\n    if (configData.settings) {\r\n      Object.assign(dataToSave, configData.settings);\r\n    }\r\n    \r\n    chrome.storage.sync.set(dataToSave, callback);\r\n  } else {\r\n    // æœ¬åœ°æµ‹è¯•ç¯å¢ƒ\r\n    console.log('æœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼Œé…ç½®å·²ä¿å­˜');\r\n    callback();\r\n  }\r\n}\r\n\r\n// GitHubåŒæ­¥åŠŸèƒ½\r\nlet currentSyncStatus: SyncStatus = 'idle';\r\n\r\n// åˆå§‹åŒ–GitHubåŒæ­¥åŠŸèƒ½\r\nfunction initGitHubSync(): void {\r\n  const syncEnabledEl = getElement<HTMLInputElement>('github-sync-enabled');\r\n  const testConnectionBtn = getElement<HTMLButtonElement>('test-connection');\r\n  const syncNowBtn = getElement<HTMLButtonElement>('sync-now');\r\n  \r\n  if (syncEnabledEl) {\r\n    syncEnabledEl.addEventListener('change', toggleGitHubSync);\r\n    loadGitHubSyncSettings();\r\n  }\r\n  \r\n  if (testConnectionBtn) {\r\n    testConnectionBtn.addEventListener('click', testGitHubConnection);\r\n  }\r\n  \r\n  if (syncNowBtn) {\r\n    syncNowBtn.addEventListener('click', syncNow);\r\n  }\r\n}\r\n\r\n// åˆ‡æ¢GitHubåŒæ­¥å¼€å…³\r\nfunction toggleGitHubSync(): void {\r\n  const syncEnabledEl = getElement<HTMLInputElement>('github-sync-enabled');\r\n  const syncConfigEl = getElement<HTMLElement>('github-sync-config');\r\n  \r\n  if (!syncEnabledEl || !syncConfigEl) return;\r\n  \r\n  const syncEnabled = syncEnabledEl.checked;\r\n  \r\n  if (syncEnabled) {\r\n    syncConfigEl.style.display = 'block';\r\n    loadGitHubSyncSettings();\r\n  } else {\r\n    syncConfigEl.style.display = 'none';\r\n    // ä¿å­˜ç¦ç”¨çŠ¶æ€\r\n    if (typeof chrome !== 'undefined' && chrome.storage) {\r\n      chrome.storage.sync.set({ \r\n        githubSync: { enabled: false } \r\n      });\r\n    }\r\n  }\r\n}\r\n\r\n// åŠ è½½GitHubåŒæ­¥è®¾ç½®\r\nfunction loadGitHubSyncSettings(): void {\r\n  if (typeof chrome !== 'undefined' && chrome.storage) {\r\n    chrome.storage.sync.get(['githubSync'], (data: any) => {\r\n      const syncConfig = data.githubSync;\r\n      if (syncConfig) {\r\n        const syncEnabledEl = getElement<HTMLInputElement>('github-sync-enabled');\r\n        const githubTokenEl = getElement<HTMLInputElement>('github-token');\r\n        const syncConfigEl = getElement<HTMLElement>('github-sync-config');\r\n        \r\n        if (syncEnabledEl) syncEnabledEl.checked = syncConfig.enabled;\r\n        if (githubTokenEl) githubTokenEl.value = syncConfig.token || '';\r\n        \r\n        if (syncConfig.enabled && syncConfigEl) {\r\n          syncConfigEl.style.display = 'block';\r\n          updateSyncStatus('idle', 'å·²å¯ç”¨GitHubåŒæ­¥');\r\n        } else if (syncConfigEl) {\r\n          syncConfigEl.style.display = 'none';\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n// æµ‹è¯•GitHubè¿æ¥\r\nasync function testGitHubConnection(): Promise<void> {\r\n  const tokenInput = getElement<HTMLInputElement>('github-token');\r\n  if (!tokenInput) return;\r\n  \r\n  const token = tokenInput.value.trim();\r\n  \r\n  if (!token) {\r\n    updateSyncStatus('error', 'è¯·è¾“å…¥GitHub Token');\r\n    return;\r\n  }\r\n  \r\n  try {\r\n    updateSyncStatus('syncing', 'æ­£åœ¨æµ‹è¯•è¿æ¥...');\r\n    \r\n    // åˆ›å»ºOctokitå®ä¾‹\r\n    const octokit = new Octokit({\r\n      auth: token,\r\n    });\r\n    \r\n    // æµ‹è¯•è¿æ¥\r\n    const response = await octokit.rest.users.getAuthenticated();\r\n    updateSyncStatus('success', `è¿æ¥æˆåŠŸï¼Œç”¨æˆ·: ${response.data.login}`);\r\n    \r\n    // ä¿å­˜token\r\n    if (typeof chrome !== 'undefined' && chrome.storage) {\r\n      chrome.storage.sync.set({\r\n        githubSync: { token, enabled: true }\r\n      });\r\n    }\r\n    \r\n  } catch (error: any) {\r\n    updateSyncStatus('error', `è¿æ¥å¤±è´¥: ${error.message}`);\r\n  }\r\n}\r\n\r\n// ç«‹å³åŒæ­¥\r\nasync function syncNow(): Promise<void> {\r\n  const tokenInput = getElement<HTMLInputElement>('github-token');\r\n  if (!tokenInput) return;\r\n  \r\n  const token = tokenInput.value.trim();\r\n  \r\n  if (!token) {\r\n    updateSyncStatus('error', 'è¯·å…ˆè®¾ç½®GitHub Token');\r\n    return;\r\n  }\r\n  \r\n  try {\r\n    updateSyncStatus('syncing', 'æ­£åœ¨åŒæ­¥...');\r\n    \r\n    // è·å–å½“å‰æœ¬åœ°è®¾ç½®\r\n    const localData = await getCurrentSettings();\r\n    \r\n    // è·å–æˆ–åˆ›å»ºgist\r\n    const gistId = await getOrCreateGist(token);\r\n\r\n    if (!gistId) {\r\n      updateSyncStatus('error', 'åˆ›å»ºgistå¤±è´¥');\r\n      return;\r\n    }\r\n\r\n    \r\n    // åŒæ­¥æ•°æ®\r\n    await syncWithGist(token, gistId, localData);\r\n    \r\n    \r\n    updateSyncStatus('success', 'åŒæ­¥å®Œæˆ');\r\n    \r\n  } catch (error: any) {\r\n    updateSyncStatus('error', `åŒæ­¥å¤±è´¥: ${error.message}`);\r\n  }\r\n}\r\n\r\n// è·å–å½“å‰è®¾ç½®\r\nasync function getCurrentSettings(): Promise<SyncData> {\r\n  return new Promise((resolve) => {\r\n    if (typeof chrome !== 'undefined' && chrome.storage) {\r\n      chrome.storage.sync.get(['bookmarks', 'searchEngine', 'theme', 'workspaces', 'currentWorkspace'], (data: any) => {\r\n        resolve({\r\n          bookmarks: data.bookmarks || [],\r\n          searchEngine: data.searchEngine || 'baidu',\r\n          theme: data.theme || 'light',\r\n          workspaces: data.workspaces || workspaces,\r\n          currentWorkspace: data.currentWorkspace || currentWorkspace,\r\n          lastSync: new Date().toISOString()\r\n        });\r\n      });\r\n    } else {\r\n      // æœ¬åœ°æµ‹è¯•ç¯å¢ƒ\r\n      resolve({\r\n        bookmarks: [],\r\n        searchEngine: 'baidu',\r\n        theme: 'light',\r\n        workspaces: workspaces,\r\n        currentWorkspace: currentWorkspace,\r\n        lastSync: new Date().toISOString()\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n// è·å–æˆ–åˆ›å»ºgist\r\nasync function getOrCreateGist(token: string): Promise<string | null> {\r\n  const octokit = new Octokit({\r\n    auth: token,\r\n  });\r\n  \r\n  // è·å–ç”¨æˆ·çš„æ‰€æœ‰gists\r\n  const response = await octokit.rest.gists.list();\r\n  const gists = response.data;\r\n  \r\n  // æŸ¥æ‰¾åä¸ºmytabçš„gist\r\n  const existingGist = gists.find((gist: any) => \r\n    gist.files && 'mytab-config.json' in gist.files\r\n  );\r\n  \r\n  if (existingGist) {\r\n    return existingGist.id;\r\n  }\r\n  \r\n  // åˆ›å»ºæ–°çš„gist\r\n  const createResponse = await octokit.rest.gists.create({\r\n    description: 'MyTab Extension Configuration',\r\n    public: false,\r\n    files: {\r\n      'mytab-config.json': {\r\n        content: JSON.stringify({\r\n          bookmarks: [],\r\n          searchEngine: 'baidu',\r\n          theme: 'light',\r\n          workspaces: {},\r\n          currentWorkspace: 'default'\r\n        }, null, 2)\r\n      }\r\n    }\r\n  });\r\n  \r\n  return createResponse.data.id || null;\r\n}\r\n\r\n// ä¸giståŒæ­¥\r\nasync function syncWithGist(token: string, gistId: string, localData: SyncData): Promise<void> {\r\n  const octokit = new Octokit({\r\n    auth: token,\r\n  });\r\n  \r\n  // è·å–gistå†…å®¹\r\n  const gistResponse = await octokit.rest.gists.get({\r\n    gist_id: gistId\r\n  });\r\n  \r\n  const gistContent = gistResponse.data.files!['mytab-config.json']?.content;\r\n  let remoteData: SyncData;\r\n  \r\n  if (gistContent) {\r\n    remoteData = JSON.parse(gistContent);\r\n  } else {\r\n    remoteData = localData;\r\n  }\r\n  \r\n  // åˆå¹¶æœ¬åœ°å’Œè¿œç¨‹æ•°æ®\r\n  const mergedData = mergeData(localData, remoteData);\r\n  \r\n  // æ›´æ–°æœ¬åœ°å­˜å‚¨\r\n  if (typeof chrome !== 'undefined' && chrome.storage) {\r\n    chrome.storage.sync.set({\r\n      bookmarks: mergedData.bookmarks,\r\n      searchEngine: mergedData.searchEngine,\r\n      theme: mergedData.theme,\r\n      workspaces: mergedData.workspaces,\r\n      currentWorkspace: mergedData.currentWorkspace,\r\n      githubSync: { \r\n        token, \r\n        enabled: true, \r\n        gistId \r\n      }\r\n    });\r\n  }\r\n  \r\n  // æ›´æ–°å…¨å±€å˜é‡\r\n  workspaces = mergedData.workspaces;\r\n  currentWorkspace = mergedData.currentWorkspace;\r\n  \r\n  // æ›´æ–°gist\r\n  await octokit.rest.gists.update({\r\n    gist_id: gistId,\r\n    files: {\r\n      'mytab-config.json': {\r\n        content: JSON.stringify(mergedData, null, 2)\r\n      }\r\n    }\r\n  });\r\n  \r\n  // é‡æ–°æ¸²æŸ“ç•Œé¢\r\n  await completeWorkspaceInit();\r\n  await initBookmarks();\r\n  updateLastSyncTime();\r\n}\r\n\r\n// åˆå¹¶æ•°æ®\r\nfunction mergeData(localData: SyncData, remoteData: SyncData): SyncData {\r\n  // ç®€å•çš„åˆå¹¶ç­–ç•¥ï¼šä½¿ç”¨æœ€æ–°çš„æ—¶é—´æˆ³\r\n  const localTime = new Date(localData.lastSync || '1970-01-01').getTime();\r\n  const remoteTime = new Date(remoteData.lastSync || '1970-01-01').getTime();\r\n  \r\n  if (localTime > remoteTime) {\r\n    return { ...localData, lastSync: new Date().toISOString() };\r\n  } else {\r\n    return { ...remoteData, lastSync: new Date().toISOString() };\r\n  }\r\n}\r\n\r\n// æ›´æ–°åŒæ­¥çŠ¶æ€\r\nfunction updateSyncStatus(status: SyncStatus, message: string): void {\r\n  currentSyncStatus = status;\r\n  const statusElement = getElement<HTMLElement>('sync-status-text');\r\n  if (statusElement) {\r\n    statusElement.textContent = message;\r\n    statusElement.className = `sync-status-${status}`;\r\n  }\r\n  \r\n  // æ›´æ–°æŒ‰é’®çŠ¶æ€\r\n  const testButton = getElement<HTMLButtonElement>('test-connection');\r\n  const syncButton = getElement<HTMLButtonElement>('sync-now');\r\n  \r\n  if (status === 'syncing') {\r\n    if (testButton) testButton.disabled = true;\r\n    if (syncButton) syncButton.disabled = true;\r\n  } else {\r\n    if (testButton) testButton.disabled = false;\r\n    if (syncButton) syncButton.disabled = false;\r\n  }\r\n}\r\n\r\n// æ›´æ–°æœ€ååŒæ­¥æ—¶é—´\r\nfunction updateLastSyncTime(): void {\r\n  const lastSyncElement = getElement<HTMLElement>('last-sync-time');\r\n  if (lastSyncElement) {\r\n    const now = new Date();\r\n    lastSyncElement.textContent = `æœ€ååŒæ­¥: ${now.toLocaleString('zh-CN')}`;\r\n  }\r\n} "],"names":["workspaces","currentWorkspace","getElement","id","searchEngines","animeBackgrounds","updateClock","initSearch","initSidebar","initModals","initGitHubSync","initBottomBarIcons","initWorkspaces","initAnimeBackground","error","now","hours","minutes","seconds","clockElement","options","dateElement","searchInput","searchForm","data","engine","config","e","query","performSearch","searchUrl","getDefaultWorkspaces","completeWorkspaceInit","updateWorkspaceList","initBookmarks","workspaceList","workspace","workspaceItem","icon","name","switchWorkspace","showWorkspaceContextMenu","workspaceId","workspaceElement","existingMenu","contextMenu","editOption","editWorkspace","deleteOption","deleteWorkspace","closeMenu","event","addWorkspaceModal","workspaceNameInput","option","modalTitle","bookmarksContainer","currentWorkspaceData","bookmarks","bookmark","createBookmarkElementWithLogo","bookmarkElement","defaultBookmarks","addButton","createAddBookmarkButton","delay","showBookmarkContextMenu","editBookmark","deleteBookmark","addBookmarkModal","titleInput","urlInput","descriptionInput","bookmarkIndex","b","getWebsiteFavicon","url","domain","faviconPaths","faviconPath","checkImageExists","resolve","img","bookmarkItem","iconContainer","showTextIcon","showImageIcon","iconUrl","iconImg","titleElement","addBookmarkItem","addWorkspaceBtn","addWorkspaceForm","cancelWorkspaceBtn","addBookmarkForm","cancelBookmarkBtn","clearIconSelection","iconOptions","opt","selectedIcon","workspaceName","workspaceIcon","isEditMode","editWorkspaceData","originalWorkspace","title","description","editBookmarkData","originalBookmark","newBookmark","settingsBtn","settingsModal","cancelSettingsBtn","saveSettingsBtn","resetSettingsBtn","closeSettingsBtn","loadSettingsData","settingsModalContent","tabBtns","tabContents","btn","tabBtn","targetTab","c","targetContent","themeOptions","saveSettingsData","resetSettingsData","exportConfigBtn","importConfigBtn","importFileInput","exportConfiguration","target","file","importConfiguration","quickLinks","fixedLinksContainer","link","createQuickLinkElement","linkElement","faviconUrl","currentBackgroundIndex","backgroundChangeInterval","bg1","bg2","bgSwitchBtn","autoChange","setBackground","startAutoChange","switchToNextBackground","index","background","activeBg","inactiveBg","stopAutoChange","autoChangeCheckbox","backgroundIntervalInput","showClockCheckbox","showDateCheckbox","theme","themeOption","searchEngine","radio","searchSuggestionsCheckbox","openInNewTabCheckbox","settings","applySettings","defaultSettings","configData","downloadConfigFile","jsonString","blob","a","reader","content","validateConfigData","importMode","getSelectedImportMode","replaceConfiguration","mergeConfiguration","saveConfigurationToStorage","importedWorkspace","existingBookmarks","importedBookmarks","mergedBookmarks","existingUrls","callback","dataToSave","syncEnabledEl","testConnectionBtn","syncNowBtn","toggleGitHubSync","loadGitHubSyncSettings","testGitHubConnection","syncNow","syncConfigEl","syncConfig","githubTokenEl","updateSyncStatus","tokenInput","token","response","Octokit","localData","getCurrentSettings","gistId","getOrCreateGist","syncWithGist","octokit","existingGist","gist","gistContent","remoteData","mergedData","mergeData","updateLastSyncTime","localTime","remoteTime","status","message","statusElement","testButton","syncButton","lastSyncElement"],"mappings":"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"}