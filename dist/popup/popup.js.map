{"version":3,"file":"popup.js","sources":["../../src/popup/popup.ts"],"sourcesContent":["import { Bookmark, StorageData, Workspace, Workspaces } from '../types/index.js';\r\n\r\n// 声明Chrome API类型\r\ndeclare const chrome: any;\r\n\r\n// DOM元素类型断言辅助函数\r\nfunction getElement<T extends HTMLElement>(id: string): T {\r\n  const element = document.getElementById(id) as T;\r\n  if (!element) {\r\n    throw new Error(`Element with id '${id}' not found`);\r\n  }\r\n  return element;\r\n}\r\n\r\nfunction getElementBySelector<T extends HTMLElement>(selector: string): T {\r\n  const element = document.querySelector(selector) as T;\r\n  if (!element) {\r\n    throw new Error(`Element with selector '${selector}' not found`);\r\n  }\r\n  return element;\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', (): void => {\r\n  // 事件监听器\r\n  getElement<HTMLFormElement>('save-to-workspace-form').addEventListener('submit', handleSaveToWorkspace);\r\n  \r\n  // 初始化表单\r\n  initializeForm();\r\n});\r\n\r\n// 初始化表单\r\nfunction initializeForm(): void {\r\n  // 获取当前页面信息\r\n  getCurrentPageInfo().then(pageInfo => {\r\n    const titleInput = getElement<HTMLInputElement>('workspace-bookmark-title');\r\n    const urlInput = getElement<HTMLInputElement>('workspace-bookmark-url');\r\n    \r\n    titleInput.value = pageInfo.title;\r\n    urlInput.value = pageInfo.url;\r\n    \r\n    // 加载工作区列表\r\n    loadWorkspaceList();\r\n  });\r\n}\r\n\r\n// 获取当前页面信息\r\nfunction getCurrentPageInfo(): Promise<{title: string, url: string}> {\r\n  return new Promise((resolve) => {\r\n    if (typeof chrome !== 'undefined' && chrome.tabs) {\r\n      chrome.tabs.query({active: true, currentWindow: true}, (tabs: any[]) => {\r\n        if (tabs[0]) {\r\n          resolve({\r\n            title: tabs[0].title || '',\r\n            url: tabs[0].url || ''\r\n          });\r\n        } else {\r\n          resolve({title: '', url: ''});\r\n        }\r\n      });\r\n    } else {\r\n      // 本地测试环境\r\n      resolve({title: '测试页面', url: 'https://example.com'});\r\n    }\r\n  });\r\n}\r\n\r\n// 加载工作区列表\r\nfunction loadWorkspaceList(): void {\r\n  chrome.storage.sync.get(['workspaces'], (data: StorageData): void => {\r\n    const workspaces: Workspaces = data.workspaces || {};\r\n    const workspaceSelect = getElement<HTMLSelectElement>('workspace-select');\r\n    \r\n    // 清空现有选项\r\n    workspaceSelect.innerHTML = '';\r\n    \r\n    // 添加默认选项\r\n    const defaultOption = document.createElement('option');\r\n    defaultOption.value = '';\r\n    defaultOption.textContent = '选择工作区';\r\n    workspaceSelect.appendChild(defaultOption);\r\n    \r\n    // 添加工作区选项\r\n    Object.keys(workspaces).forEach(workspaceId => {\r\n      const workspace = workspaces[workspaceId];\r\n      if (workspace) {\r\n        const option = document.createElement('option');\r\n        option.value = workspaceId;\r\n        option.textContent = workspace.name;\r\n        workspaceSelect.appendChild(option);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n// 处理保存到工作区\r\nfunction handleSaveToWorkspace(e: Event): void {\r\n  e.preventDefault();\r\n  \r\n  const titleInput = getElement<HTMLInputElement>('workspace-bookmark-title');\r\n  const urlInput = getElement<HTMLInputElement>('workspace-bookmark-url');\r\n  const workspaceSelect = getElement<HTMLSelectElement>('workspace-select');\r\n  \r\n  const title = titleInput.value.trim();\r\n  const url = urlInput.value.trim();\r\n  const workspaceId = workspaceSelect.value;\r\n  \r\n  if (!title || !url || !workspaceId) {\r\n    alert('请填写完整信息并选择工作区');\r\n    return;\r\n  }\r\n  \r\n  // 保存到指定工作区\r\n  chrome.storage.sync.get(['workspaces'], (data: StorageData): void => {\r\n    const workspaces: Workspaces = data.workspaces || {};\r\n    \r\n    if (!workspaces[workspaceId]) {\r\n      alert('工作区不存在');\r\n      return;\r\n    }\r\n    \r\n    // 检查是否已存在相同的书签\r\n    const existingBookmark = workspaces[workspaceId].bookmarks.find(bookmark => \r\n      bookmark.url === url\r\n    );\r\n    \r\n    if (existingBookmark) {\r\n      alert('该页面已存在于此工作区中');\r\n      return;\r\n    }\r\n    \r\n    // 添加新书签\r\n    let iconUrl = `https://www.google.com/s2/favicons?domain=${url}`;\r\n    try {\r\n      const urlObj = new URL(url);\r\n      iconUrl = `https://www.google.com/s2/favicons?domain=${urlObj.hostname}`;\r\n    } catch (e) {\r\n      // 如果URL无效，使用默认图标\r\n      iconUrl = `https://www.google.com/s2/favicons?domain=${url}`;\r\n    }\r\n    \r\n    const newBookmark: Bookmark = {\r\n      title,\r\n      url,\r\n      icon: iconUrl\r\n    };\r\n    \r\n    workspaces[workspaceId].bookmarks.push(newBookmark);\r\n    \r\n    // 保存到存储\r\n    chrome.storage.sync.set({ workspaces }, (): void => {\r\n      const workspaceName = workspaces[workspaceId]?.name || '未知工作区';\r\n      alert(`已保存到工作区: ${workspaceName}`);\r\n      // 重新初始化表单以获取新的页面信息\r\n      initializeForm();\r\n    });\r\n  });\r\n}\r\n"],"names":["getElement","id","element","handleSaveToWorkspace","initializeForm","getCurrentPageInfo","pageInfo","titleInput","urlInput","loadWorkspaceList","resolve","tabs","data","workspaces","workspaceSelect","defaultOption","workspaceId","workspace","option","title","url","bookmark","iconUrl","newBookmark","workspaceName"],"mappings":"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"}