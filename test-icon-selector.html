<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å›¾æ ‡é€‰æ‹©å™¨æµ‹è¯•</title>
  <link rel="stylesheet" href="dist/newtab/line-awesome.min.css">
  <style>
    body {
      font-family: 'Microsoft YaHei', sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .test-container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
    }
    
    .form-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
    }
    
    .selected-icon-display {
      margin-top: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      text-align: center;
    }
    
    .selected-icon-display i {
      font-size: 2rem;
      color: #4285f4;
      margin-right: 10px;
    }
    
    .test-buttons {
      margin-top: 20px;
      text-align: center;
    }
    
    .test-btn {
      padding: 10px 20px;
      margin: 0 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s;
    }
    
    .test-btn.primary {
      background: #4285f4;
      color: white;
    }
    
    .test-btn.primary:hover {
      background: #3367d6;
    }
    
    .test-btn.secondary {
      background: #f0f2f5;
      color: #333;
    }
    
    .test-btn.secondary:hover {
      background: #e0e2e5;
    }
  </style>
  <!-- å¼•å…¥å›¾æ ‡é€‰æ‹©å™¨çš„CSS -->
  <link rel="stylesheet" href="dist/newtab/newtab.css">
</head>
<body>
  <div class="test-container">
    <h1>ğŸ¨ å›¾æ ‡é€‰æ‹©å™¨æµ‹è¯•</h1>
    
    <div class="form-group">
      <label for="test-name">å·¥ä½œåŒºåç§°</label>
      <input type="text" id="test-name" placeholder="è¾“å…¥å·¥ä½œåŒºåç§°" value="æµ‹è¯•å·¥ä½œåŒº">
    </div>
    
    <div class="form-group">
      <label for="workspace-icon">é€‰æ‹©å›¾æ ‡</label>
      <div class="icon-selector-wrapper">
        <!-- æœç´¢æ¡† -->
        <div class="icon-search-container">
          <input type="text" id="icon-search" placeholder="æœç´¢å›¾æ ‡..." class="icon-search-input">
        </div>
        
        <!-- å›¾æ ‡é€‰æ‹©å™¨å®¹å™¨ -->
        <div class="icon-selector-container">
          <div class="icon-selector" id="icon-selector">
            <!-- å›¾æ ‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
          </div>
          <div class="icon-loading" id="icon-loading" style="display: none;">
            <i class="las la-spinner la-spin"></i>
            <span>åŠ è½½å›¾æ ‡ä¸­...</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="selected-icon-display" id="selected-display">
      <div>å½“å‰é€‰ä¸­çš„å›¾æ ‡ï¼š</div>
      <div id="selected-icon-info">
        <i class="las la-home"></i>
        <span>é¦–é¡µ (las la-home)</span>
      </div>
    </div>
    
    <div class="test-buttons">
      <button class="test-btn secondary" onclick="clearSelection()">æ¸…é™¤é€‰æ‹©</button>
      <button class="test-btn primary" onclick="getSelectedIcon()">è·å–é€‰ä¸­å›¾æ ‡</button>
    </div>
  </div>

  <script>
    // ä»JSONæ–‡ä»¶åŠ è½½å›¾æ ‡æ•°æ®
    let iconCategories = {};
    let allIcons = [];
    
    // åŠ è½½å›¾æ ‡æ•°æ®
    async function loadIconData() {
      try {
        const response = await fetch('dist/icons/icon-selector-data.json');
        if (response.ok) {
          const iconSelectorData = await response.json();
          iconCategories = iconSelectorData.categories;
          allIcons = iconSelectorData.allIcons;
          console.log(`âœ… æˆåŠŸåŠ è½½å›¾æ ‡æ•°æ®: ${iconSelectorData.metadata.totalIcons} ä¸ªå›¾æ ‡`);
          return true;
        } else {
          console.warn('âš ï¸ æ— æ³•åŠ è½½å›¾æ ‡æ•°æ®æ–‡ä»¶');
          return false;
        }
      } catch (error) {
        console.error('âŒ åŠ è½½å›¾æ ‡æ•°æ®å¤±è´¥:', error);
        return false;
      }
    }
    
    // ä½¿ç”¨é»˜è®¤å›¾æ ‡æ•°æ®ï¼ˆä½œä¸ºåå¤‡æ–¹æ¡ˆï¼‰
    const defaultIconCategories = {
      popular: [
        { name: 'é¦–é¡µ', class: 'las la-home', category: 'popular', keywords: ['home', 'é¦–é¡µ', 'ä¸»é¡µ'] },
        { name: 'å·¥ä½œ', class: 'las la-briefcase', category: 'popular', keywords: ['work', 'å·¥ä½œ', 'å…¬æ–‡åŒ…'] },
        { name: 'å­¦ä¹ ', class: 'las la-book', category: 'popular', keywords: ['book', 'å­¦ä¹ ', 'ä¹¦æœ¬'] },
        { name: 'æ¸¸æˆ', class: 'las la-gamepad', category: 'popular', keywords: ['game', 'æ¸¸æˆ', 'å¨±ä¹'] },
        { name: 'è®¾ç½®', class: 'las la-cog', category: 'popular', keywords: ['settings', 'è®¾ç½®', 'é½¿è½®'] },
        { name: 'æ”¶è—', class: 'las la-star', category: 'popular', keywords: ['star', 'æ”¶è—', 'æ˜Ÿæ˜Ÿ'] },
        { name: 'æ–‡ä»¶å¤¹', class: 'las la-folder', category: 'popular', keywords: ['folder', 'æ–‡ä»¶å¤¹', 'ç›®å½•'] },
        { name: 'ç”¨æˆ·', class: 'las la-user', category: 'popular', keywords: ['user', 'ç”¨æˆ·', 'ä¸ªäºº'] },
        { name: 'é‚®ä»¶', class: 'las la-envelope', category: 'popular', keywords: ['email', 'é‚®ä»¶', 'ä¿¡å°'] },
        { name: 'æœç´¢', class: 'las la-search', category: 'popular', keywords: ['search', 'æœç´¢', 'æŸ¥æ‰¾'] },
        { name: 'å¿ƒå½¢', class: 'las la-heart', category: 'popular', keywords: ['heart', 'å¿ƒå½¢', 'å–œæ¬¢'] },
        { name: 'æ ‡ç­¾', class: 'las la-tag', category: 'popular', keywords: ['tag', 'æ ‡ç­¾', 'æ ‡è®°'] }
      ],
      work: [
        { name: 'å·¥ä½œ', class: 'las la-briefcase', category: 'work', keywords: ['briefcase', 'å·¥ä½œ', 'å…¬æ–‡åŒ…'] },
        { name: 'å›¾è¡¨', class: 'las la-chart-bar', category: 'work', keywords: ['chart', 'å›¾è¡¨', 'ç»Ÿè®¡'] },
        { name: 'ä»£ç ', class: 'las la-code', category: 'work', keywords: ['code', 'ä»£ç ', 'ç¼–ç¨‹'] },
        { name: 'ç¬”è®°æœ¬ç”µè„‘', class: 'las la-laptop-code', category: 'work', keywords: ['laptop', 'ç¬”è®°æœ¬', 'ç”µè„‘'] },
        { name: 'æ•°æ®åº“', class: 'las la-database', category: 'work', keywords: ['database', 'æ•°æ®åº“', 'å­˜å‚¨'] },
        { name: 'æœåŠ¡å™¨', class: 'las la-server', category: 'work', keywords: ['server', 'æœåŠ¡å™¨', 'ä¸»æœº'] },
        { name: 'å·¥å…·', class: 'las la-tools', category: 'work', keywords: ['tools', 'å·¥å…·', 'ç»´ä¿®'] },
        { name: 'æ‰³æ‰‹', class: 'las la-wrench', category: 'work', keywords: ['wrench', 'æ‰³æ‰‹', 'ä¿®ç†'] },
        { name: 'ä»»åŠ¡', class: 'las la-tasks', category: 'work', keywords: ['tasks', 'ä»»åŠ¡', 'æ¸…å•'] },
        { name: 'æ—¥å†', class: 'las la-calendar', category: 'work', keywords: ['calendar', 'æ—¥å†', 'æ—¶é—´'] },
        { name: 'å‰ªè´´æ¿', class: 'las la-clipboard', category: 'work', keywords: ['clipboard', 'å‰ªè´´æ¿', 'è®°å½•'] },
        { name: 'æ–‡æ¡£', class: 'las la-file-alt', category: 'work', keywords: ['file', 'æ–‡æ¡£', 'æ–‡ä»¶'] }
      ],
      life: [
        { name: 'å’–å•¡', class: 'las la-coffee', category: 'life', keywords: ['coffee', 'å’–å•¡', 'é¥®å“'] },
        { name: 'éŸ³ä¹', class: 'las la-music', category: 'life', keywords: ['music', 'éŸ³ä¹', 'å£°éŸ³'] },
        { name: 'ç”µå½±', class: 'las la-film', category: 'life', keywords: ['film', 'ç”µå½±', 'è§†é¢‘'] },
        { name: 'ç›¸æœº', class: 'las la-camera', category: 'life', keywords: ['camera', 'ç›¸æœº', 'æ‹ç…§'] },
        { name: 'è€³æœº', class: 'las la-headphones', category: 'life', keywords: ['headphones', 'è€³æœº', 'éŸ³é¢‘'] },
        { name: 'éº¦å…‹é£', class: 'las la-microphone', category: 'life', keywords: ['microphone', 'éº¦å…‹é£', 'å½•éŸ³'] },
        { name: 'è´­ç‰©è½¦', class: 'las la-shopping-cart', category: 'life', keywords: ['shopping', 'è´­ç‰©', 'è´­ä¹°'] },
        { name: 'ä¿¡ç”¨å¡', class: 'las la-credit-card', category: 'life', keywords: ['credit', 'ä¿¡ç”¨å¡', 'æ”¯ä»˜'] },
        { name: 'ç¡¬å¸', class: 'las la-coins', category: 'life', keywords: ['coins', 'ç¡¬å¸', 'é‡‘é’±'] },
        { name: 'é’±åŒ…', class: 'las la-wallet', category: 'life', keywords: ['wallet', 'é’±åŒ…', 'è´¢åŠ¡'] },
        { name: 'é£æœº', class: 'las la-plane', category: 'life', keywords: ['plane', 'é£æœº', 'æ—…è¡Œ'] },
        { name: 'æ±½è½¦', class: 'las la-car', category: 'life', keywords: ['car', 'æ±½è½¦', 'äº¤é€š'] }
      ],
      social: [
        { name: 'é‚®ä»¶', class: 'las la-envelope', category: 'social', keywords: ['envelope', 'é‚®ä»¶', 'ä¿¡å°'] },
        { name: 'è¯„è®º', class: 'las la-comments', category: 'social', keywords: ['comments', 'è¯„è®º', 'å¯¹è¯'] },
        { name: 'ç”µè¯', class: 'las la-phone', category: 'social', keywords: ['phone', 'ç”µè¯', 'é€šè¯'] },
        { name: 'ç”¨æˆ·ç»„', class: 'las la-users', category: 'social', keywords: ['users', 'ç”¨æˆ·ç»„', 'å›¢é˜Ÿ'] },
        { name: 'æœ‹å‹', class: 'las la-user-friends', category: 'social', keywords: ['friends', 'æœ‹å‹', 'ç¤¾äº¤'] },
        { name: 'åˆ†äº«', class: 'las la-share', category: 'social', keywords: ['share', 'åˆ†äº«', 'ä¼ æ’­'] },
        { name: 'æ¶ˆæ¯', class: 'las la-comment', category: 'social', keywords: ['comment', 'æ¶ˆæ¯', 'ç•™è¨€'] },
        { name: 'é“ƒé“›', class: 'las la-bell', category: 'social', keywords: ['bell', 'é“ƒé“›', 'é€šçŸ¥'] },
        { name: 'æ‹‡æŒ‡å‘ä¸Š', class: 'las la-thumbs-up', category: 'social', keywords: ['thumbs-up', 'ç‚¹èµ', 'å–œæ¬¢'] },
        { name: 'æ¡æ‰‹', class: 'las la-handshake', category: 'social', keywords: ['handshake', 'æ¡æ‰‹', 'åˆä½œ'] },
        { name: 'å…¨çƒ', class: 'las la-globe', category: 'social', keywords: ['globe', 'å…¨çƒ', 'ä¸–ç•Œ'] },
        { name: 'ç½‘ç»œ', class: 'las la-wifi', category: 'social', keywords: ['wifi', 'ç½‘ç»œ', 'è¿æ¥'] }
      ],
      tech: [
        { name: 'ä»£ç ', class: 'las la-code', category: 'tech', keywords: ['code', 'ä»£ç ', 'ç¼–ç¨‹'] },
        { name: 'ç»ˆç«¯', class: 'las la-terminal', category: 'tech', keywords: ['terminal', 'ç»ˆç«¯', 'å‘½ä»¤è¡Œ'] },
        { name: 'æ•°æ®åº“', class: 'las la-database', category: 'tech', keywords: ['database', 'æ•°æ®åº“', 'å­˜å‚¨'] },
        { name: 'æœåŠ¡å™¨', class: 'las la-server', category: 'tech', keywords: ['server', 'æœåŠ¡å™¨', 'ä¸»æœº'] },
        { name: 'äº‘', class: 'las la-cloud', category: 'tech', keywords: ['cloud', 'äº‘', 'äº‘è®¡ç®—'] },
        { name: 'ç›¾ç‰Œ', class: 'las la-shield-alt', category: 'tech', keywords: ['shield', 'ç›¾ç‰Œ', 'å®‰å…¨'] },
        { name: 'é”', class: 'las la-lock', category: 'tech', keywords: ['lock', 'é”', 'åŠ å¯†'] },
        { name: 'WiFi', class: 'las la-wifi', category: 'tech', keywords: ['wifi', 'æ— çº¿', 'ç½‘ç»œ'] },
        { name: 'ç§»åŠ¨è®¾å¤‡', class: 'las la-mobile-alt', category: 'tech', keywords: ['mobile', 'ç§»åŠ¨', 'æ‰‹æœº'] },
        { name: 'æ¡Œé¢', class: 'las la-desktop', category: 'tech', keywords: ['desktop', 'æ¡Œé¢', 'ç”µè„‘'] },
        { name: 'ç¡¬ç›˜', class: 'las la-hdd', category: 'tech', keywords: ['hdd', 'ç¡¬ç›˜', 'å­˜å‚¨'] },
        { name: 'å†…å­˜', class: 'las la-memory', category: 'tech', keywords: ['memory', 'å†…å­˜', 'èŠ¯ç‰‡'] }
      ]
    };

    const allIcons = [
      ...iconCategories.popular,
      ...iconCategories.work,
      ...iconCategories.life,
      ...iconCategories.social,
      ...iconCategories.tech,
      { name: 'æ¯•ä¸šå¸½', class: 'las la-graduation-cap', category: 'work', keywords: ['graduation', 'æ¯•ä¸š', 'æ•™è‚²'] },
      { name: 'è°ƒè‰²æ¿', class: 'las la-palette', category: 'life', keywords: ['palette', 'è°ƒè‰²æ¿', 'è‰ºæœ¯'] },
      { name: 'åœ°å›¾', class: 'las la-map-marked-alt', category: 'life', keywords: ['map', 'åœ°å›¾', 'ä½ç½®'] },
      { name: 'å¥–æ¯', class: 'las la-trophy', category: 'popular', keywords: ['trophy', 'å¥–æ¯', 'æˆå°±'] },
      { name: 'å¥–ç« ', class: 'las la-award', category: 'popular', keywords: ['award', 'å¥–ç« ', 'è£èª‰'] },
      { name: 'å“‘é“ƒ', class: 'las la-dumbbell', category: 'life', keywords: ['dumbbell', 'å“‘é“ƒ', 'å¥èº«'] },
      { name: 'è·‘æ­¥', class: 'las la-running', category: 'life', keywords: ['running', 'è·‘æ­¥', 'è¿åŠ¨'] },
      { name: 'å¿ƒè·³', class: 'las la-heartbeat', category: 'life', keywords: ['heartbeat', 'å¿ƒè·³', 'å¥åº·'] },
      { name: 'è‡ªè¡Œè½¦', class: 'las la-bicycle', category: 'life', keywords: ['bicycle', 'è‡ªè¡Œè½¦', 'éª‘è¡Œ'] },
      { name: 'ä¹¦ç­¾', class: 'las la-bookmark', category: 'popular', keywords: ['bookmark', 'ä¹¦ç­¾', 'æ”¶è—'] },
      { name: 'æ——å¸œ', class: 'las la-flag', category: 'popular', keywords: ['flag', 'æ——å¸œ', 'æ ‡è®°'] },
      { name: 'æ»‘å—', class: 'las la-sliders-h', category: 'tech', keywords: ['sliders', 'æ»‘å—', 'è°ƒèŠ‚'] }
    ];

    let currentCategory = 'popular';
    let currentSearchTerm = '';

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', async function() {
      await initIconSelector();
    });

    async function initIconSelector() {
      const iconSearchInput = document.getElementById('icon-search');
      
      // é¦–å…ˆå°è¯•åŠ è½½JSONæ•°æ®
      const loaded = await loadIconData();
      if (!loaded) {
        // å¦‚æœåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®
        iconCategories = defaultIconCategories;
        allIcons = Object.values(defaultIconCategories).flat();
        console.log('ğŸ”„ ä½¿ç”¨é»˜è®¤å›¾æ ‡æ•°æ®');
      }
      
      // ç›´æ¥æ˜¾ç¤ºæ‰€æœ‰å›¾æ ‡
      renderIconsFromList(allIcons);
      
      // æœç´¢åŠŸèƒ½
      if (iconSearchInput) {
        iconSearchInput.addEventListener('input', function(e) {
          const searchTerm = e.target.value.trim().toLowerCase();
          
          if (searchTerm) {
            const filteredIcons = allIcons.filter(icon => 
              icon.name.toLowerCase().includes(searchTerm) ||
              icon.keywords.some(keyword => keyword.toLowerCase().includes(searchTerm))
            );
            renderIconsFromList(filteredIcons);
          } else {
            renderIconsFromList(allIcons);
          }
        });
      }
    }

    function renderIcons(category) {
      if (category === 'all') {
        renderIconsFromList(allIcons);
      } else if (iconCategories[category]) {
        renderIconsFromList(iconCategories[category]);
      }
    }

    function renderIconsFromList(icons) {
      const iconSelector = document.getElementById('icon-selector');
      const iconLoading = document.getElementById('icon-loading');
      
      if (!iconSelector) return;
      
      if (iconLoading) {
        iconLoading.style.display = 'flex';
      }
      iconSelector.innerHTML = '';
      
      setTimeout(function() {
        if (icons.length === 0) {
          iconSelector.innerHTML = `
            <div class="no-icons-found">
              <i class="las la-search"></i>
              <p>æœªæ‰¾åˆ°åŒ¹é…çš„å›¾æ ‡</p>
            </div>
          `;
        } else {
          icons.forEach(function(icon, index) {
            const iconOption = document.createElement('span');
            iconOption.className = 'icon-option';
            iconOption.dataset.icon = icon.class;
            iconOption.title = icon.name;
            iconOption.style.animationDelay = (index * 0.02) + 's';
            
            const iconElement = document.createElement('i');
            iconElement.className = icon.class;
            iconOption.appendChild(iconElement);
            
            iconOption.addEventListener('click', function() {
              document.querySelectorAll('.icon-option.selected').forEach(opt => {
                opt.classList.remove('selected');
              });
              
              iconOption.classList.add('selected');
              updateSelectedDisplay(icon);
            });
            
            iconSelector.appendChild(iconOption);
          });
        }
        
        if (iconLoading) {
          iconLoading.style.display = 'none';
        }
      }, 100);
    }

    function updateSelectedDisplay(icon) {
      const selectedIconInfo = document.getElementById('selected-icon-info');
      if (selectedIconInfo) {
        selectedIconInfo.innerHTML = `
          <i class="${icon.class}"></i>
          <span>${icon.name} (${icon.class})</span>
        `;
      }
    }

    function clearSelection() {
      document.querySelectorAll('.icon-option.selected').forEach(opt => {
        opt.classList.remove('selected');
      });
      
      const selectedIconInfo = document.getElementById('selected-icon-info');
      if (selectedIconInfo) {
        selectedIconInfo.innerHTML = '<span>æœªé€‰æ‹©å›¾æ ‡</span>';
      }
    }

    function getSelectedIcon() {
      const selected = document.querySelector('.icon-option.selected');
      if (selected) {
        const iconClass = selected.dataset.icon;
        const iconName = selected.title;
        alert(`é€‰ä¸­çš„å›¾æ ‡ï¼š${iconName}\nç±»åï¼š${iconClass}`);
      } else {
        alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå›¾æ ‡');
      }
    }
  </script>
</body>
</html>